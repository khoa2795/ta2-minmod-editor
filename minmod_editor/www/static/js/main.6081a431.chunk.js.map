{"version":3,"sources":["reportWebVitals.ts","env.ts","models/user/UserStore.ts","models/commodity/CommodityStore.ts","models/depositType/DepositTypeStore.ts","models/country/CountryStore.ts","models/stateOrProvince/StateOrProvinceStore.ts","models/mineralSite/CandidateEntity.ts","models/mineralSite/GradeTonnage.ts","models/mineralSite/Reference.ts","models/mineralSite/MineralInventory.ts","models/mineralSite/MineralSite.ts","models/mineralSite/LocationInfo.ts","models/mineralSite/MineralSiteStore.ts","models/dedupMineralSite/DedupMineralSite.ts","models/dedupMineralSite/DedupMineralSiteStore.ts","models/Namespace.ts","models/index.ts","pages/home/SearchBar.tsx","pages/home/editDedupSite/CandidateEntity.tsx","misc/index.ts","components/EditableSelect.tsx","pages/home/editDedupSite/EditRefDoc.tsx","pages/home/editDedupSite/EditSiteField.tsx","pages/home/editDedupSite/EditDedupMineralSite.tsx","components/Entity.tsx","pages/home/DedupMineralSiteTable.tsx","pages/home/HomePage.tsx","components/Navbar.tsx","components/RequiredAuthentication.tsx","routes.tsx","pages/login/LoginPage.tsx","components/StoreInit.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","_ref","getCLS","getFID","getFCP","getLCP","getTTFB","process","REACT_APP_PLATFORM","SERVER","REACT_APP_API_SERVER","PUBLIC_URL","UserStore","RStore","constructor","super","concat","id","login","username","password","resp","axios","post","runInAction","this","set","deserialize","data","isLoggedIn","records","size","get","err","getCurrentUser","values","next","value","undefined","obj","email","name","url","CommodityStore","fetchCriticalCommotities","refetch","fetch","commodity","isCritical","push","getByName","uri","substring","lastIndexOf","is_critical","normRemoteSuccessfulResponse","items","total","DepositTypeStore","SingleKeyUniqueIndex","name2id","indices","uri2id","index","getByURI","fetchAll","CountryStore","country","StateOrProvinceStore","CandidateEntity","source","confidence","observedName","normalizedURI","clone","observed_name","normalized_uri","serialize","GradeTonnage","totalTonnage","totalGrade","totalContainedMetal","total_tonnage","total_grade","total_contained_metal","Reference","document","comment","property","Document","normalizeProperty","_ref2","title","MineralInventory","category","grade","ore","reference","fromGradeTonnage","stores","createdBy","gradeTonnage","commodityStore","map","Measure","unit","MineralSite","recordId","sourceId","locationInfo","depositTypeCandidate","sameAs","dedupSiteURI","mineralInventory","getReferencedDocuments","docs","ref","getFirstReferencedDocument","updateField","edit","field","location","Error","DraftCreateMineralSite","draftID","rest","fromMineralSite","dedupMineralSite","sites","_ref3","baseSite","filter","site","updateSourceId","DedupMineralSiteLocation","stateOrProvince","toLocationInfo","depositTypes","length","getTop1DepositType","toCandidateEntity","sourceType","sourceIdent","split","URL","searchParams","toString","DraftUpdateMineralSite","arguments","isSaved","markSaved","toModel","LocationInfo","crs","state_or_province","c","s","MineralSiteStore","CRUDStore","dedupMineralSiteStore","createAndUpdateDedup","draft","discardDraft","record","create","forceFetchByURI","updateAndUpdateDedup","update","record_id","source_id","dedup_site_uri","created_by","location_info","deposit_type_candidate","same_as","Object","fromEntries","grade_tonnage","val","gt","mineral_inventory","serializeRecord","_record$locationInfo$","console","log","cat","Array","isArray","DedupMineralSiteDepositType","_stores$depositTypeSt","depositTypeStore","lat","lon","loc","_stores$countryStore$","countryStore","_stores$stateOrProvin","stateOrProvinceStore","DedupMineralSite","type","rank","getId","deposit_types","depositType","DedupMineralSiteStore","ns","SingleKeyIndex","makeObservable","action","deleteByIds","replaceSites","commodity2ids","ids","state","deindex","delete","prevIds","newIds","fetchByIds","remoteURL","params","error","response","status","fetchByCommodity","has","getByCommodity","conditions","MR","getURI","sop","updateSameAsGroup","groups","dedupSite","remove","BindedNamespace","prefix","namespace","MO","MD","userStore","mineralSiteStore","registerDefaultAxiosErrorHandler","message","window","_stores","toJS","StoreContext","createContext","useStores","React","useContext","SearchBar","searchArgs","setSearchArgs","options","setOptions","useState","useEffect","commodities","comm","label","_jsxs","Space","children","Typography","Text","_jsx","style","color","Select","width","placeholder","showSearch","optionFilterProp","onChange","CanEntComponent","entity","store","ent","Link","href","target","ListCanEntComponent","entities","comp","i","_Fragment","join","arr","separator","result","UNSELECT_VALUE","EditableSelect","props","selectingValue","setSelectingValue","Input","e","suffix","CloseCircleOutlined","onClick","option","key","italic","onProvenanceChange","onUpdateOption","EditRefDoc","availableDocs","doc","found","find","EditSiteField","currentSite","editField","onFinish","form","Form","useForm","useMemo","_","uniqBy","flatMap","editFieldComponent","initialValues","defaultInitialValues","configArgs","setFieldProvenance","setFieldValue","getNameConfig","getDepositTypeConfig","getLocationConfig","getGradeConfig","getTonnageConfig","Modal","open","onCancel","footer","getFieldsValue","refDoc","fieldValue","parseFloat","refComment","refAppliedToAll","layout","marginTop","marginBottom","requiredMark","Item","required","tooltip","rules","TextArea","rows","valuePropName","Checkbox","Button","htmlType","_ref4","deptype","sort","a","b","predictedDepTypes","Set","_ref5","_currentSite$gradeTon","_currentSite$gradeTon2","toFixed","_ref6","_currentSite$gradeTon3","_currentSite$gradeTon4","css","table","margin","border","editButton","cursor","myEditedRow","backgroundColor","orange","EditDedupMineralSite","withStyles","observer","classes","setEditField","selectedRows","setSelectedRows","fetchedSites","isLoading","ungroupTogether","async","newGroups","from","commodityId","success","ungroupSeparately","selectedSiteIds","unselectedSiteIds","createPayload","columns","hidden","render","checked","updatedRows","add","Flex","justify","EditOutlined","className","ellipsis","maxWidth","_site$locationInfo$cr","ReferenceComponent","includes","groupBtns","ungrpSepBtn","ungrpTogBtn","vertical","gap","Table","bordered","pagination","rowKey","dataSource","loading","rowClassName","change","currentUser","existingSite","cb","draftSite","Entity","emptyFetchResult","DedupMineralSiteTable","editingDedupSite","setEditingDedupSite","selectedDedupSiteIds","setSelectedDedupSiteIds","selectDedupSite","sorter","dataIndex","localeCompare","_a$location$lat","_a$location$lon","_b$location$lat","_b$location$lon","locA","locB","Divider","_a$location","_b$location","countryA","iri","countryB","province","_a$location2","_b$location2","stateA","stateB","dt","_a$getTop1DepositType","_b$getTop1DepositType","dtA","dtB","dtAName","dtBName","_a$gradeTonnage","_b$gradeTonnage","_a$gradeTonnage2","_b$gradeTonnage2","icon","variant","fetchData","selectOrNot","newSelectedDedupSiteIds","dedupMineralSites","newSiteGroups","dedupSiteId","siteUri","disabled","slice","expandable","expandedRowRender","showExpandColumn","expandedRowKeys","HomePage","normSearchArgs","args","setArgs","normArgs","newArgs","useSearchArgs","centerNavBar","justifyContent","boxShadow","leftNavBar","borderBottom","transition","height","borderRadius","paddingLeft","paddingRight","LeftNavBar","menus","routes","isFirstItemLogo","useLocation","keys","routeName","getMenuItem","activeRouteName","getActiveRouteName","Menu","mode","path","selectedKeys","realprops","isValidElement","children2","realprops2","RequiredAuthentication","NoArgsPathDef","component","LoginPage","setUsername","setPassword","setError","home","onSubmit","event","preventDefault","htmlFor","pathDef","exact","NoURLArgsPathDef","querySchema","_routes","applyLayout","element","createElement","direction","InitNonCriticalStores","Promise","all","resolve","ReactDOM","Provider","ConfigProvider","locale","enUSIntl","App","enUSLocale","getElementById"],"mappings":"+MAceA,MAZUC,IACnBA,GAAeA,aAAuBC,UACxC,8BAAqBC,MAAKC,IAAkD,IAAjD,OAAEC,EAAM,OAAEC,EAAM,OAAEC,EAAM,OAAEC,EAAM,QAAEC,GAASL,EACpEC,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAOP,GACPQ,EAAQR,EAAY,GAExB,E,iCCTwCS,0IAAYC,mBAF/C,MAKMC,EAAoD,WAAnCF,0IAAYC,mBAAmCD,0IAAYG,qBAAkC,GAG9GC,EAAqBJ,U,aCI3B,MAAMK,UAAkBC,IAC7BC,cACEC,MAAM,GAADC,OAAIP,EAAM,WAAW,CAAEQ,GAAI,aAAc,EAChD,CAEA,WAAMC,CAAMC,EAAkBC,GAC5B,IAAIC,QAAaC,IAAMC,KAAK,GAADP,OAAIP,EAAM,iBAAiB,CAAEU,WAAUC,aAClE,OAAOI,aAAY,KACjBC,KAAKC,IAAID,KAAKE,YAAYN,EAAKO,MAAM,GAEzC,CAEA,gBAAMC,GACJ,GAAIJ,KAAKK,QAAQC,KAAO,EACtB,OAAO,EAGT,IACE,IAAIV,QAAaC,IAAMU,IAAI,GAADhB,OAAIP,EAAM,mBAIpC,OAHAe,aAAY,KACVC,KAAKC,IAAID,KAAKE,YAAYN,EAAKO,MAAM,KAEhC,CACT,CAAE,MAAOK,GACP,OAAO,CACT,CACF,CAEOC,iBACL,GAA0B,IAAtBT,KAAKK,QAAQC,KACjB,OAAON,KAAKK,QAAQK,SAASC,OAAOC,YAASC,CAC/C,CAEOX,YAAYY,GACjB,MAAO,CACLtB,GAAIsB,EAAIpB,SACRqB,MAAOD,EAAIC,MACXC,KAAMF,EAAIE,KACVC,IAAI,gCAAD1B,OAAkCuB,EAAIpB,UAE7C,EC1CK,MAAMwB,UAAuB9B,IAClCC,cACEC,MAAM,GAADC,OAAIP,EAAM,4BAAuB6B,GAAW,EACnD,CAEA,8BAAMM,IACAnB,KAAKoB,SAAiC,IAAtBpB,KAAKK,QAAQC,aACzBN,KAAKqB,MAAM,CAAC,GAGpB,MAAMhB,EAAU,GAChB,IAAK,MAAMiB,KAAatB,KAAKK,QAAQK,SACjB,OAAdY,GAAsBA,EAAUC,YAClClB,EAAQmB,KAAKF,GAGjB,OAAOjB,CACT,CAEOoB,UAAUT,GACf,GAA0B,IAAtBhB,KAAKK,QAAQC,KAAjB,CAIA,IAAK,MAAMgB,KAAatB,KAAKK,QAAQK,SACnC,GAAkB,OAAdY,GAAsBA,EAAUN,OAASA,EAC3C,OAAOM,EAGX,OAAO,IAPP,CAQF,CAEOpB,YAAYY,GACjB,MAAO,CACLtB,GAAIsB,EAAIY,IAAIC,UAAUb,EAAIY,IAAIE,YAAY,KAAO,GACjDF,IAAKZ,EAAIY,IACTV,KAAMF,EAAIE,KACVO,WAAYT,EAAIe,YAEpB,CAEUC,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOnC,EAAKO,KAAM6B,MAAOpC,EAAKoC,MACzC,ECzCK,MAAMC,UAAyB7C,IACpCC,cACEC,MAAM,GAADC,OAAIP,EAAM,8BAAyB6B,GAAW,EAAO,CAAC,IAAIqB,IAAqB,OAAQ,MAAO,IAAIA,IAAqB,MAAO,OACrI,CAEA,WAAIC,GACF,OAAOnC,KAAKoC,QAAQ,EACtB,CAEA,UAAIC,GACF,OAAOrC,KAAKoC,QAAQ,EACtB,CAEOX,UAAUT,GACf,IAAIxB,EAAKQ,KAAKmC,QAAQG,MAAM/B,IAAIS,GAChC,YAAcH,IAAPrB,OAAmBqB,EAAYb,KAAKK,QAAQE,IAAIf,EACzD,CAEO+C,SAASb,GACd,IAAIlC,EAAKQ,KAAKqC,OAAOC,MAAM/B,IAAImB,GAC/B,YAAcb,IAAPrB,OAAmBqB,EAAYb,KAAKK,QAAQE,IAAIf,EACzD,CAEA,cAAMgD,IACAxC,KAAKoB,SAAiC,IAAtBpB,KAAKK,QAAQC,aACzBN,KAAKqB,MAAM,CAAC,EAEtB,CAEOnB,YAAYY,GACjB,MAAO,IACFA,EACHtB,GAAIsB,EAAIY,IAEZ,CAEUI,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOnC,EAAKO,KAAM6B,MAAOpC,EAAKoC,MACzC,EC1CK,MAAMS,UAAqBrD,IAChCC,cACEC,MAAM,GAADC,OAAIP,EAAM,0BAAqB6B,GAAW,EACjD,CAEO0B,SAASb,GACd,MAAMgB,EAAU1C,KAAKK,QAAQE,IAAImB,GACjC,GAAgB,OAAZgB,EACJ,OAAOA,CACT,CAEA,cAAMF,IACAxC,KAAKoB,SAAiC,IAAtBpB,KAAKK,QAAQC,aACzBN,KAAKqB,MAAM,CAAC,EAEtB,CAEOnB,YAAYY,GACjB,MAAO,CACLtB,GAAIsB,EAAIY,IACRV,KAAMF,EAAIE,KAEd,CAEUc,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOnC,EAAKO,KAAM6B,MAAOpC,EAAKoC,MACzC,EC1BK,MAAMW,UAA6BvD,IACxCC,cACEC,MAAM,GAADC,OAAIP,EAAM,oCAA+B6B,GAAW,EAC3D,CAEO0B,SAASb,GACd,MAAMgB,EAAU1C,KAAKK,QAAQE,IAAImB,GACjC,GAAgB,OAAZgB,EACJ,OAAOA,CACT,CAEA,cAAMF,IACAxC,KAAKoB,SAAiC,IAAtBpB,KAAKK,QAAQC,aACzBN,KAAKqB,MAAM,CAAC,EAEtB,CAEOnB,YAAYY,GACjB,MAAO,CACLtB,GAAIsB,EAAIY,IACRV,KAAMF,EAAIE,KAEd,CAEUc,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOnC,EAAKO,KAAM6B,MAAOpC,EAAKoC,MACzC,EClCK,MAAMY,EAMJvD,YAAWb,GAA8I,IAA7I,OAAEqE,EAAM,WAAEC,EAAU,aAAEC,EAAY,cAAEC,GAAsGxE,EAAA,KAL7JqE,YAAM,OACNC,gBAAU,OACVC,kBAAY,OACZC,mBAAa,EAGXhD,KAAK6C,OAASA,EACd7C,KAAK8C,WAAaA,EAClB9C,KAAK+C,aAAeA,EACpB/C,KAAKgD,cAAgBA,CACvB,CAEOC,QACL,OAAO,IAAIL,EAAgB,CACzBC,OAAQ7C,KAAK6C,OACbC,WAAY9C,KAAK8C,WACjBC,aAAc/C,KAAK+C,aACnBC,cAAehD,KAAKgD,eAExB,CAEA,kBAAc9C,CAAYY,GACxB,OAAO,IAAI8B,EAAgB,CACzBC,OAAQ/B,EAAI+B,OACZC,WAAYhC,EAAIgC,WAChBC,aAAcjC,EAAIoC,cAClBF,cAAelC,EAAIqC,gBAEvB,CAEOC,YACL,MAAO,CACLP,OAAQ7C,KAAK6C,OACbC,WAAY9C,KAAK8C,WACjBI,cAAelD,KAAK+C,aACpBI,eAAgBnD,KAAKgD,cAEzB,ECpCK,MAAMK,EAMJhE,YAAWb,GAAqK,IAApK,UAAE8C,EAAS,aAAEgC,EAAY,WAAEC,EAAU,oBAAEC,GAA0HhF,EAAA,KALpL8C,eAAS,EAAc,KACvBgC,kBAAY,OACZC,gBAAU,OACVC,yBAAmB,EAGjBxD,KAAKsB,UAAYA,EACjBtB,KAAKsD,aAAeA,EACpBtD,KAAKuD,WAAaA,EAClBvD,KAAKwD,oBAAsBA,CAC7B,CAEOP,QACL,OAAO,IAAII,EAAa,CACtB/B,UAAWtB,KAAKsB,UAChBgC,aAActD,KAAKsD,aACnBC,WAAYvD,KAAKuD,WACjBC,oBAAqBxD,KAAKwD,qBAE9B,CAEA,kBAActD,CAAYY,GACxB,OAAO,IAAIuC,EAAa,CACtB/B,UAAWR,EAAIQ,UACfgC,aAAcxC,EAAI2C,cAClBF,WAAYzC,EAAI4C,YAChBF,oBAAqB1C,EAAI6C,uBAE7B,EC/BK,MAAMC,EAMJvE,YAAWb,GASd,IATe,SACjBqF,EAAQ,QACRC,EAAO,SACPC,GAMDvF,EAAA,KAdDqF,cAAQ,OACRC,aAAO,OACPC,cAAQ,EAaN/D,KAAK6D,SAAWA,EAChB7D,KAAK8D,QAAUA,EACf9D,KAAK+D,SAAWA,CAElB,CAEOd,QACL,OAAO,IAAIW,EAAU,CACnBC,SAAU7D,KAAK6D,SAASZ,QACxBa,QAAS9D,KAAK8D,QACdC,SAAU/D,KAAK+D,UAGnB,CAEA,kBAAc7D,CAAYY,GAKxB,OAJAA,EAAM,IACDA,EACH+C,SAAUG,EAAS9D,YAAYY,EAAI+C,WAE9B,IAAID,EAAU9C,EACvB,CAEOsC,YACL,MAAO,CACLS,SAAU7D,KAAK6D,SAAST,YACxBU,QAAS9D,KAAK8D,QACdC,SAAU/D,KAAK+D,SAGnB,CAEA,wBAAcE,CAAkBF,GAC9B,OAAQA,GACN,IAAK,OACH,MAAO,6CACT,IAAK,WACH,MAAO,2CACT,IAAK,cACH,MAAO,+CACT,IAAK,QACH,MAAO,wCACT,IAAK,UACH,MAAO,sCACT,QACE,MAAO,GAEb,EAGK,MAAMC,EAIJ3E,YAAW6E,GAAmD,IAAlD,IAAExC,EAAG,MAAEyC,GAAwCD,EAAA,KAHlExC,SAAG,OACHyC,WAAK,EAGHnE,KAAK0B,IAAMA,EACX1B,KAAKmE,MAAQA,CACf,CAEOlB,QACL,OAAO,IAAIe,EAAS,CAAEtC,IAAK1B,KAAK0B,IAAKyC,MAAOnE,KAAKmE,OACnD,CACA,kBAAcjE,CAAYY,GACxB,OAAO,IAAIkD,EAAS,CAClBtC,IAAKZ,EAAIY,IACTyC,MAAOrD,EAAIqD,OAEf,CACOf,YACL,MAAO,CACL1B,IAAK1B,KAAK0B,IACVyC,MAAOnE,KAAKmE,MAEhB,ECpFK,MAAMC,EAOJ/E,YAAWb,GAAqK,IAApK,SAAE6F,EAAQ,UAAE/C,EAAS,MAAEgD,EAAK,IAAEC,EAAG,UAAEC,GAA8HhG,EAAA,KANpL6F,cAAQ,OACR/C,eAAS,OACTgD,WAAK,OACLC,SAAG,OACHC,eAAS,EAGPxE,KAAKqE,SAAWA,EAChBrE,KAAKsB,UAAYA,EACjBtB,KAAKsE,MAAQA,EACbtE,KAAKuE,IAAMA,EACXvE,KAAKwE,UAAYA,CACnB,CAEA,uBAAcC,CAAiBC,EAAgBC,EAAmBC,EAA4BJ,GAC5F,MAAMlD,EAAYoD,EAAOG,eAAetE,IAAIqE,EAAatD,WAEzD,OAAO,IAAI8C,EAAiB,CAC1BC,SAAU,CAAC,WAAY,YAAa,YAAYS,KAC7C9D,GAAS,IAAI4B,EAAgB,CAAEC,OAAQ8B,EAAW7B,WAAY,EAAKC,aAAc/B,EAAMgC,cAAe,mCAAqChC,MAE9IM,UAAW,IAAIsB,EAAgB,CAC7BC,OAAQ8B,EACR7B,WAAY,EACZC,aAAczB,EAAUN,KACxBgC,cAAe1B,EAAUI,MAE3B4C,WAC8BzD,IAA5B+D,EAAarB,gBACT1C,EACA,IAAIkE,EAAQ,CACVnE,MAAOgE,EAAarB,WACpByB,KAAM,IAAIpC,EAAgB,CACxBC,OAAQ8B,EACR7B,WAAY,EACZC,aAAc,IACdC,cAAe,2CAGzBuB,SACgC1D,IAA9B+D,EAAatB,kBACTzC,EACA,IAAIkE,EAAQ,CACVnE,MAAOgE,EAAatB,aACpB0B,KAAM,IAAIpC,EAAgB,CACxBC,OAAQ8B,EACR7B,WAAY,EACZC,aAAc,IACdC,cAAe,2CAGzBwB,UAAWA,GAEf,CAEA,kBAActE,CAAYY,GACxB,OAAO,IAAIsD,EAAiB,CAC1BC,cAA2BxD,IAAjBC,EAAIuD,SAAyB,GAAKvD,EAAIuD,SAASS,IAAIlC,EAAgB1C,aAC7EoB,UAAWsB,EAAgB1C,YAAYY,EAAIQ,WAC3CgD,WAAqBzD,IAAdC,EAAIwD,WAAsBzD,EAAYkE,EAAQ7E,YAAYY,EAAIwD,OACrEC,SAAiB1D,IAAZC,EAAIyD,SAAoB1D,EAAYkE,EAAQ7E,YAAYY,EAAIyD,KACjEC,UAAWZ,EAAU1D,YAAYY,EAAI0D,YAEzC,EAGK,MAAMO,EAIJ1F,YAAW6E,GAA6D,IAA5D,MAAEtD,EAAK,KAAEoE,GAAgDd,EAAA,KAH5EtD,WAAK,OACLoE,UAAI,EAGFhF,KAAKY,MAAQA,EACbZ,KAAKgF,KAAOA,CACd,CAEA,kBAAc9E,CAAYY,GACxB,OAAO,IAAIiE,EAAQ,CACjBnE,MAAOE,EAAIF,MACXoE,KAAMpC,EAAgB1C,YAAYY,EAAIkE,OAE1C,EC/CK,MAAMC,EAcJ5F,YAAWb,GAAgL,IAA/K,GAAEgB,EAAE,SAAE0F,EAAQ,SAAEC,EAAQ,UAAER,EAAS,KAAE3D,EAAI,aAAEoE,EAAY,qBAAEC,EAAoB,UAAEb,EAAS,OAAEc,EAAM,aAAEV,EAAY,aAAEW,EAAY,iBAAEC,GAA8ChH,EAAA,KAb/LgB,QAAE,OACF2F,cAAQ,OACRD,cAAQ,OACRK,kBAAY,OACZZ,eAAS,OACT3D,UAAI,OACJoE,kBAAY,OACZC,0BAAoB,OACpBb,eAAS,OACTc,YAAM,OACNV,kBAAY,OACZY,sBAAgB,EAGdxF,KAAKR,GAAKA,EACVQ,KAAKkF,SAAWA,EAChBlF,KAAKmF,SAAWA,EAChBnF,KAAKuF,aAAeA,EACpBvF,KAAK2E,UAAYA,EACjB3E,KAAKgB,KAAOA,EACZhB,KAAKoF,aAAeA,EACpBpF,KAAKqF,qBAAuBA,EAC5BrF,KAAKwE,UAAYA,EACjBxE,KAAKsF,OAASA,EACdtF,KAAK4E,aAAeA,EACpB5E,KAAKwF,iBAAmBA,CAC1B,CAEA,OAAI9D,GACF,MAAM,mCAANnC,OAA0CS,KAAKR,GACjD,CAEAiG,yBACE,MAAMC,EAAoC,CAAC,EAC3C,IAAK,MAAMC,KAAO3F,KAAKwE,UACrBkB,EAAKC,EAAI9B,SAASnC,KAAOiE,EAAI9B,SAE/B,OAAO6B,CACT,CAEAE,6BACE,OAAO5F,KAAKwE,UAAU,GAAGX,QAC3B,CAEAgC,YAAYnB,EAAgBoB,EAAiBtB,GAC3C,OAAQsB,EAAKC,OACX,IAAK,OACH/F,KAAKgB,KAAO8E,EAAKlF,MACjB,MACF,IAAK,WACHZ,KAAKoF,aAAaY,SAAWF,EAAKlF,MAClC,MACF,IAAK,cACHZ,KAAKqF,qBAAuB,CAC1B,IAAIzC,EAAgB,CAClBC,OAAQ7C,KAAK2E,UAAU,GACvB7B,WAAY,EACZE,cAAe8C,EAAK9C,cACpBD,aAAc+C,EAAK/C,gBAGvB,MACF,IAAK,aACuClC,IAAtCb,KAAK4E,aAAakB,EAAKxE,WACzBtB,KAAK4E,aAAakB,EAAKxE,WAAa,IAAI+B,EAAa,CACnD/B,UAAWwE,EAAKxE,UAChBiC,WAAYuC,EAAKlF,MACjB0C,aAAc,KAGhBtD,KAAK4E,aAAakB,EAAKxE,WAAWiC,WAAauC,EAAKlF,WACGC,IAAnDb,KAAK4E,aAAakB,EAAKxE,WAAWgC,eACpCtD,KAAK4E,aAAakB,EAAKxE,WAAWgC,aAAe,IAIrDtD,KAAKwF,iBAAmB,CAACpB,EAAiBK,iBAAiBC,EAAQ1E,KAAK2E,UAAU,GAAI3E,KAAK4E,aAAakB,EAAKxE,WAAYkD,IACzH,MACF,IAAK,eACuC3D,IAAtCb,KAAK4E,aAAakB,EAAKxE,WACzBtB,KAAK4E,aAAakB,EAAKxE,WAAa,IAAI+B,EAAa,CACnD/B,UAAWwE,EAAKxE,UAChBgC,aAAcwC,EAAKlF,MAEnB2C,WAAY,QAGdvD,KAAK4E,aAAakB,EAAKxE,WAAWgC,aAAewC,EAAKlF,WACDC,IAAjDb,KAAK4E,aAAakB,EAAKxE,WAAWiC,aACpCvD,KAAK4E,aAAakB,EAAKxE,WAAWiC,WAAa,OAInDvD,KAAKwF,iBAAmB,CAACpB,EAAiBK,iBAAiBC,EAAQ1E,KAAK2E,UAAU,GAAI3E,KAAK4E,aAAakB,EAAKxE,WAAYkD,IACzH,MACF,QACE,MAAM,IAAIyB,MAAM,iBAAD1G,OAAkBuG,IAIrC9F,KAAKwE,UAAUhD,KAAKgD,EACtB,EAGK,MAAM0B,UAA+BjB,EAG1C5F,YAAW6E,GAA0E,IAAzE,QAAEiC,KAAYC,GAAwDlC,EAChF5E,MAAM8G,GAAM,KAHdD,aAAO,EAILnG,KAAKmG,QAAUA,CACjB,CAEA,sBAAcE,CACZ3B,EACA4B,EACAC,EACA7G,EACA8E,GACyB,IAADgC,EACxB,MAAMC,EAAWF,EAAM,GAAG/G,KAAO8G,EAAiBC,MAAM,GAAKA,EAAM,GAAKA,EAAMG,QAAQC,GAASA,EAAKnH,KAAO8G,EAAiBC,MAAM,KAAI,GAChI5B,EAAS,gCAAApF,OAAmCG,GAGlD,OAAO,IAAIwG,EAAuB,CAChCC,QAAQ,SAAD5G,OAAW+G,EAAiB9G,IACnCA,GAAI,GACJ2F,SAAUe,EAAuBU,eAAeH,EAAStB,SAAUzF,GACnEwF,SAAUuB,EAASvB,SACnBK,aAAce,EAAiB5E,IAC/BiD,UAAW,CAACA,GACZ3D,KAAMsF,EAAiBtF,KACvBoE,aAKI,QALQoB,EACVF,EAAiBN,UACjB,IAAIa,EAAyB,CAC3BnE,QAAS,GACToE,gBAAiB,YACjB,IAAAN,OAAA,EALUA,EAMXO,eAAerC,EAAQC,EAhBT,GAiBjBU,qBAAsBiB,EAAiBU,aAAaC,OAAS,EAAI,CAACX,EAAiBY,qBAAsBC,kBAAkBzC,IAAW,GACtIF,UAAW,CAACA,GACZc,OAAQgB,EAAiBC,MACzB3B,aAAc,CACZ,CAAC0B,EAAiB1B,aAAatD,WAAYgF,EAAiB1B,cAE9DY,iBAAkB,IAEtB,CAEA,qBAAcoB,CAAezB,EAAkBzF,GAC7C,MAAO0H,EAAYC,GAAelC,EAASmC,MAAM,KAAM,GACjDrG,EAAM,IAAIsG,IAAIF,GAEpB,OADApG,EAAIuG,aAAavH,IAAI,WAAYP,GAC3B,GAANH,OAAU6H,EAAU,MAAA7H,OAAK0B,EAAIwG,WAC/B,EAGK,MAAMC,UAA+BzC,EAAY5F,cAAA,SAAAsI,WAAA,KACtDC,SAAmB,CAAK,CAExB/B,YAAYnB,EAAgBoB,EAAiBtB,GAC3ClF,MAAMuG,YAAYnB,EAAQoB,EAAMtB,GAChCxE,KAAK4H,SAAU,CACjB,CAEAC,YACE7H,KAAK4H,SAAU,CACjB,CAEAE,UACE,OAAO,IAAI7C,EAAYjF,KACzB,EC/MK,MAAM+H,EAMJ1I,YAAWb,GAA6J,IAA5J,QAAEkE,EAAO,gBAAEoE,EAAe,SAAEd,EAAQ,IAAEgC,GAAmHxJ,EAAA,KAL5KwH,cAAQ,OACRtD,aAAO,OACPoE,qBAAe,OACfkB,SAAG,EAGDhI,KAAKgG,SAAWA,EAChBhG,KAAK0C,QAAUA,EACf1C,KAAK8G,gBAAkBA,EACvB9G,KAAKgI,IAAMA,CACb,CAEA,kBAAc9H,CAAYY,GACxB,OAAO,IAAIiH,EAAa,CACtB/B,SAAUlF,EAAIkF,SACdtD,aAAyB7B,IAAhBC,EAAI4B,QAAwB,GAAK5B,EAAI4B,QAAQoC,IAAIlC,EAAgB1C,aAC1E4G,qBAA2CjG,IAA1BC,EAAImH,kBAAkC,GAAKnH,EAAImH,kBAAkBnD,IAAIlC,EAAgB1C,aACtG8H,SAAiBnH,IAAZC,EAAIkH,SAAoBnH,EAAY+B,EAAgB1C,YAAYY,EAAIkH,MAE7E,CAEO/E,QACL,OAAO,IAAI8E,EAAa,CACtB/B,SAAUhG,KAAKgG,SACftD,QAAS1C,KAAK0C,QAAQoC,KAAKoD,GAAMA,EAAEjF,UACnC6D,gBAAiB9G,KAAK8G,gBAAgBhC,KAAKqD,GAAMA,EAAElF,UACnD+E,IAAKhI,KAAKgI,IAAMhI,KAAKgI,IAAI/E,aAAUpC,GAEvC,ECtBK,MAAMuH,UAAyBC,IAGpChJ,YAAYiJ,GACVhJ,MAAM,GAADC,OAAIP,EAAM,8BAAyB6B,GAAW,GAAO,KAH5DyH,2BAAqB,EAInBtI,KAAKsI,sBAAwBA,CAC/B,CAEA,0BAAMC,CAAqBjH,EAAmBkH,GAAoF,IAArDC,IAAqBd,UAAAV,OAAA,QAAApG,IAAA8G,UAAA,KAAAA,UAAA,GAChG,MAAMe,QAAe1I,KAAK2I,OAAOH,EAAOC,GAExC,aADMzI,KAAKsI,sBAAsBM,gBAAgBF,EAAOnD,aAAcjE,GAC/DoH,CACT,CAEA,0BAAMG,CAAqBvH,EAAmBkH,GAAoF,IAArDC,IAAqBd,UAAAV,OAAA,QAAApG,IAAA8G,UAAA,KAAAA,UAAA,GAChG,MAAMe,QAAe1I,KAAK8I,OAAON,EAAOC,GAExC,aADMzI,KAAKsI,sBAAsBM,gBAAgBF,EAAOnD,aAAcjE,GAC/DoH,CACT,CAEOxI,YAAYwI,GACjB,OAAO,IAAIzD,EAAY,CACrBzF,GAAIkJ,EAAOlJ,GACX0F,SAAUwD,EAAOK,UACjB5D,SAAUuD,EAAOM,UACjBzD,aAAcmD,EAAOO,eACrBtE,UAAW+D,EAAOQ,WAClBlI,KAAM0H,EAAO1H,KACboE,kBAC2BvE,IAAzB6H,EAAOS,cACHpB,EAAa7H,YAAYwI,EAAOS,eAChC,IAAIpB,EAAa,CACfrF,QAAS,GACToE,gBAAiB,KAEzBzB,sBAAuBqD,EAAOU,wBAA0B,IAAItE,IAAIlC,EAAgB1C,aAChFsE,UAAWkE,EAAOlE,UAAUM,IAAIlB,EAAU1D,aAC1CoF,OAAQoD,EAAOW,QACfzE,aAAc0E,OAAOC,YACnBb,EAAOc,cAAc1E,KAAK2E,IACxB,MAAMC,EAAKrG,EAAanD,YAAYuJ,GACpC,MAAO,CAACC,EAAGpI,UAAWoI,EAAG,KAG7BlE,iBAAkBkD,EAAOiB,kBAAkB7E,IAAIV,EAAiBlE,cAEpE,CAEO0J,gBAAgBlB,GAAkE,IAADmB,EAGtF,MAAMrF,EAAYkE,EAAOlE,UAAUM,KAAKa,GAAQA,EAAIvC,cACpD,IAAIoC,EAAmB,GAEvB,IAAK,MAAMkE,KAAMJ,OAAO5I,OAAOgI,EAAO9D,cACpCkF,QAAQC,IAAI,MAAOL,GACnBlE,EAAiBhE,KAAK,CAGpB6C,SAAU,CAAC,WAAY,YAAa,YAAYS,KAAKkF,IAAG,CACtDnH,OAAQ6F,EAAO/D,UAAU,GACzB7B,WAAY,EACZK,eAAe,mCAAD5D,OAAqCyK,OAErD1I,UAAW,CACTuB,OAAQ6F,EAAO/D,UAAU,GACzB7B,WAAY,EACZK,eAAe,mCAAD5D,OAAqCmK,EAAGpI,YAExDiD,IAAK,CACH3D,MAAO8I,EAAGpG,aACV0B,KAAM,CACJnC,OAAQ6F,EAAO/D,UAAU,GACzB7B,WAAY,EACZK,eAAgB,yCAGpBmB,MAAO,CACL1D,MAAO8I,EAAGnG,WACVyB,KAAM,CACJnC,OAAQ6F,EAAO/D,UAAU,GACzB7B,WAAY,EACZK,eAAgB,yCAGpBqB,UAAWA,EAAU,KAIzB,MAAO,CACLxD,KAAM0H,EAAO1H,KACb+H,UAAWL,EAAOxD,SAClB8D,UAAWN,EAAOvD,SAClB+D,WAAYR,EAAO/D,UACnBsE,eAAgBP,EAAOnD,aACvB4D,cAAe,CACbzG,QAASgG,EAAOtD,aAAa1C,QAAQoC,KAAKpC,GAAYA,EAAQU,cAC9D6E,kBAAmBS,EAAOtD,aAAa0B,gBAAgBhC,KAAKmD,GAAsBA,EAAkB7E,cACpG4E,IAA4B,QAAzB6B,EAAEnB,EAAOtD,aAAa4C,WAAG,IAAA6B,OAAA,EAAvBA,EAAyBzG,YAC9B4C,SAAU0C,EAAOtD,aAAaY,UAEhCoD,uBAAwBV,EAAOrD,qBAAqBP,KAAKO,GAAyBA,EAAqBjC,cACvGuG,kBAAmBnE,EACnBhB,UAAWA,EACX6E,QAASX,EAAOpD,OAEpB,CAEUxD,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOkI,MAAMC,QAAQtK,EAAKO,MAAQP,EAAKO,KAAOmJ,OAAO5I,OAAOd,EAAKO,MAAO6B,MAAOpC,EAAKoC,MAC/F,EClHK,MAAMmI,EAKJ9K,YAAWb,GAAiF,IAAhF,IAAEkD,EAAG,OAAEmB,EAAM,WAAEC,GAA8DtE,EAAA,KAJhGkD,SAAG,OACHmB,YAAM,OACNC,gBAAU,EAGR9C,KAAK0B,IAAMA,EACX1B,KAAK6C,OAASA,EACd7C,KAAK8C,WAAaA,CACpB,CAEOqE,kBAAkBzC,GAAkE,IAAD0F,EACxF,OAAO,IAAIxH,EAAgB,CACzBC,OAAQ7C,KAAK6C,OACbC,WAAY9C,KAAK8C,WACjBE,cAAehD,KAAK0B,IACpBqB,aAAwD,QAA5CqH,EAAE1F,EAAO2F,iBAAiB9H,SAASvC,KAAK0B,YAAI,IAAA0I,OAAA,EAA1CA,EAA4CpJ,MAE9D,EAGK,MAAM6F,EAMJxH,YAAW6E,GAAkH,IAAjH,IAAEoG,EAAG,IAAEC,EAAG,QAAE7H,EAAO,gBAAEoE,GAAyF5C,EAAA,KALjIoG,SAAG,OACHC,SAAG,OACH7H,aAAO,OACPoE,qBAAe,EAGb9G,KAAKsK,IAAMA,EACXtK,KAAKuK,IAAMA,EACXvK,KAAK0C,QAAUA,EACf1C,KAAK8G,gBAAkBA,CACzB,CAEA,kBAAc5G,CAAYwI,GACxB,OAAO,IAAI7B,EAAyB,CAClCyD,IAAK5B,EAAO4B,IACZC,IAAK7B,EAAO6B,IACZ7H,QAASgG,EAAOhG,SAAW,GAC3BoE,gBAAiB4B,EAAOT,mBAAqB,IAEjD,CAEOlB,eACLrC,EAIA7B,GAEC,IACG2H,EAFJ1H,EAAkB6E,UAAAV,OAAA,QAAApG,IAAA8G,UAAA,GAAAA,UAAA,GAAG,EAOrB,YAJiB9G,IAAbb,KAAKsK,UAAkCzJ,IAAbb,KAAKuK,MACjCC,EAAG,UAAAjL,OAAaS,KAAKuK,IAAG,KAAAhL,OAAIS,KAAKsK,IAAG,MAG/B,IAAIvC,EAAa,CACtB/B,SAAUwE,EACVxC,IAAK,IAAIpF,EAAgB,CACvBC,SACAC,aACAE,cAAe,uCACfD,aAAc,cAEhBL,QAAS1C,KAAK0C,QAAQoC,KAAKpC,IAAa,IAAD+H,EACrC,OAAO,IAAI7H,EAAgB,CACzBC,SACAC,aACAE,cAAeN,EACfK,aAA8C,QAAlC0H,EAAE/F,EAAOgG,aAAanK,IAAImC,UAAQ,IAAA+H,OAAA,EAAhCA,EAAkCzJ,MAChD,IAEJ8F,gBAAiB9G,KAAK8G,gBAAgBhC,KAAKgC,IAAqB,IAAD6D,EAC7D,OAAO,IAAI/H,EAAgB,CACzBC,SACAC,aACAE,cAAe8D,EACf/D,aAA8D,QAAlD4H,EAAEjG,EAAOkG,qBAAqBrK,IAAIuG,UAAgB,IAAA6D,OAAA,EAAhDA,EAAkD3J,MAChE,KAGR,EAGK,MAAM6J,EAWJxL,YAAWmH,GAoBd,IApBe,GACjBhH,EAAE,IACFkC,EAAG,KACHV,EAAI,KACJ8J,EAAI,KACJC,EAAI,MACJxE,EAAK,aACLS,EAAY,SACZhB,EAAQ,aACRpB,GAWD4B,EAAA,KA9BDhH,QAAE,OACFkC,SAAG,OACHV,UAAI,OACJ8J,UAAI,OACJC,UAAI,OACJxE,WAAK,OACLS,kBAAY,OACZhB,cAAQ,OACRpB,kBAAY,EAuBV5E,KAAKR,GAAKA,EACVQ,KAAK0B,IAAMA,EACX1B,KAAKgB,KAAOA,EACZhB,KAAK8K,KAAOA,EACZ9K,KAAK+K,KAAOA,EACZ/K,KAAKuG,MAAQA,EACbvG,KAAKgH,aAAeA,EACpBhH,KAAKgG,SAAWA,EAChBhG,KAAK4E,aAAeA,CACtB,CAEA,aAAItD,GACF,OAAOtB,KAAK4E,aAAatD,SAC3B,CAEA,YAAc0J,CAAMtJ,GAClB,OAAOA,EAAIC,UAAUD,EAAIE,YAAY,KAAO,EAC9C,CAEA,kBAAc1B,CAAYwI,GACxB,OAAO,IAAImC,EAAiB,CAC1BrL,GAAIkJ,EAAOlJ,GACXkC,IAAI,mCAADnC,OAAqCmJ,EAAOlJ,IAC/CwB,KAAM0H,EAAO1H,KACb8J,KAAMpC,EAAOoC,KACbC,KAAMrC,EAAOqC,KACbxE,MAAOmC,EAAOnC,MACdS,aAAc0B,EAAOuC,cAAcnG,KAAKoG,GAAqB,IAAIf,EAA4Be,KAC7FlF,cAA8BnF,IAApB6H,EAAO1C,SAAyBa,EAAyB3G,YAAYwI,EAAO1C,eAAYnF,EAClG+D,aAAcvB,EAAanD,YAAYwI,EAAOc,gBAElD,CAEOtC,qBACL,OAAOlH,KAAKgH,aAAa,EAC3B,ECnJK,MAAMmE,UAA8B/L,IAGzCC,YAAY+L,GACV9L,MAAM,GAADC,OAAIP,EAAM,oCAA+B6B,GAAW,EAAO,CAAC,IAAIwK,IAAe,YAAa,QAAQ,KAH3GD,QAAE,EAIApL,KAAKoL,GAAKA,EAEVE,YAAetL,KAAM,CACnB4I,gBAAiB2C,IACjBC,YAAaD,IACbE,aAAcF,KAElB,CAEA,iBAAIG,GACF,OAAO1L,KAAKoC,QAAQ,EACtB,CAMAoJ,YAAYG,GACV3L,KAAK4L,MAAMhL,MAAQ,WACnB,IAAK,MAAMpB,KAAMmM,EAAK,CACpB,MAAMjD,EAAS1I,KAAKK,QAAQE,IAAIf,QACjBqB,IAAX6H,GAAmC,OAAXA,IAC1B1I,KAAK6L,QAAQnD,GACb1I,KAAKK,QAAQyL,OAAOtM,GAExB,CACAQ,KAAK4L,MAAMhL,MAAQ,SACrB,CAQA,kBAAM6K,CAAaM,EAAuBC,EAAsB1K,GAC9DtB,KAAKwL,YAAYO,SACX/L,KAAKiM,WAAWD,GAAQ,EAAM,CAAE1K,aACxC,CAEA,qBAAMsH,CAAgBlH,EAAaJ,GACjC,MAAM9B,EAAKqL,EAAiBG,MAAMtJ,GAClC,IACE1B,KAAK4L,MAAMhL,MAAQ,WAEnB,IAAIhB,QAAaC,IAAMU,IAAI,GAADhB,OAAIS,KAAKkM,UAAS,KAAA3M,OAAIC,GAAM,CACpD2M,OAAQ,CAAE7K,eAGZ,OAAOvB,aAAY,KACjB,IAAI2I,EAAS1I,KAAKE,YAAYN,EAAKO,MAKnC,OAJAH,KAAKK,QAAQJ,IAAIyI,EAAOlJ,GAAIkJ,GAC5B1I,KAAKsC,MAAMoG,GACX1I,KAAK4L,MAAMhL,MAAQ,UAEZZ,KAAKK,QAAQE,IAAImI,EAAOlJ,GAAG,GAEtC,CAAE,MAAO4M,GACP,GAAIA,EAAMC,UAAsC,MAA1BD,EAAMC,SAASC,OAMnC,YAJAvM,aAAY,KACVC,KAAKK,QAAQJ,IAAIT,EAAI,MACrBQ,KAAK4L,MAAMhL,MAAQ,SAAS,IAQhC,MAHAb,aAAY,KACVC,KAAK4L,MAAMhL,MAAQ,OAAO,IAEtBwL,CACR,CACF,CAEA,sBAAMG,CAAiBjL,GACrB,OAAKtB,KAAKoB,SAAWpB,KAAK0L,cAAcpJ,MAAMkK,IAAIlL,EAAU9B,IACnDQ,KAAKyM,eAAenL,SAEhBtB,KAAKqB,MAAM,CACtBqL,WAAY,CAAEpL,UAAWA,EAAU9B,KAEvC,CAEOiN,eAAenL,GACpB,IAAKtB,KAAK0L,cAAcpJ,MAAMkK,IAAIlL,EAAU9B,IAC1C,MAAO,CAAEa,QAAS,GAAI2B,MAAO,GAG/B,MAAM3B,EAAU,GAChB,IAAK,MAAMb,KAAMQ,KAAK0L,cAAcpJ,MAAM/B,IAAIe,EAAU9B,IACtDa,EAAQmB,KAAKxB,KAAKK,QAAQE,IAAIf,IAEhC,MAAO,CAAEa,UAAS2B,MAAO3B,EAAQ4G,OACnC,CAEO/G,YAAYwI,GACjB,MAAMiE,EAAK3M,KAAKoL,GAAGuB,GAEnB,OAAO,IAAI9B,EAAiB,CAC1BrL,GAAIkJ,EAAOlJ,GACXkC,IAAKiL,EAAGC,OAAOlE,EAAOlJ,IACtBwB,KAAM0H,EAAO1H,KACb8J,KAAMpC,EAAOoC,KACbC,KAAMrC,EAAOqC,KACbxE,MAAOmC,EAAOnC,MACdS,aAAc0B,EAAOuC,cAAcnG,KAChCoG,GACC,IAAIf,EAA4B,CAC9BzI,IAAKiL,EAAGC,OAAO1B,EAAY1L,IAC3BqD,OAAQqI,EAAYrI,OACpBC,WAAYoI,EAAYpI,eAG9BkD,cACsBnF,IAApB6H,EAAO1C,SACH,IAAIa,EAAyB,CAC3ByD,IAAK5B,EAAO1C,SAASsE,IACrBC,IAAK7B,EAAO1C,SAASuE,IACrB7H,SAAUgG,EAAO1C,SAAStD,SAAW,IAAIoC,KAAKpC,GAAoBiK,EAAGC,OAAOlK,KAC5EoE,iBAAkB4B,EAAO1C,SAASiC,mBAAqB,IAAInD,KAAK+H,GAAgBF,EAAGC,OAAOC,YAE5FhM,EACN+D,aAAcvB,EAAanD,YAAYwI,EAAOc,gBAElD,CAEA,uBAAMsD,CAAkBC,GAEtB,aADmBlN,IAAMC,KAAK,kBAAmBiN,IACrC5M,KAAK2E,KAAKkI,GAAmBA,EAAUxN,IACrD,CAEUsC,6BAA6BlC,GACrC,MAAO,CAAEmC,MAAOkI,MAAMC,QAAQtK,EAAKO,MAAQP,EAAKO,KAAOmJ,OAAO5I,OAAOd,EAAKO,MAAO6B,MAAOpC,EAAKoC,MAC/F,CAKU6J,QAAQnD,GAChB,IAAK,MAAMpG,KAAStC,KAAKoC,QACvBE,EAAM2K,OAAOvE,EAEjB,EC3JK,MAAMwE,EAIX7N,YAAY8N,EAAgBC,GAAoB,KAHhDD,YAAM,OACNC,eAAS,EAGPpN,KAAKmN,OAASA,EACdnN,KAAKoN,UAAYA,CACnB,CAEAR,OAAOpN,GACL,MAAM,GAAND,OAAUS,KAAKoN,WAAS7N,OAAGC,EAC7B,ECCF,MACM8I,EAAwB,IAAI6C,EADT,IDElB,MAAuB9L,cAAA,KAC5BsN,GAAsB,IAAIO,EAAgB,KAAM,oCAAoC,KACpFG,GAAsB,IAAIH,EAAgB,KAAM,oCAAoC,KACpFI,GAAsB,IAAIJ,EAAgB,KAAM,2CAA4C,ICFjFxI,EAAS,CACpB6I,UAAW,IAAIpO,EACf0F,eAAgB,IAAI3D,EACpBoH,sBAAqB,EACrBkF,iBAAkB,IAAIpF,EAAiBE,GACvC+B,iBAAkB,IAAIpI,EACtB2I,qBAAsB,IAAIjI,EAC1B+H,aAAc,IAAIjI,GAGpBgL,aAAkCrB,IAChCsB,IAAQtB,MAAM,uCAAwC,EAAE,IAGzDuB,OAAeC,QAAUlJ,EACzBiJ,OAAeE,KAAOA,IAYhB,MAAMC,EAAeC,wBAAsBrJ,GAE3C,SAASsJ,IACd,OAAOC,IAAMC,WAAWJ,EAC1B,C,mFCyDO,MAAMK,EAAsC3P,IAAoC,IAAnC,WAAE4P,EAAU,cAAEC,GAAe7P,EAC/E,MAAM,eAAEqG,GAAmBmJ,KACpBM,EAASC,GAAcC,mBAA6C,IAE3EC,qBAAU,KACR5J,EAAe1D,2BAA2B5C,MAAMmQ,IAC9CH,EACEG,EAAY5J,KAAK6J,IAAI,CACnB/N,MAAO+N,EAAKnP,GACZoP,MAAOD,EAAK3N,SAEf,GACD,GACD,CAAC6D,IAMJ,OACEgK,eAACC,IAAK,CAAAC,SAAA,CACJF,eAACG,IAAWC,KAAI,CAAAF,SAAA,CAAC,YACNG,cAAA,QAAMC,MAAO,CAAEC,MAAO,OAAQL,SAAC,MAAQ,OAElDG,cAACG,IAAM,CAACF,MAAO,CAAEG,MAAO,KAAO1O,MAAOwN,EAAW9M,UAAWiO,YAAY,qBAAqBC,YAAY,EAAMC,iBAAiB,QAAQC,SAT1H9O,IAChByN,EAAc,CAAE/M,UAAWuD,EAAetE,IAAIK,GAAQI,MAAO,EAQiGsN,QAASA,MAC/J,E,0DCtHL,MAAMqB,GAA6CnR,IAAyC,IAAxC,OAAEoR,EAAM,MAAEC,GAAwBrR,EAC3F,MAAMkG,EAASsJ,IAEf,QAAenN,IAAX+O,EACF,OAAOV,cAAA,QAAAH,SAAM,MAGf,IAAI/N,OAA+BH,IAAxB+O,EAAO7M,aAA6B,IAAM6M,EAAO7M,aAC5D,QAA6BlC,IAAzB+O,EAAO5M,cAA6B,CACtC,QAAcnC,IAAVgP,EAAqB,CACvB,MAAMC,EAAMpL,EAAOmL,GAAOtN,SAASqN,EAAO5M,oBAC9BnC,IAARiP,GAA6B,OAARA,IACvB9O,EAAO8O,EAAI9O,KAEf,CACA,OACEkO,cAACF,IAAWe,KAAI,CAACC,KAAMJ,EAAO5M,cAAeiN,OAAO,SAAQlB,SACzD/N,GAGP,CAEA,OAAOkO,cAAA,QAAAH,SAAO/N,GAAY,EAGfkP,GAAsBhM,IAAoC,IAAnC,SAAEiM,GAA2BjM,EAC/D,MAAMkM,EAAO,GAETD,EAASlJ,OAAS,GACpBmJ,EAAK5O,KAAK0N,cAACS,GAAe,CAASC,OAAQO,EAAS,IAApB,IAGlC,IAAK,IAAIE,EAAI,EAAGA,EAAIF,EAASlJ,OAAQoJ,IACnCD,EAAK5O,KAAK0N,cAAA,QAAAH,SAAM,eAChBqB,EAAK5O,KAAK0N,cAACS,GAAe,CAASC,OAAQO,EAASE,IAApBA,IAGlC,OAAOnB,cAAAoB,WAAA,CAAAvB,SAAGqB,GAAQ,ECjDb,SAASG,GAAQC,EAAUC,GAChC,GAAmB,IAAfD,EAAIvJ,OACN,MAAO,GAGT,MAAMyJ,EAAc,CAACF,EAAI,IACzB,IAAK,IAAIH,EAAI,EAAGA,EAAIG,EAAIvJ,OAAQoJ,IAC9BK,EAAOlP,KAAKiP,EAAUJ,IACtBK,EAAOlP,KAAKgP,EAAIH,IAElB,OAAOK,CACT,C,4CCKA,MAAMC,GAAiB,mEAcVC,GAAiDC,IAC5D,MAAOC,EAAgBC,GAAqBvC,wBAAyB3N,IAAhBgQ,EAAMjQ,OAC3D,GAAIkQ,EACF,OACE5B,cAAC8B,KAAK,CACJpQ,MAAOiQ,EAAMjQ,MACb8O,SAAWuB,QAA0BpQ,IAAnBgQ,EAAMnB,SAAyBmB,EAAMnB,SAASuB,EAAEhB,OAAOrP,YAASC,EAClF0O,YAAa,iBACb2B,OACEhC,cAACiC,KAAmB,CAClBhC,MAAO,CAAEC,MAAO,mBAChBgC,QAASA,KACPL,GAAkB,QACKlQ,IAAnBgQ,EAAMnB,UAAwBmB,EAAMnB,SAAS,GAAG,MAQhE,MAAMpB,EAAoBuC,EAAMvC,QAAQxJ,KAAKuM,IAAM,CAAQzQ,MAAOyQ,EAAOC,IAAK1C,MAAOyC,EAAOzC,UAC5FN,EAAQ9M,KAAK,CAAEZ,MAAO+P,GAAgB/B,MAAOM,cAACF,IAAWC,KAAI,CAACsC,QAAQ,EAAKxC,SAAC,qBAQ5E,OAAOG,cAACG,IAAM,CAACf,QAASA,EAASoB,SAAUA,CAAC9O,EAAOyQ,IAN3BA,KACtBN,GAAkB,QACKlQ,IAAnBgQ,EAAMnB,UAAwBmB,EAAMnB,SAAS2B,EAAOzC,OACpDyC,EAAOzQ,QAAU+P,IAAgBE,EAAMW,mBAAmBH,EAAOzQ,MAAM,EAGf6Q,CAAeJ,IAAkB,EClD3FV,GAAiB,mEAEVe,GAAwClT,IAA8C,IAA7C,cAAEmT,EAAe/Q,MAAOgR,EAAG,SAAElC,GAAUlR,EAC3F,MAAOsS,EAAgBC,GAAqBvC,oBAAS,GAC/CF,EAAoBqD,EAAc7M,KAAK8M,IAAG,CAAQhR,MAAOgR,EAAIlQ,IAAKkN,MAAOgD,EAAIzN,OAASyN,EAAIlQ,QAChG4M,EAAQ9M,KAAK,CAAEZ,MAAO+P,GAAgB/B,MAAOM,cAACF,IAAWC,KAAI,CAACsC,QAAQ,EAAKxC,SAAC,qBAc5E,OAAI+B,EAEA5B,cAAC8B,KAAK,CACJpQ,MAAU,OAAHgR,QAAG,IAAHA,OAAG,EAAHA,EAAKlQ,IACZgO,SAAWuB,IACT,MAAMvP,EAAMuP,EAAEhB,OAAOrP,MACT,KAARc,OACeb,IAAb6O,GAAwBA,EAAS,WAEpB7O,IAAb6O,GAAwBA,EAAS,IAAI1L,EAAS,CAAEtC,MAAKyC,MAAO,KAClE,EAEFoL,YAAa,0BACb2B,OACEhC,cAACiC,KAAmB,CAClBhC,MAAO,CAAEC,MAAO,mBAChBgC,QAASA,KACPL,GAAkB,QACDlQ,IAAb6O,GAAwBA,EAAS,KAAK,MAQ/CR,cAACG,IAAM,CAACf,QAASA,EAAS1N,MAAe,OAARgR,QAAwB/Q,IAAR+Q,OAAoB/Q,EAAY+Q,EAAIlQ,IAAKgO,SAAWhO,GAtCpFA,KACtB,GAAIA,IAAQiP,GACVI,GAAkB,QACDlQ,IAAb6O,GAAwBA,EAAS,UAChC,CACL,MAAMmC,EAAQF,EAAcG,MAAMF,GAAQA,EAAIlQ,MAAQA,IAClDmQ,QACehR,IAAb6O,GAAwBA,EAASmC,EAEzC,GA6BkHJ,CAAe/P,IAAQ,EC/BhIqQ,GAA8CvT,IAA6D,IAA5D,YAAEwT,EAAW,MAAEzL,EAAK,UAAE0L,EAAS,UAAE3Q,EAAS,SAAE4Q,GAAU1T,EAChH,MAAM,iBAAE6L,GAAqB2D,KACtBmE,GAAQC,KAAKC,UAEdlO,EAAQmO,mBAAQ,KACpB,OAAQL,GACN,IAAK,OACH,MAAO,OACT,IAAK,WACH,MAAO,WACT,IAAK,cACH,MAAO,eACT,IAAK,QACH,MAAO,YACT,IAAK,UACH,MAAO,eACT,QACE,MAAO,GACX,GACC,CAACA,IAaEvM,EAAO6M,IAAEC,OACbjM,EAAMkM,SAAS9L,GAAS2C,OAAO5I,OAAOiG,EAAKlB,4BAC3C,OAGF,IAAIiN,EACAC,EAA4BC,GAChC,MAAMC,EAAa,CAAEb,cAAazL,QAAOuM,mBAlBbxB,IAC1B,QAAYzQ,IAARyQ,EAAmB,CACrB,MAAM3K,EAAOJ,EAAMG,QAAQC,GAASA,EAAKnH,KAAO8R,IAAK,GAGrDa,EAAKY,cAAc,SAAUpM,EAAKf,6BACpC,MACEuM,EAAKY,cAAc,SAAU,KAC/B,EAU2DrO,OAAQ,CAAE2F,oBAAoB/I,aAC3F,OAAQ2Q,GACN,IAAK,QACFS,EAAoBC,GAAiBK,GAAcH,GACpD,MACF,IAAK,eACFH,EAAoBC,GAAiBM,GAAqBJ,GAC3D,MACF,IAAK,YACFH,EAAoBC,GAAiBO,GAAkBL,GACxD,MACF,IAAK,SACFH,EAAoBC,GAAiBQ,GAAeN,GACrD,MACF,IAAK,WACFH,EAAoBC,GAAiBS,GAAiBP,GACvD,MACF,UAAKhS,EACH,MACF,QACE,MAAM,IAAIoF,MAAM,iBAAD1G,OAAkB0S,IA+BrC,OACE/C,cAACmE,KAAK,CAAClP,MAAM,oBAAoBmL,MAAM,MAAMgE,UAAoBzS,IAAdoR,EAAyBsB,SAAUA,IAAMrB,IAAYsB,OAAQ,KAAKzE,SACnHF,eAACuD,KAAI,CAACD,KAAMA,EAAMD,SA9BNxR,IACd,QAAkBG,IAAdoR,EAAyB,OAC7B,MAAMxI,EAAM0I,EAAKsB,iBACjB,GAAmB,OAAfhK,EAAIiK,aAAsC7S,IAAnB4I,EAAIkK,WAC7B,OAGF,IAAI7N,EACJ,GAAkB,SAAdmM,GAAsC,aAAdA,EAC1BnM,EAAO,CAAEC,MAAOkM,EAAWrR,MAAO6I,EAAIkK,iBACjC,GAAkB,gBAAd1B,EACTnM,EAAO,CAAEC,MAAOkM,EAAWlP,aAAcsH,EAAiB9H,SAASkH,EAAIkK,YAAa3S,KAAMgC,cAAeyG,EAAIkK,gBACxG,IAAkB,UAAd1B,GAAuC,YAAdA,EAGlC,MAAM,IAAIhM,MAAM,iBAAD1G,OAAkB0S,IAFjCnM,EAAO,CAAEC,MAAOkM,EAAWrR,MAAOgT,WAAWnK,EAAIkK,YAAarS,YAGhE,CAEA4Q,EAAS,CACPpM,OACAtB,UAAW,IAAIZ,EAAU,CACvBC,SAAU4F,EAAIiK,OACd5P,QAAS2F,EAAIoK,WACb9P,SAAU0F,EAAIqK,qBAAkBjT,EAAY+C,EAAUK,kBAAkBgO,MAE1E,EAKoC8B,OAAO,WAAW5E,MAAO,CAAE6E,UAAW,GAAIC,aAAc,IAAMC,cAAc,EAAMvB,cAAeA,EAAc5D,SAAA,CACjJG,cAACkD,KAAK+B,KAAI,CAAanT,KAAK,aAAa4N,MAAOzK,EAAOiQ,UAAU,EAAMC,QAAQ,2BAA2BC,MAAO,CAAC,CAAEF,UAAU,EAAM1G,QAAS,0BAA2BqB,SACrK2D,IAEHxD,cAACkD,KAAK+B,KAAI,CAAanT,KAAK,SAAS4N,MAAM,YAAYwF,UAAU,EAAMC,QAAQ,2BAA2BC,MAAO,CAAC,CAAEF,UAAU,EAAM1G,QAAS,iBAAkBqB,SAC7JG,cAACwC,GAAU,CAACC,cAAejM,MAE7BwJ,cAACkD,KAAK+B,KAAI,CAAanT,KAAK,aAAa4N,MAAM,UAASG,SACtDG,cAAC8B,KAAMuD,SAAQ,CAACC,KAAM,MAExBtF,cAACkD,KAAK+B,KAAI,CAAanT,KAAK,kBAAkByT,cAAc,UAAS1F,SACnEG,cAACwF,IAAQ,CAAA3F,SAAC,2CAEZG,cAACkD,KAAK+B,KAAI,CAAApF,SACRF,eAACC,IAAK,CAAAC,SAAA,CACJG,cAACyF,IAAM,CAAC7J,KAAK,UAAU8J,SAAS,SAAQ7F,SAAC,SAGzCG,cAACyF,IAAM,CAACC,SAAS,SAASxD,QAASA,IAAMc,IAAWnD,SAAC,oBAMrD,EAIN6D,GAAmC,CACvCe,gBAAY9S,EACZ6S,OAAQ,KACRG,WAAY,GACZC,iBAAiB,GAWbd,GAAgB9O,IAAmG,IAAlG,YAAE8N,EAAW,MAAEzL,EAAK,mBAAEuM,GAAoC5O,EAC/E,MAAMoK,EAAU/H,EAAMzB,KAAK6B,IAAI,CAAQ2K,IAAK3K,EAAKnH,GAAIoP,MAAOjI,EAAK3F,SAWjE,MAAO,CAVWkO,cAAC0B,GAAc,CAACY,mBAAoBsB,EAAoBxE,QAASA,SAEjEzN,IAAhBmR,EACI,CACE2B,WAAY3B,EAAYhR,KACxB0S,OAAQ1B,EAAYpM,6BACpBiO,WAAY7B,EAAYxN,UAAU,GAAGV,QACrCgQ,iBAAiB,GAEnBlB,GAC2B,EAG7BM,GAAoB1M,IAAmG,IAAlG,YAAEwL,EAAW,MAAEzL,EAAK,mBAAEuM,GAAoCtM,EACnF,MAAM8H,EAAU/H,EAAMG,QAAQC,QAAwC9F,IAA/B8F,EAAKvB,aAAaY,WAAwBlB,KAAK6B,IAAI,CAAQ2K,IAAK3K,EAAKnH,GAAIoP,MAAOjI,EAAKvB,aAAaY,aAWzI,MAAO,CAVWkJ,cAAC0B,GAAc,CAACY,mBAAoBsB,EAAoBxE,QAASA,SAEjEzN,IAAhBmR,EACI,CACE2B,WAAY3B,EAAY5M,aAAaY,UAAY,GACjD0N,OAAQ1B,EAAYpM,6BACpBiO,WAAY7B,EAAYxN,UAAU,GAAGV,QACrCgQ,iBAAiB,GAEnBlB,GAC2B,EAG7BK,GAAuB4B,IAA2G,IAA1G,YAAE7C,EAAW,MAAEzL,EAAK,mBAAEuM,EAAkB,OAAEpO,GAAwBmQ,EAC1FvG,EAAUiE,IAAEC,OACdjM,EAAMkM,SAAS9L,GAASA,EAAKtB,uBAAsBqB,QAAQoO,QAAsCjU,IAA1BiU,EAAQ9R,gBAC/E,iBAEC+R,MAAK,CAACC,EAAGC,IAAMD,EAAElS,WAAamS,EAAEnS,aAChCgC,KAAKgG,IAAI,CAAQlK,MAAOkK,EAAK9H,cAAgB4L,MAAOlK,EAAO2F,iBAAiB9H,SAASuI,EAAK9H,eAAiBhC,SAC9G,MAAMkU,EAAoB,IAAIC,IAAI7G,EAAQxJ,KAAKgG,GAASA,EAAKlK,SAC7D0N,EAAUA,EAAQ/O,OAAOmF,EAAO2F,iBAAiB3D,QAAQoE,IAAUoK,EAAkB1I,IAAI1B,EAAKpJ,OAAMoD,KAAKgG,IAAI,CAAQlK,MAAOkK,EAAKpJ,IAAKkN,MAAO9D,EAAK9J,UAYlJ,MAAO,CAVWkO,cAACG,IAAM,CAACG,YAAY,EAAMlB,QAASA,EAASmB,iBAAiB,eAE7D5O,IAAhBmR,GAA6BA,EAAY3M,qBAAqB4B,OAAS,EACnE,CACE0M,WAAY3B,EAAY3M,qBAAqB,GAAGrC,cAChD0Q,OAAQ1B,EAAYpM,6BACpBiO,WAAY7B,EAAYxN,UAAU,GAAGV,QACrCgQ,iBAAiB,GAEnBlB,GAC2B,EAG7BQ,GAAmBgC,IAAsH,IAADC,EAAAC,EAAA,IAApH,YAAEtD,EAAW,MAAEzL,EAAK,mBAAEuM,EAAkB,OAAEpO,EAAM,UAAEpD,GAA2B8T,EAWrG,MAAO,CAVWlG,cAAC8B,KAAK,CAAClG,KAAK,gBAEZjK,IAAhBmR,GAA6BA,EAAY3M,qBAAqB4B,OAAS,EACnE,CACE0M,YAA+C,QAAnC0B,EAAArD,EAAYpN,aAAatD,UAAU,IAAA+T,GAAc,QAAdC,EAAnCD,EAAqC/R,oBAAY,IAAAgS,OAAd,EAAnCA,EAAmDC,QAAQ,KAAM,GAC7E7B,OAAQ1B,EAAYpM,6BACpBiO,WAAY7B,EAAYxN,UAAU,GAAGV,QACrCgQ,iBAAiB,GAEnBlB,GAC2B,EAG7BO,GAAiBqC,IAAsH,IAADC,EAAAC,EAAA,IAApH,YAAE1D,EAAW,MAAEzL,EAAK,mBAAEuM,EAAkB,OAAEpO,EAAM,UAAEpD,GAA2BkU,EAWnG,MAAO,CAVWtG,cAAC8B,KAAK,CAAClG,KAAK,gBAEZjK,IAAhBmR,GAA6BA,EAAY3M,qBAAqB4B,OAAS,EACnE,CACE0M,YAA+C,QAAnC8B,EAAAzD,EAAYpN,aAAatD,UAAU,IAAAmU,GAAY,QAAZC,EAAnCD,EAAqClS,kBAAU,IAAAmS,OAAZ,EAAnCA,EAAiDH,QAAQ,KAAM,GAC3E7B,OAAQ1B,EAAYpM,6BACpBiO,WAAY7B,EAAYxN,UAAU,GAAGV,QACrCgQ,iBAAiB,GAEnBlB,GAC2B,E,aCjOnC,MAAM+C,GAAM,CACVC,MAAO,CACL,eAAgB,CACdC,OAAQ,iBACRC,OAAQ,mBAGZC,WAAY,CACVC,OAAQ,WAEVC,YAAa,CACXC,gBAAgB,GAAD3W,OAAK4W,KAAO,GAAE,eAC7B,SAAU,CACRD,gBAAgB,GAAD3W,OAAK4W,KAAO,GAAE,kBAUtBC,GAAuBC,aAAWV,GAAXU,CAClCC,aAAS9X,IAA4F,IAA3F,UAAEwO,EAAS,UAAE1L,EAAS,QAAEiV,GAA6D/X,EAC7F,MAAMkG,EAASsJ,KACT,iBAAER,EAAgB,UAAED,EAAS,sBAAEjF,GAA0B5D,GACxDuN,EAAWuE,GAAgBhI,wBAAoC3N,IAC/D4V,EAAcC,GAAmBlI,mBAAsB,IAAI2G,KAI5DwB,EAF6C3J,EAAUzG,MAAMzB,KAAKtF,GAAOgO,EAAiBjN,IAAIf,KAExEkH,QAAQC,QAAkB9F,IAAT8F,IACvCJ,EAAQoQ,EAAajQ,QAAQC,GAAkB,OAATA,IACtCiQ,EAA6C,aAAjCpJ,EAAiB5B,MAAMhL,OAAwB+V,EAAa1P,SAAW+F,EAAUzG,MAAMU,OAEnG4P,EAAkBC,UACtB,MAIMC,EAAY,CAAC,CAAExQ,MAJG0D,MAAM+M,KAAKP,IAIY,CAAElQ,MAH9BA,EAAMzB,KAAK6B,GAASA,EAAKnH,KACPkH,QAAQlH,IAAQiX,EAAajK,IAAIhN,OAGhEwM,QAAe1D,EAAsBwE,kBAAkBiK,GAE7D,GAAIzV,GAAaA,EAAU9B,GAAI,CAC7B,MAAMyX,EAAc3V,EAAU9B,SACxB8I,EAAsBmD,aAAa,CAACuB,EAAUxN,IAAKwM,EAAQiL,GACjEvJ,IAAQwJ,QAAQ,6BAClB,GAGIC,EAAoBL,UACxB,MAAMM,EAAkBnN,MAAM+M,KAAKP,GAE7BY,EADa9Q,EAAMzB,KAAK6B,GAASA,EAAKnH,KACPkH,QAAQlH,IAAQiX,EAAajK,IAAIhN,KAIhE8X,EAAgB,IAFEF,EAAgBtS,KAAKtF,IAAE,CAAQ+G,MAAO,CAAC/G,UACrC6X,EAAkBpQ,OAAS,EAAI,CAAC,CAAEV,MAAO8Q,IAAuB,IAGpFrL,QAAe1D,EAAsBwE,kBAAkBwK,GAE7D,GAAIhW,GAAaA,EAAU9B,GAAI,CAC7B,MAAMyX,EAAc3V,EAAU9B,SACxB8I,EAAsBmD,aAAa,CAACuB,EAAUxN,IAAKwM,EAAQiL,GACjEvJ,IAAQwJ,QAAQ,6BAClB,GAGIK,EAAUjF,mBAAQ,IACf,CACL,CACEnO,MAAO,SACPmN,IAAK,SACLkG,OAAyB,IAAjBjR,EAAMU,OACdwQ,OAAQA,CAAClF,EAAQ5L,IACfuI,cAACwF,IAAQ,CACPgD,QAASjB,EAAajK,IAAI7F,EAAKnH,IAC/BkQ,SAAWuB,IACT,MAAM0G,EAAc,IAAIxC,IAAIsB,GACxBxF,EAAEhB,OAAOyH,QACXC,EAAYC,IAAIjR,EAAKnH,IAErBmY,EAAY7L,OAAOnF,EAAKnH,IAE1BkX,EAAgBiB,EAAY,KAKpC,CACExT,MACE0K,eAACgJ,IAAI,CAACC,QAAQ,gBAAe/I,SAAA,CAC3BG,cAAA,QAAAH,SAAM,SACNG,cAAC6I,IAAY,CAACC,UAAWzB,EAAQR,WAAY3E,QAASA,IAAMoF,EAAa,aAG7ElF,IAAK,OACLmG,OAAQA,CAAClF,EAAQ5L,IAEbuI,cAACF,IAAWe,KAAI,CAACC,KAAMrJ,EAAKjF,IAAKuO,OAAO,SAAQlB,SAC7CpI,EAAK3F,QAKd,CACEmD,MACE0K,eAACgJ,IAAI,CAACC,QAAQ,gBAAe/I,SAAA,CAC3BG,cAAA,QAAAH,SAAM,aACNG,cAAC6I,IAAY,CAACC,UAAWzB,EAAQR,WAAY3E,QAASA,IAAMoF,EAAa,iBAG7ElF,IAAK,WACLmG,OAAQA,CAAClF,EAAQ5L,IAEbuI,cAACF,IAAWC,KAAI,CAAC+I,UAAU,aAAaC,UAAU,EAAM9I,MAAO,CAAE+I,SAAU,KAAMnJ,SAC9EpI,EAAKvB,aAAaY,YAK3B,CACE7B,MAAO,MACPmN,IAAK,MACLmG,OAAQA,CAAClF,EAAQ5L,KAAuB,IAADwR,EACrC,OAAOjJ,cAAA,QAAAH,SAA4B,QAA5BoJ,EAAOxR,EAAKvB,aAAa4C,WAAG,IAAAmQ,OAAA,EAArBA,EAAuBpV,cAAoB,GAG7D,CACEoB,MAAO,UACPmN,IAAK,UACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAACgB,GAAmB,CAACC,SAAUxJ,EAAKvB,aAAa1C,WAG5D,CACEyB,MAAO,iBACPmN,IAAK,iBACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAACgB,GAAmB,CAACC,SAAUxJ,EAAKvB,aAAa0B,mBAG5D,CACE3C,MACE0K,eAACgJ,IAAI,CAACC,QAAQ,gBAAe/I,SAAA,CAC3BG,cAAA,QAAAH,SAAM,cACNG,cAAC6I,IAAY,CAACC,UAAWzB,EAAQR,WAAY3E,QAASA,IAAMoF,EAAa,oBAG7ElF,IAAK,eACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAACS,GAAe,CAACC,OAAQjJ,EAAKtB,qBAAqB,GAAIwK,MAAM,sBAGxE,CACE1L,MAAO,kBACPmN,IAAK,sBACLmG,OAAQA,CAAClF,EAAQ5L,IAC0B,IAArCA,EAAKtB,qBAAqB4B,OACrB,IAEFN,EAAKtB,qBAAqB,GAAGvC,WAAWyS,QAAQ,IAG3D,CACEpR,MACE0K,eAACgJ,IAAI,CAACC,QAAQ,gBAAe/I,SAAA,CAC3BG,cAAA,QAAAH,SAAM,iBACNG,cAAC6I,IAAY,CAACC,UAAWzB,EAAQR,WAAY3E,QAASA,IAAMoF,EAAa,gBAG7ElF,IAAK,UACLmG,OAAQA,CAAClF,EAAQ5L,KACf,MAAM/B,EAAe+B,EAAK/B,aAAatD,EAAU9B,IACjD,YAAqBqB,IAAjB+D,QAA4D/D,IAA9B+D,EAAatB,aACtC,IAEFsB,EAAatB,aAAaiS,QAAQ,EAAE,GAG/C,CACEpR,MACE0K,eAACgJ,IAAI,CAACC,QAAQ,gBAAe/I,SAAA,CAC3BG,cAAA,QAAAH,SAAM,cACNG,cAAC6I,IAAY,CAACC,UAAWzB,EAAQR,WAAY3E,QAASA,IAAMoF,EAAa,cAG7ElF,IAAK,QACLmG,OAAQA,CAAClF,EAAQ5L,KACf,MAAM/B,EAAe+B,EAAK/B,aAAatD,EAAU9B,IACjD,YAAqBqB,IAAjB+D,QAA0D/D,IAA5B+D,EAAarB,WACtC,IAEFqB,EAAarB,WAAWgS,QAAQ,EAAE,GAG7C,CACEpR,MAAO,YACPmN,IAAK,YACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAACkJ,GAAkB,CAACzR,KAAMA,OAItC,CAACrF,EAAU9B,GAAI+G,EAAMU,OAAQwP,EAAcI,IAE9CpI,qBAAU,KACRjB,EAAiBvB,WAAWe,EAAUzG,MAAM,GAC3C,CAACiH,IAEJ,MAwBMwE,EAAczL,EAAMuL,MAAMnL,GAASA,EAAKhC,UAAU0T,SAAS9K,EAAU9M,iBAAkBQ,OAE7F,IAAIqX,EACJ,GAAI7B,EAAanW,KAAO,GAAKiG,EAAMU,OAAS,EAAG,CAC7C,MAAMsR,EACJrJ,cAACyF,IAAM,CAAkB7J,KAAK,UAAUsG,QAAS+F,EAAkBpI,SAAC,sBAAxD,cAIRyJ,EACJtJ,cAACyF,IAAM,CAAgB7J,KAAK,UAAUsG,QAASyF,EAAgB9H,SAAC,oBAApD,YAKZuJ,EADwB,IAAtB7B,EAAanW,MAAcmW,EAAanW,OAASiG,EAAMU,OAC7C,CAACsR,GAED,CAACA,EAAaC,GAE5BF,EAAYpJ,cAACJ,IAAK,CAAAC,SAAEuJ,GACtB,CAEA,OACEzJ,eAACgJ,IAAI,CAACY,UAAU,EAAMC,IAAI,QAAO3J,SAAA,CAC9BuJ,EACDpJ,cAACyJ,IAAK,CACJX,UAAWzB,EAAQX,MACnBgD,UAAU,EACVC,YAAY,EACZvY,KAAK,QACLwY,OAAO,KACPvB,QAASA,EACTwB,WAAYxS,EACZyS,QAASpC,EACTqC,aAAetS,GACNA,EAAKhC,UAAU0T,SAAS9K,EAAU9M,iBAAkBQ,KAAOsV,EAAQN,YAAc,KAG5F/G,cAAC6C,GAAa,CAAiBxL,MAAOA,EAAOyL,YAAaA,EAAaC,UAAWA,EAAWC,SA9D3EgH,IACpB,QAAerY,IAAXqY,EAEF,YADA1C,OAAa3V,GAIf,MAAMsY,EAAc5L,EAAU9M,iBACxB2Y,EAAe7S,EAAMuL,MAAMnL,GAASA,EAAKhC,UAAU0T,SAASc,EAAYlY,OAC9E,IAAIoY,EACJ,QAAqBxY,IAAjBuY,EAA4B,CAC9B,MAAME,EAAYpT,EAAuBG,gBAAgB3B,EAAQsI,EAAWzG,EAAO4S,EAAY3Z,GAAI0Z,EAAO1U,WAC1G8U,EAAUzT,YAAYnB,EAAQwU,EAAOpT,KAAMoT,EAAO1U,WAClD6U,EAAK7L,EAAiBjF,qBAAqByE,EAAU1L,UAAWgY,EAClE,KAAO,CACL,MAAMA,EAAY,IAAI5R,EAAuB0R,GAC7CE,EAAUzT,YAAYnB,EAAQwU,EAAOpT,KAAMoT,EAAO1U,WAClD6U,EAAK7L,EAAiB3E,qBAAqBmE,EAAU1L,UAAWgY,EAClE,CAEAD,EAAG9a,MAAK,KACNiY,OAAa3V,EAAU,GACvB,EAyCqHS,UAAWA,EAAU9B,IAAtHyS,KACf,KAKPmG,GAAsDlU,IAAe,IAAd,KAAEyC,GAAMzC,EACnE,MAAMwB,EAAO4M,mBAAQ,IACZhJ,OAAO5I,OAAOiG,EAAKlB,2BACzB,CAACkB,IAEJ,OACEuI,cAACF,IAAWC,KAAI,CAACgJ,UAAU,EAAM9I,MAAO,CAAE+I,SAAU,KAAMnJ,SACvDwB,GACC7K,EAAKZ,KAAK8M,GACR1C,cAACF,IAAWe,KAAI,CAAeE,OAAO,SAASD,KAAM4B,EAAIlQ,IAAIqN,SAC1D6C,EAAIzN,OAASyN,EAAIlQ,KADEkQ,EAAIlQ,QAI3BY,GACC4M,cAAA,QAAAH,SAA2B,gBAAa,OAAAxP,OAAtB+C,OAGN,EC5STiX,GAAgC/a,IAA0B,IAAvBkD,IAAKA,EAAG,MAAEmO,GAAOrR,EAC/D,MACMkK,EADKsF,IAAY6B,GACLtP,IAAImB,GAEtB,OAAe,OAAXgH,EAEAwG,cAACF,IAAWe,KAAI,CAACC,KAAMtO,EAAKuO,OAAO,SAAQlB,SAAC,mBAMjClO,IAAX6H,EAEAwG,cAACF,IAAWe,KAAI,CAACC,KAAMtO,EAAKuO,OAAO,SAAQlB,SAAC,eAO9CG,cAACF,IAAWe,KAAI,CAACC,KAAMtO,EAAKuO,OAAO,SAAQlB,SACxCrG,EAAO1H,MACQ,EChBhBwY,GAAmB,CAAEnZ,QAAS,GAAI2B,MAAO,GAElCyX,GAA8DnD,aAAS9X,IAAoB,IAAnB,UAAE8C,GAAW9C,EAChG,MAAM,sBAAE8J,EAAqB,iBAAE+B,EAAgB,aAAEK,EAAY,qBAAEE,GAAyBoD,KACjF0L,EAAkBC,GAAuBnL,wBAA6B3N,IACtE+Y,EAAsBC,GAA2BrL,mBAAsB,IAAI2G,KAE5EoC,EAAUjF,mBAAQ,IACf,CACL,CACEnO,MAAO,GACPmN,IAAK,SACLmG,OAAQA,CAAClF,EAAQ5L,IAA2BuI,cAACwF,IAAQ,CAAChF,SAAWuB,GAAM6I,EAAgBnT,EAAMsK,EAAEhB,OAAOyH,SAAUA,QAASkC,EAAqBpN,IAAI7F,EAAKnH,MACvJua,OAAQA,CAAC/E,EAAqBC,IAAwBD,EAAEzO,MAAMU,OAASgO,EAAE1O,MAAMU,QAEjF,CACE9C,MAAO,OACP6V,UAAW,OACX1I,IAAK,OACLmG,OAAQA,CAAClF,EAAQ5L,IAEbuI,cAACF,IAAWe,KAAI,CAACC,KAAMrJ,EAAKjF,IAAKuO,OAAO,SAAQlB,SAC7CpI,EAAK3F,MAAQ,WAIpB+Y,OAAQA,CAAC/E,EAAqBC,IAAwBD,EAAEhU,KAAKiZ,cAAchF,EAAEjU,OAE/E,CACEmD,MAAO,OACPmN,IAAK,OACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAAA,QAAM8I,UAAU,aAAYjJ,SAAEpI,EAAKmE,OAE5CiP,OAAQA,CAAC/E,EAAqBC,IAAwBD,EAAElK,KAAKmP,cAAchF,EAAEnK,OAE/E,CACE3G,MAAO,OACPmN,IAAK,OACLmG,OAAQA,CAAClF,EAAQ5L,IACRuI,cAAA,QAAM8I,UAAU,aAAYjJ,SAAEpI,EAAKoE,OAE5CgP,OAAQA,CAAC/E,EAAqBC,IAAwBD,EAAEjK,KAAKkP,cAAchF,EAAElK,OAE/E,CACE5G,MAAO,WACPmN,IAAK,WACLmG,OAAQA,CAAC7W,EAAYoM,SACQnM,IAAvBmM,EAAUhH,eAAqDnF,IAA3BmM,EAAUhH,SAASsE,UAAgDzJ,IAA3BmM,EAAUhH,SAASuE,IAC3F,GAANhL,OAAUyN,EAAUhH,SAASsE,IAAIiL,QAAQ,GAAE,MAAAhW,OAAKyN,EAAUhH,SAASuE,IAAIgL,QAAQ,IAE1E,SAETwE,OAAQA,CAAC/E,EAAqBC,KAAyB,IAADiF,EAAAC,EAAAC,EAAAC,EACpD,MAAMC,EAAOtF,EAAEhP,SAAQ,GAAAzG,OAAoB,QAApB2a,EAAMlF,EAAEhP,SAASsE,WAAG,IAAA4P,OAAA,EAAdA,EAAgB3E,QAAQ,GAAE,KAAAhW,OAAkB,QAAlB4a,EAAInF,EAAEhP,SAASuE,WAAG,IAAA4P,OAAA,EAAdA,EAAgB5E,QAAQ,IAAO,GACpFgF,EAAOtF,EAAEjP,SAAQ,GAAAzG,OAAoB,QAApB6a,EAAMnF,EAAEjP,SAASsE,WAAG,IAAA8P,OAAA,EAAdA,EAAgB7E,QAAQ,GAAE,KAAAhW,OAAkB,QAAlB8a,EAAIpF,EAAEjP,SAASuE,WAAG,IAAA8P,OAAA,EAAdA,EAAgB9E,QAAQ,IAAO,GAC1F,OAAO+E,EAAKL,cAAcM,EAAK,GAGnC,CACEpW,MAAO,UACPmN,IAAK,UACLmG,OAAQA,CAAClF,EAAQ5L,SACO9F,IAAlB8F,EAAKX,UAA2D,IAAjCW,EAAKX,SAAStD,QAAQuE,OAChD,SAIPiI,cAACJ,IAAK,CAACxH,MAAO4H,cAACsL,IAAO,CAAC1P,KAAK,aAAciE,SACvCpI,EAAKX,SAAStD,QAAQoC,KAAKpC,GAC1BwM,cAACqK,GAAM,CAAe7X,IAAKgB,EAASmN,MAAM,gBAA7BnN,OAKrBqX,OAAQA,CAAC/E,EAAqBC,KAAyB,IAADwF,EAAAC,EACpD,MAAMC,GAAqB,QAAVF,EAAAzF,EAAEhP,gBAAQ,IAAAyU,OAAA,EAAVA,EAAY/X,QAAQoC,KAAK8V,GAAQlQ,EAAanI,SAASqY,GAAM5Z,OAAMuP,KAAK,OAAQ,GAC3FsK,GAAqB,QAAVH,EAAAzF,EAAEjP,gBAAQ,IAAA0U,OAAA,EAAVA,EAAYhY,QAAQoC,KAAK8V,GAAQlQ,EAAanI,SAASqY,GAAM5Z,OAAMuP,KAAK,OAAQ,GACjG,OAAOoK,EAASV,cAAcY,EAAS,GAG3C,CACE1W,MAAO,iBACPmN,IAAK,QACLmG,OAAQA,CAAClF,EAAQ5L,SACO9F,IAAlB8F,EAAKX,UAAmE,IAAzCW,EAAKX,SAASc,gBAAgBG,OACxD,SAIPiI,cAACJ,IAAK,CAACxH,MAAO4H,cAACsL,IAAO,CAAC1P,KAAK,aAAciE,SACvCpI,EAAKX,SAASc,gBAAgBhC,KAAKgW,GAClC5L,cAACqK,GAAM,CAAgB7X,IAAKoZ,EAAUjL,MAAM,wBAA/BiL,OAKrBf,OAAQA,CAAC/E,EAAqBC,KAAyB,IAAD8F,EAAAC,EACpD,MAAMC,GAAmB,QAAVF,EAAA/F,EAAEhP,gBAAQ,IAAA+U,OAAA,EAAVA,EAAYjU,gBAAgBhC,KAAK8V,GAAQhQ,EAAqBrI,SAASqY,GAAM5Z,OAAMuP,KAAK,OAAQ,GACzG2K,GAAmB,QAAVF,EAAA/F,EAAEjP,gBAAQ,IAAAgV,OAAA,EAAVA,EAAYlU,gBAAgBhC,KAAK8V,GAAQhQ,EAAqBrI,SAASqY,GAAM5Z,OAAMuP,KAAK,OAAQ,GAC/G,OAAO0K,EAAOhB,cAAciB,EAAO,GAGvC,CACE/W,MAAO,eACPmN,IAAK,cACLmG,OAAQA,CAAClF,EAAQ5L,KACf,MAAMwU,EAAKxU,EAAKO,qBAChB,YAAWrG,IAAPsa,EACK,SAEFjM,cAACqK,GAAM,CAAC7X,IAAKyZ,EAAGzZ,IAAKmO,MAAM,oBAAqB,EAEzDkK,OAAQA,CAAC/E,EAAqBC,KAAyB,IAADmG,EAAAC,EACpD,MAAMC,EAA4B,QAAzBF,EAAGpG,EAAE9N,4BAAoB,IAAAkU,OAAA,EAAtBA,EAAwB1Z,IAC9B6Z,EAA4B,QAAzBF,EAAGpG,EAAE/N,4BAAoB,IAAAmU,OAAA,EAAtBA,EAAwB3Z,IAC9B8Z,OAAkB3a,IAARya,EAAoBjR,EAAiB9H,SAAS+Y,GAAMta,KAAO,GACrEya,OAAkB5a,IAAR0a,EAAoBlR,EAAiB9H,SAASgZ,GAAMva,KAAO,GAC3E,OAAOwa,EAAQvB,cAAcwB,EAAQ,GAGzC,CACEtX,MAAO,aACPmN,IAAK,oBACLmG,OAAQA,CAAClF,EAAQ5L,KACf,MAAMwU,EAAKxU,EAAKO,qBAChB,YAAWrG,IAAPsa,EACK,SAEFA,EAAGrY,WAAWyS,QAAQ,EAAE,GAGnC,CACEpR,MAAO,eACP6V,UAAW,eACXvC,OAAQA,CAAClF,EAAQ5L,SACW9F,IAAtB8F,EAAK/B,mBAAiE/D,IAAnC8F,EAAK/B,aAAatB,aAChDqD,EAAK/B,aAAatB,aAAaiS,QAAQ,GAEzC,SAETwE,OAAQA,CAAC/E,EAAqBC,KAAyB,IAADyG,EAAAC,EAGpD,QAF+B,QAAdD,EAAA1G,EAAEpQ,oBAAY,IAAA8W,OAAA,EAAdA,EAAgBpY,eAAgB,KAClB,QAAdqY,EAAA1G,EAAErQ,oBAAY,IAAA+W,OAAA,EAAdA,EAAgBrY,eAAgB,EACvB,GAG9B,CACEa,MAAO,YACP6V,UAAW,aACXvC,OAAQA,CAAClF,EAAQ5L,SACW9F,IAAtB8F,EAAK/B,mBAA+D/D,IAAjC8F,EAAK/B,aAAarB,WAChDoD,EAAK/B,aAAarB,WAAWgS,QAAQ,GAEvC,SAETwE,OAAQA,CAAC/E,EAAqBC,KAAyB,IAAD2G,EAAAC,EAGpD,QAF6B,QAAdD,EAAA5G,EAAEpQ,oBAAY,IAAAgX,OAAA,EAAdA,EAAgBrY,aAAc,KAChB,QAAdsY,EAAA5G,EAAErQ,oBAAY,IAAAiX,OAAA,EAAdA,EAAgBtY,aAAc,EACvB,GAG1B,CACEY,MAAO,SACPmN,IAAK,SACLmG,OAAQA,CAAClF,EAAQ5L,IAEbuI,cAACJ,IAAK,CAAAC,SACJG,cAACyF,IAAM,CACLvF,MAAM,UACN9O,KAAK,SACLwb,KAAM5M,cAAC6I,IAAY,IACnBgE,QAAQ,SACR3K,QAASA,KACHzK,EAAKnH,KAAOka,EACdC,OAAoB9Y,GAEpB8Y,EAAoBhT,EAAKnH,GAC3B,EACAuP,SACH,cAQV,CAAU,OAATzN,QAAS,IAATA,OAAS,EAATA,EAAW9B,GAAIkL,EAAcE,EAAsBgP,EAAsBF,IAE7EjL,qBAAU,KACUqI,gBACEjW,IAAdS,SACIgH,EAAsBiE,iBAAiBjL,EAC/C,EAEF0a,EAAW,GACV,CAAC1a,EAAWgH,IAEf,MAAMwR,EAAkBA,CAACnT,EAAwBsV,KAC/C,MAAMC,EAA0B,IAAI/G,IAAIyE,GACpCqC,EACFC,EAAwBtE,IAAIjR,EAAKnH,IAEjC0c,EAAwBpQ,OAAOnF,EAAKnH,IAEtCqa,EAAwBqC,EAAwB,EAsB5CtF,EAAkD,aAAtCtO,EAAsBsD,MAAMhL,MACxCub,OAAkCtb,IAAdS,GAA2BsV,EAAY4C,GAAmBlR,EAAsBmE,eAAenL,GAEzH,OACEuN,eAAAyB,WAAA,CAAAvB,SAAA,CACG6K,EAAqBtZ,KAAO,EACzB,CACE4O,cAAA,OAAAH,SACEG,cAACyF,IAAM,CAAC7J,KAAK,UAAUsG,QA3Bf0F,UAClB,MAAM/K,EAAU9B,MAAM+M,KAAK4C,GAGrBwC,EAAgB,CACpB,CACE7V,MAJe0D,MAAM+M,KAAK4C,GAAsBnH,SAAS4J,GAAgB/T,EAAsB/H,IAAI8b,GAAc9V,MAAMzB,KAAKwX,GAAYzR,EAAiBG,MAAMsR,SAO7JtQ,QAAe1D,EAAsBwE,kBAAkBsP,GAE7D,GAAI9a,GAAaA,EAAU9B,GAAI,CAC7B,MAAMyX,EAAc3V,EAAU9B,GAC9BkO,IAAQwJ,QAAQ,0BAA2B,GAC3C2C,EAAwB,IAAI1E,WACtB7M,EAAsBmD,aAAaM,EAASC,EAAQiL,EAC5D,GAWuDsF,SAAwC,IAA9B3C,EAAqBtZ,KAAWyO,SAAC,2BAI1FG,cAACyJ,IAAK,CACJC,UAAU,EACVtY,KAAK,QACLwY,OAAO,KACPD,YAAY,EACZtB,QAAS,CACP,CACEpT,MAAO,GACPmN,IAAK,QACLmG,OAAQA,CAAClF,EAAQ5L,IAA2BuI,cAACwF,IAAQ,CAAC5J,KAAK,UAAU4M,SAAS,EAAMtG,QAASA,IAAM0I,EAAgBnT,GAAM,SAExH4Q,EAAQiF,MAAM,IAEnBzD,WAAY9O,MAAM+M,KAAK4C,GAAsB9U,KAAKtF,GAAO8I,EAAsB/H,IAAIf,QAGvF,GACJ0P,cAACyJ,IAAK,CACJC,UAAU,EACVtY,KAAK,QACLwY,OAAO,KACPvB,QAASA,EACTwB,WAAYoD,EAAkB9b,QAC9B2Y,UAASpC,GAAY,CAAEtW,KAAM,SAC7Bmc,WAAY,CACVC,kBAAoB/V,GACd+S,IAAqB/S,EAAKnH,GACrB0P,cAACkH,GAAoB,CAAC9U,UAAWA,EAAY0L,UAAWrG,IAE1D,KAETgW,kBAAkB,EAClBC,gBAAiB,IAAKlD,EAAmB,CAACA,GAAoB,SAGjE,IC7RMmD,GAAWvG,aAAS,KAC/B,MAAOlI,EAAY0O,EAAgBzO,GT0E9B,WACL,MAAM,eAAExJ,GAAmBmJ,KACpB+O,EAAMC,GAAWxO,mBAAqB,CAC3ClN,eAAWT,IAOPoc,EAA2B3K,mBAAQ,KACvC,QAAuBzR,IAAnBkc,EAAKzb,UACP,MAAO,CACLA,eAAWT,GAGf,MAAMS,EAAYuD,EAAepD,UAAUsb,EAAKzb,WAChD,MAAO,CACLA,UAAyB,OAAdA,OAAqBT,EAAYS,EAC7C,GACA,CAACuD,EAAexE,QAAQC,KAAMyc,EAAKzb,YAEtC,MAAO,CAACyb,EAAME,EAhBYC,IACxBF,EAAQE,EAAQ,EAgBpB,CSjGsDC,GAEpD,OACEtO,eAACgJ,IAAI,CAACY,UAAU,EAAMC,IAAI,QAAO3J,SAAA,CAC/BG,cAACf,EAAS,CAACC,WAAYA,EAAYC,cAAeA,IAClDa,cAACuK,GAAqB,CAACnY,UAAWwb,EAAexb,cAC5C,I,qBCNX,MAAMqU,GAAM,CACVyH,aAAc,CACZC,eAAgB,SAChBC,UAAW,qBAEbC,WAAY,CACV,iBAAkB,CAChBC,aAAc,kBACdC,WAAY,mBAEd,uBAAwB,CACtBD,aAAc,kBACdC,WAAY,mBAEd,cAAe,CACbC,OAAQ,GACRC,aAAc,EACd3J,WAAY,GAEd4J,YAAa,GACbC,aAAc,GACdP,UAAW,sBA6CFQ,IAzBezH,aAAWV,GAAXU,EAAgB7X,IAAiJ,IAAtG,QAAE+X,EAAO,MAAEwH,EAAK,OAAEC,EAAM,UAAEhG,EAAS,MAAE7I,EAAK,gBAAE8O,GAAoDzf,EACrL,MAAMwH,EAAWkY,cAKXnc,EAAQuH,OAAO6U,KAAKJ,GAAOjZ,KAAI,CAACsZ,EAAW9b,IAExC+b,GAAYD,GADmB,IAApBH,GAAsC,IAAV3b,EAAc,OAAS,GAC5Byb,EAAMK,MAE3CE,EAAkBC,YAAmBvY,EAAUgY,GAErD,OACE9O,cAACsP,KAAI,CACHC,KAAK,aACLzG,UAAWzB,EAAQ6G,mBAA8Bvc,IAAdmX,EAA0B,IAAMA,EAAY,IAC/E7I,MAAOA,EACPiC,QAfcH,IAChB+M,EAAO/M,EAAEK,KAAKoN,KAAK,CAAC,EAAG,CAAC,GAAGpL,MAAM,EAe/BqL,kBAAkC9d,IAApByd,EAAgC,CAACA,QAAmBzd,EAAUkO,SAE3EhN,GACI,IAIesU,aAAWV,GAAXU,EAAgBnS,IAAiJ,IAAtG,QAAEqS,EAAO,MAAEwH,EAAK,OAAEC,EAAM,UAAEhG,EAAS,MAAE7I,EAAK,gBAAE8O,GAAoD/Z,EACnL,MAAM8B,EAAWkY,cAKXnc,EAAQuH,OAAO6U,KAAKJ,GAAOjZ,KAAI,CAACsZ,EAAW9b,IAExC+b,GAAYD,GADmB,IAApBH,GAAsC,IAAV3b,EAAc,OAAS,GAC5Byb,EAAMK,MAE3CE,EAAkBC,YAAmBvY,EAAUgY,GAErD,OACE9O,cAACsP,KAAI,CACHC,KAAK,aACLzG,UAAWzB,EAAQgH,iBAA4B1c,IAAdmX,EAA0B,IAAMA,EAAY,IAC7E7I,MAAOA,EACPiC,QAfcH,IAChB+M,EAAO/M,EAAEK,KAAKoN,KAAK,CAAC,EAAG,CAAC,GAAGpL,MAAM,EAe/BqL,kBAAkC9d,IAApByd,EAAgC,CAACA,QAAmBzd,EAAUkO,SAE3EhN,GACI,KAIX,SAASsc,GAAY/M,EAAa0G,EAAmBnH,GACnD,IAAI9B,EAAU6P,EAEd,GAAqB,kBAAV/N,EACT9B,EAAW8B,OACN,GAAI5C,IAAM4Q,eAAehO,GAC9B9B,EAAW8B,MACN,CACL,MAAQ9B,SAAU+P,KAAcC,GAAelO,EAC/C9B,EAAW+P,EACXF,EAAYG,CACd,CAEA,OACE7P,cAACsP,KAAKrK,KAAI,CAAC6D,UAAWA,KAAyB4G,EAAS7P,SACrDA,GADmCuC,EAI1C,CC5GO,MAAM0N,GAAyB1I,aAAS9X,IAA+C,IAA9C,SAAEuQ,GAAsCvQ,EACtF,MAAM,UAAE+O,GAAcS,IAWtB,OARAS,qBAAU,KACRlB,EAAUnN,aAAa7B,MAAM6B,IACtBA,GACH4d,GAAOve,MAAMif,OAAOpL,MACtB,GACA,GACD,CAAC/F,IAEGwB,CAAQ,ICoBJiP,GAAS,CACpBve,MAAO,IAAIwf,IAAc,CACvBC,UCpCqBC,KACvB,MAAM,UAAE5R,GAAcS,KAEftO,EAAU0f,GAAe5Q,mBAAiB,KAC1C7O,EAAU0f,GAAe7Q,mBAAiB,KAC1CpC,EAAOkT,GAAY9Q,mBAAiB,IAE3CC,qBAAU,KACRlB,EAAUnN,aAAa7B,MAAM6B,IACvBA,GAAY4d,GAAOuB,KAAKb,KAAK,CAAEpd,eAAWT,IAAayS,MAAM,GACjE,GACD,CAAC/F,IAYJ,OACEsB,eAAA,OAAKmJ,UAAU,kBAAiBjJ,SAAA,CAC9BG,cAAA,MAAAH,SAAI,UACJF,eAAA,QAAM2Q,SAbU1I,UAClB2I,EAAMC,iBACN,UACQnS,EAAU9N,MAAMC,EAAUC,GAChCqe,GAAOuB,KAAKb,KAAK,CAAEpd,eAAWT,IAAayS,MAC7C,CAAE,MAAO9S,GACP8e,EAAS,6CACX,GAM+BtH,UAAU,aAAYjJ,SAAA,CACjDF,eAAA,OAAKmJ,UAAU,aAAYjJ,SAAA,CACzBG,cAAA,SAAOyQ,QAAQ,WAAU5Q,SAAC,cAC1BG,cAAA,SAAOpE,KAAK,OAAOtL,GAAG,WAAWoB,MAAOlB,EAAUgQ,SAAWuB,GAAMmO,EAAYnO,EAAEhB,OAAOrP,OAAQwT,UAAQ,OAE1GvF,eAAA,OAAKmJ,UAAU,aAAYjJ,SAAA,CACzBG,cAAA,SAAOyQ,QAAQ,WAAU5Q,SAAC,cAC1BG,cAAA,SAAOpE,KAAK,WAAWtL,GAAG,WAAWoB,MAAOjB,EAAU+P,SAAWuB,GAAMoO,EAAYpO,EAAEhB,OAAOrP,OAAQwT,UAAQ,OAE7GhI,GAAS8C,cAAA,KAAG8I,UAAU,gBAAejJ,SAAE3C,IACxC8C,cAAA,UAAQpE,KAAK,SAASkN,UAAU,eAAcjJ,SAAC,eAI7C,EDHN6Q,QAAQ,GAADrgB,OAAKL,EAAU,UACtB2gB,OAAO,IAETN,KAAM,IAAIO,IAAiB,CACzBZ,UAAWrC,GACX+C,QAAQ,GAADrgB,OAAKL,EAAU,KACtB2gB,OAAO,EACPE,YAAa,CACXze,UAAW,qBAIhBqM,OAAeqS,QAAUhC,GAG1BiC,YAAYjC,IA5CWkB,GACbrO,IACN,MAAMqP,EAAUjS,IAAMkS,cAAcjB,EAAWrO,GAE/C,OACEhC,eAACC,IAAK,CAACsR,UAAU,WAAWjR,MAAO,CAAEG,MAAO,QAASP,SAAA,CACnDG,cAAC4O,GAAU,CACTC,MAAO,CACLwB,KAAMrQ,cAAA,QAAAH,SAAM,mBAEdiP,OAAQA,GACRC,iBAAiB,IAEnB/O,cAAC8P,GAAsB,CAAAjQ,SACrBG,cAAA,OAAK8I,UAAU,iBAAgBjJ,SAAEmR,QAE7B,GA4Bc,CAAC,U,kCEtDtB,MAAMG,GAAwB7hB,IAA+C,IAA9C,SAAEuQ,GAAsCvQ,EAK5E,OAJAiQ,qBAAU,KfqCH6R,QAAQC,IAAI,CAAC7b,EAAO2F,iBAAiB7H,WAAYkC,EAAOgG,aAAalI,WAAYkC,EAAOkG,qBAAqBpI,YepC3F,GACtB,IAEIuM,CAAQ,Ef6BRuR,QAAQE,UgB3BJjiB,MAAK,KAChBkiB,IAAShJ,OACPvI,cAACpB,EAAa4S,SAAQ,CAAC9f,MAAO8D,EAAOqK,SACnCG,cAACyR,KAAc,CAACC,OAAQC,KAAS9R,SAC/BG,cAACmR,GAAqB,CAAAtR,SACpBG,cAAC4R,IAAG,CAACC,YAAY,EAAM/C,OAAQA,WAIrCna,SAASmd,eAAe,QACzB,IAMH5iB,G","file":"static/js/main.6081a431.chunk.js","sourcesContent":["import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","export const THEME: \"dark\" | \"light\" = \"light\";\n\nexport const PLATFORM: \"native\" | \"web\" = process.env.REACT_APP_PLATFORM === \"native\" ? \"native\" : \"web\";\n\n// url of the API server\nexport const SERVER: string = process.env.REACT_APP_PLATFORM === \"native\" ? (process.env.REACT_APP_API_SERVER as string) : \"\";\n\n// path to the static directory for serving either local or remote css/js/assets\nexport const PUBLIC_URL: string = process.env.PUBLIC_URL;\n","import { RStore } from \"gena-app\";\nimport { SERVER } from \"../../env\";\nimport { runInAction } from \"mobx\";\nimport axios from \"axios\";\n\nexport interface User {\n  id: string;\n  url: string;\n  email: string;\n  name: string;\n}\n\nexport class UserStore extends RStore<string, User> {\n  constructor() {\n    super(`${SERVER}/api/v1`, { id: \"username\" }, false);\n  }\n\n  async login(username: string, password: string) {\n    let resp = await axios.post(`${SERVER}/api/v1/login`, { username, password });\n    return runInAction(() => {\n      this.set(this.deserialize(resp.data));\n    });\n  }\n\n  async isLoggedIn(): Promise<boolean> {\n    if (this.records.size > 0) {\n      return true;\n    }\n\n    try {\n      let resp = await axios.get(`${SERVER}/api/v1/whoami`);\n      runInAction(() => {\n        this.set(this.deserialize(resp.data));\n      });\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  public getCurrentUser(): User | undefined {\n    if (this.records.size === 0) return undefined;\n    return this.records.values().next().value || undefined;\n  }\n\n  public deserialize(obj: any): User {\n    return {\n      id: obj.username,\n      email: obj.email,\n      name: obj.name,\n      url: `https://minmod.isi.edu/users/${obj.username}`,\n    };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface Commodity {\n  id: string; // not the URI, e.g. \"Q578\"\n  uri: string;\n  name: string;\n  isCritical: number;\n}\n\nexport class CommodityStore extends RStore<string, Commodity> {\n  constructor() {\n    super(`${SERVER}/api/v1/commodities`, undefined, false);\n  }\n\n  async fetchCriticalCommotities() {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n\n    const records = [];\n    for (const commodity of this.records.values()) {\n      if (commodity !== null && commodity.isCritical) {\n        records.push(commodity);\n      }\n    }\n    return records;\n  }\n\n  public getByName(name: string): Commodity | undefined | null {\n    if (this.records.size === 0) {\n      return undefined;\n    }\n\n    for (const commodity of this.records.values()) {\n      if (commodity !== null && commodity.name === name) {\n        return commodity;\n      }\n    }\n    return null;\n  }\n\n  public deserialize(obj: any): Commodity {\n    return {\n      id: obj.uri.substring(obj.uri.lastIndexOf(\"/\") + 1),\n      uri: obj.uri,\n      name: obj.name,\n      isCritical: obj.is_critical,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse, SingleKeyUniqueIndex } from \"gena-app\";\nimport { SERVER } from \"../../env\";\nimport { InternalID } from \"models/typing\";\n\nexport interface DepositType {\n  id: InternalID; // it is the URI\n  uri: string;\n  name: string;\n  environment: string;\n  group: string;\n}\n\nexport class DepositTypeStore extends RStore<InternalID, DepositType> {\n  constructor() {\n    super(`${SERVER}/api/v1/deposit-types`, undefined, false, [new SingleKeyUniqueIndex(\"name\", \"id\"), new SingleKeyUniqueIndex(\"uri\", \"id\")]);\n  }\n\n  get name2id() {\n    return this.indices[0] as SingleKeyUniqueIndex<string, string, DepositType>;\n  }\n\n  get uri2id() {\n    return this.indices[1] as SingleKeyUniqueIndex<string, string, DepositType>;\n  }\n\n  public getByName(name: string): DepositType | undefined {\n    let id = this.name2id.index.get(name);\n    return id === undefined ? undefined : this.records.get(id)!;\n  }\n\n  public getByURI(uri: string): DepositType | undefined {\n    let id = this.uri2id.index.get(uri);\n    return id === undefined ? undefined : this.records.get(id)!;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): DepositType {\n    return {\n      ...obj,\n      id: obj.uri,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface Country {\n  id: string; // it is the URI\n  name: string;\n}\n\nexport class CountryStore extends RStore<string, Country> {\n  constructor() {\n    super(`${SERVER}/api/v1/countries`, undefined, false);\n  }\n\n  public getByURI(uri: string): Country | undefined {\n    const country = this.records.get(uri);\n    if (country === null) return undefined;\n    return country;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): Country {\n    return {\n      id: obj.uri,\n      name: obj.name,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","import { RStore, FetchResponse } from \"gena-app\";\nimport { SERVER } from \"../../env\";\n\nexport interface StateOrProvince {\n  id: string; // it is the URI\n  name: string;\n}\n\nexport class StateOrProvinceStore extends RStore<string, StateOrProvince> {\n  constructor() {\n    super(`${SERVER}/api/v1/states-or-provinces`, undefined, false);\n  }\n\n  public getByURI(uri: string): StateOrProvince | undefined {\n    const country = this.records.get(uri);\n    if (country === null) return undefined;\n    return country;\n  }\n\n  async fetchAll(): Promise<void> {\n    if (this.refetch || this.records.size === 0) {\n      await this.fetch({});\n    }\n  }\n\n  public deserialize(obj: any): StateOrProvince {\n    return {\n      id: obj.uri,\n      name: obj.name,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: resp.data, total: resp.total };\n  }\n}\n","export class CandidateEntity {\n  source: string;\n  confidence: number;\n  observedName?: string;\n  normalizedURI?: string;\n\n  public constructor({ source, confidence, observedName, normalizedURI }: { source: string; confidence: number; observedName?: string; normalizedURI?: string }) {\n    this.source = source;\n    this.confidence = confidence;\n    this.observedName = observedName;\n    this.normalizedURI = normalizedURI;\n  }\n\n  public clone(): CandidateEntity {\n    return new CandidateEntity({\n      source: this.source,\n      confidence: this.confidence,\n      observedName: this.observedName,\n      normalizedURI: this.normalizedURI,\n    });\n  }\n\n  public static deserialize(obj: any): CandidateEntity {\n    return new CandidateEntity({\n      source: obj.source,\n      confidence: obj.confidence,\n      observedName: obj.observed_name,\n      normalizedURI: obj.normalized_uri,\n    });\n  }\n\n  public serialize(): object {\n    return {\n      source: this.source,\n      confidence: this.confidence,\n      observed_name: this.observedName,\n      normalized_uri: this.normalizedURI,\n    };\n  }\n}\n","import { InternalID } from \"models/typing\";\n\nexport class GradeTonnage {\n  commodity: InternalID; // ID not URI\n  totalTonnage?: number;\n  totalGrade?: number;\n  totalContainedMetal?: number;\n\n  public constructor({ commodity, totalTonnage, totalGrade, totalContainedMetal }: { commodity: InternalID; totalTonnage?: number; totalGrade?: number; totalContainedMetal?: number }) {\n    this.commodity = commodity;\n    this.totalTonnage = totalTonnage;\n    this.totalGrade = totalGrade;\n    this.totalContainedMetal = totalContainedMetal;\n  }\n\n  public clone(): GradeTonnage {\n    return new GradeTonnage({\n      commodity: this.commodity,\n      totalTonnage: this.totalTonnage,\n      totalGrade: this.totalGrade,\n      totalContainedMetal: this.totalContainedMetal,\n    });\n  }\n\n  public static deserialize(obj: any): GradeTonnage {\n    return new GradeTonnage({\n      commodity: obj.commodity,\n      totalTonnage: obj.total_tonnage,\n      totalGrade: obj.total_grade,\n      totalContainedMetal: obj.total_contained_metal,\n    });\n  }\n}\n","export class Reference {\n  document: Document;\n  comment: string;\n  property?: string;\n  // pageInfo: PageInfo[];\n\n  public constructor({\n    document,\n    comment,\n    property,\n  }: {\n    document: Document;\n    comment: string;\n    property?: string;\n    // pageInfo: PageInfo[]\n  }) {\n    this.document = document;\n    this.comment = comment;\n    this.property = property;\n    // this.pageInfo = pageInfo;\n  }\n\n  public clone(): Reference {\n    return new Reference({\n      document: this.document.clone(),\n      comment: this.comment,\n      property: this.property,\n      // pageInfo: this.pageInfo\n    });\n  }\n\n  public static deserialize(obj: any): Reference {\n    obj = {\n      ...obj,\n      document: Document.deserialize(obj.document),\n    };\n    return new Reference(obj);\n  }\n\n  public serialize(): object {\n    return {\n      document: this.document.serialize(),\n      comment: this.comment,\n      property: this.property,\n      // pageInfo: this.pageInfo\n    };\n  }\n\n  public static normalizeProperty(property: \"name\" | \"location\" | \"depositType\" | \"grade\" | \"tonnage\"): string {\n    switch (property) {\n      case \"name\":\n        return \"http://www.w3.org/2000/01/rdf-schema#label\";\n      case \"location\":\n        return \"https://minmod.isi.edu/ontology/location\";\n      case \"depositType\":\n        return \"https://minmod.isi.edu/ontology/deposit_type\";\n      case \"grade\":\n        return \"https://minmod.isi.edu/ontology/grade\";\n      case \"tonnage\":\n        return \"https://minmod.isi.edu/ontology/ore\";\n      default:\n        return \"\";\n    }\n  }\n}\n\nexport class Document {\n  uri: string;\n  title?: string;\n\n  public constructor({ uri, title }: { uri: string; title?: string }) {\n    this.uri = uri;\n    this.title = title;\n  }\n\n  public clone(): Document {\n    return new Document({ uri: this.uri, title: this.title });\n  }\n  public static deserialize(obj: any): Document {\n    return new Document({\n      uri: obj.uri,\n      title: obj.title,\n    });\n  }\n  public serialize(): object {\n    return {\n      uri: this.uri,\n      title: this.title,\n    };\n  }\n}\n\n// export interface PageInfo {\n//   page: number;\n// }\n","import { IStore } from \"models\";\nimport { CandidateEntity } from \"./CandidateEntity\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { Reference } from \"./Reference\";\n\nexport class MineralInventory {\n  category: CandidateEntity[];\n  commodity: CandidateEntity;\n  grade?: Measure;\n  ore?: Measure;\n  reference: Reference;\n\n  public constructor({ category, commodity, grade, ore, reference }: { category: CandidateEntity[]; commodity: CandidateEntity; grade?: Measure; ore?: Measure; reference: Reference }) {\n    this.category = category;\n    this.commodity = commodity;\n    this.grade = grade;\n    this.ore = ore;\n    this.reference = reference;\n  }\n\n  public static fromGradeTonnage(stores: IStore, createdBy: string, gradeTonnage: GradeTonnage, reference: Reference): MineralInventory {\n    const commodity = stores.commodityStore.get(gradeTonnage.commodity)!;\n\n    return new MineralInventory({\n      category: [\"Inferred\", \"Indicated\", \"Measured\"].map(\n        (name) => new CandidateEntity({ source: createdBy, confidence: 1.0, observedName: name, normalizedURI: \"https://minmod.isi.edu/resource/\" + name })\n      ),\n      commodity: new CandidateEntity({\n        source: createdBy,\n        confidence: 1.0,\n        observedName: commodity.name,\n        normalizedURI: commodity.uri,\n      }),\n      grade:\n        gradeTonnage.totalGrade === undefined\n          ? undefined\n          : new Measure({\n              value: gradeTonnage.totalGrade,\n              unit: new CandidateEntity({\n                source: createdBy,\n                confidence: 1.0,\n                observedName: \"%\",\n                normalizedURI: \"https://minmod.isi.edu/resource/Q201\",\n              }),\n            }),\n      ore:\n        gradeTonnage.totalTonnage === undefined\n          ? undefined\n          : new Measure({\n              value: gradeTonnage.totalTonnage,\n              unit: new CandidateEntity({\n                source: createdBy,\n                confidence: 1.0,\n                observedName: \"%\",\n                normalizedURI: \"https://minmod.isi.edu/resource/Q202\",\n              }),\n            }),\n      reference: reference,\n    });\n  }\n\n  public static deserialize(obj: any): MineralInventory {\n    return new MineralInventory({\n      category: obj.category === undefined ? [] : obj.category.map(CandidateEntity.deserialize),\n      commodity: CandidateEntity.deserialize(obj.commodity),\n      grade: obj.grade === undefined ? undefined : Measure.deserialize(obj.grade),\n      ore: obj.ore === undefined ? undefined : Measure.deserialize(obj.ore),\n      reference: Reference.deserialize(obj.reference),\n    });\n  }\n}\n\nexport class Measure {\n  value: number;\n  unit: CandidateEntity;\n\n  public constructor({ value, unit }: { value: number; unit: CandidateEntity }) {\n    this.value = value;\n    this.unit = unit;\n  }\n\n  public static deserialize(obj: any): Measure {\n    return new Measure({\n      value: obj.value,\n      unit: CandidateEntity.deserialize(obj.unit),\n    });\n  }\n}\n","import { CandidateEntity } from \"./CandidateEntity\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { LocationInfo } from \"./LocationInfo\";\nimport { Reference, Document } from \"./Reference\";\nimport { DedupMineralSite, DedupMineralSiteLocation } from \"models/dedupMineralSite\";\nimport { DepositTypeStore } from \"models/depositType\";\nimport { StateOrProvinceStore } from \"models/stateOrProvince\";\nimport { CountryStore } from \"models/country\";\nimport { MineralInventory } from \"./MineralInventory\";\nimport { IStore } from \"models\";\nimport { InternalID } from \"models/typing\";\n\nexport type EditableField = \"name\" | \"location\" | \"depositType\" | \"grade\" | \"tonnage\";\nexport type FieldEdit =\n  | { field: \"name\"; value: string }\n  | { field: \"location\"; value: string }\n  | { field: \"depositType\"; observedName: string; normalizedURI: string }\n  | {\n      field: \"grade\";\n      value: number;\n      commodity: string;\n    }\n  | { field: \"tonnage\"; value: number; commodity: string };\n\nexport type MineralSiteConstructorArgs = {\n  id: InternalID;\n  recordId: string;\n  sourceId: string;\n  dedupSiteURI: string;\n  createdBy: string[];\n  name: string;\n  locationInfo: LocationInfo;\n  depositTypeCandidate: CandidateEntity[];\n  reference: Reference[];\n  sameAs: string[];\n  gradeTonnage: { [commodity: string]: GradeTonnage };\n  mineralInventory: MineralInventory[];\n};\n\nexport class MineralSite {\n  id: InternalID;\n  sourceId: string;\n  recordId: string;\n  dedupSiteURI: string;\n  createdBy: string[];\n  name: string;\n  locationInfo: LocationInfo;\n  depositTypeCandidate: CandidateEntity[];\n  reference: Reference[];\n  sameAs: string[];\n  gradeTonnage: { [commodity: string]: GradeTonnage };\n  mineralInventory: MineralInventory[];\n\n  public constructor({ id, recordId, sourceId, createdBy, name, locationInfo, depositTypeCandidate, reference, sameAs, gradeTonnage, dedupSiteURI, mineralInventory }: MineralSiteConstructorArgs) {\n    this.id = id;\n    this.recordId = recordId;\n    this.sourceId = sourceId;\n    this.dedupSiteURI = dedupSiteURI;\n    this.createdBy = createdBy;\n    this.name = name;\n    this.locationInfo = locationInfo;\n    this.depositTypeCandidate = depositTypeCandidate;\n    this.reference = reference;\n    this.sameAs = sameAs;\n    this.gradeTonnage = gradeTonnage;\n    this.mineralInventory = mineralInventory;\n  }\n\n  get uri(): string {\n    return `https://minmod.isi.edu/resource/${this.id}`;\n  }\n\n  getReferencedDocuments(): { [uri: string]: Document } {\n    const docs: { [uri: string]: Document } = {};\n    for (const ref of this.reference) {\n      docs[ref.document.uri] = ref.document;\n    }\n    return docs;\n  }\n\n  getFirstReferencedDocument(): Document {\n    return this.reference[0].document;\n  }\n\n  updateField(stores: IStore, edit: FieldEdit, reference: Reference) {\n    switch (edit.field) {\n      case \"name\":\n        this.name = edit.value;\n        break;\n      case \"location\":\n        this.locationInfo.location = edit.value;\n        break;\n      case \"depositType\":\n        this.depositTypeCandidate = [\n          new CandidateEntity({\n            source: this.createdBy[0], // this works because createdBy is a single item array for experts\n            confidence: 1.0,\n            normalizedURI: edit.normalizedURI,\n            observedName: edit.observedName,\n          }),\n        ];\n        break;\n      case \"grade\":\n        if (this.gradeTonnage[edit.commodity] === undefined) {\n          this.gradeTonnage[edit.commodity] = new GradeTonnage({\n            commodity: edit.commodity,\n            totalGrade: edit.value,\n            totalTonnage: 0.0,\n          });\n        } else {\n          this.gradeTonnage[edit.commodity].totalGrade = edit.value;\n          if (this.gradeTonnage[edit.commodity].totalTonnage === undefined) {\n            this.gradeTonnage[edit.commodity].totalTonnage = 0.0;\n          }\n        }\n\n        this.mineralInventory = [MineralInventory.fromGradeTonnage(stores, this.createdBy[0], this.gradeTonnage[edit.commodity], reference)];\n        break;\n      case \"tonnage\":\n        if (this.gradeTonnage[edit.commodity] === undefined) {\n          this.gradeTonnage[edit.commodity] = new GradeTonnage({\n            commodity: edit.commodity,\n            totalTonnage: edit.value,\n            // set the grade to be very small, so the server is not going to discard this record\n            totalGrade: 0.000000001,\n          });\n        } else {\n          this.gradeTonnage[edit.commodity].totalTonnage = edit.value;\n          if (this.gradeTonnage[edit.commodity].totalGrade === undefined) {\n            this.gradeTonnage[edit.commodity].totalGrade = 0.000000001;\n          }\n        }\n\n        this.mineralInventory = [MineralInventory.fromGradeTonnage(stores, this.createdBy[0], this.gradeTonnage[edit.commodity], reference)];\n        break;\n      default:\n        throw new Error(`Unknown edit: ${edit}`);\n    }\n\n    // TODO: fix me, we need to avoid duplicated reference\n    this.reference.push(reference);\n  }\n}\n\nexport class DraftCreateMineralSite extends MineralSite {\n  draftID: string;\n\n  constructor({ draftID, ...rest }: { draftID: string } & MineralSiteConstructorArgs) {\n    super(rest);\n    this.draftID = draftID;\n  }\n\n  public static fromMineralSite(\n    stores: { depositTypeStore: DepositTypeStore; stateOrProvinceStore: StateOrProvinceStore; countryStore: CountryStore },\n    dedupMineralSite: DedupMineralSite,\n    sites: MineralSite[],\n    username: string,\n    reference: Reference\n  ): DraftCreateMineralSite {\n    const baseSite = sites[0].id === dedupMineralSite.sites[0] ? sites[0] : sites.filter((site) => site.id === dedupMineralSite.sites[0])[0];\n    const createdBy = `https://minmod.isi.edu/users/${username}`;\n    const confidence = 1.0;\n\n    return new DraftCreateMineralSite({\n      draftID: `draft-${dedupMineralSite.id}`,\n      id: \"\", // backend does not care about uri as they will recalculate it\n      sourceId: DraftCreateMineralSite.updateSourceId(baseSite.sourceId, username),\n      recordId: baseSite.recordId,\n      dedupSiteURI: dedupMineralSite.uri,\n      createdBy: [createdBy],\n      name: dedupMineralSite.name,\n      locationInfo: (\n        dedupMineralSite.location ||\n        new DedupMineralSiteLocation({\n          country: [],\n          stateOrProvince: [],\n        })\n      )?.toLocationInfo(stores, createdBy, confidence),\n      depositTypeCandidate: dedupMineralSite.depositTypes.length > 0 ? [dedupMineralSite.getTop1DepositType()!.toCandidateEntity(stores)] : [],\n      reference: [reference],\n      sameAs: dedupMineralSite.sites,\n      gradeTonnage: {\n        [dedupMineralSite.gradeTonnage.commodity]: dedupMineralSite.gradeTonnage,\n      },\n      mineralInventory: [],\n    });\n  }\n\n  public static updateSourceId(sourceId: string, username: string): string {\n    const [sourceType, sourceIdent] = sourceId.split(\"::\", 2);\n    const url = new URL(sourceIdent);\n    url.searchParams.set(\"username\", username);\n    return `${sourceType}::${url.toString()}`;\n  }\n}\n\nexport class DraftUpdateMineralSite extends MineralSite {\n  isSaved: boolean = true;\n\n  updateField(stores: IStore, edit: FieldEdit, reference: Reference) {\n    super.updateField(stores, edit, reference);\n    this.isSaved = false;\n  }\n\n  markSaved() {\n    this.isSaved = true;\n  }\n\n  toModel(): MineralSite {\n    return new MineralSite(this);\n  }\n}\n","import { computed, makeObservable } from \"mobx\";\nimport { CandidateEntity } from \"./CandidateEntity\";\n\nexport class LocationInfo {\n  location?: string;\n  country: CandidateEntity[];\n  stateOrProvince: CandidateEntity[];\n  crs?: CandidateEntity;\n\n  public constructor({ country, stateOrProvince, location, crs }: { country: CandidateEntity[]; stateOrProvince: CandidateEntity[]; location?: string; crs?: CandidateEntity }) {\n    this.location = location;\n    this.country = country;\n    this.stateOrProvince = stateOrProvince;\n    this.crs = crs;\n  }\n\n  public static deserialize(obj: any) {\n    return new LocationInfo({\n      location: obj.location,\n      country: obj.country === undefined ? [] : obj.country.map(CandidateEntity.deserialize),\n      stateOrProvince: obj.state_or_province === undefined ? [] : obj.state_or_province.map(CandidateEntity.deserialize),\n      crs: obj.crs === undefined ? undefined : CandidateEntity.deserialize(obj.crs),\n    });\n  }\n\n  public clone(): LocationInfo {\n    return new LocationInfo({\n      location: this.location,\n      country: this.country.map((c) => c.clone()),\n      stateOrProvince: this.stateOrProvince.map((s) => s.clone()),\n      crs: this.crs ? this.crs.clone() : undefined,\n    });\n  }\n}\n","import { SERVER } from \"env\";\nimport { CRUDStore, FetchResponse } from \"gena-app\";\nimport { MineralSite, DraftCreateMineralSite, DraftUpdateMineralSite } from \"./MineralSite\";\nimport { LocationInfo } from \"./LocationInfo\";\nimport { CandidateEntity } from \"./CandidateEntity\";\nimport { Reference } from \"./Reference\";\nimport { GradeTonnage } from \"./GradeTonnage\";\nimport { DedupMineralSite, DedupMineralSiteStore } from \"models/dedupMineralSite\";\nimport { MineralInventory } from \"./MineralInventory\";\n\nexport class MineralSiteStore extends CRUDStore<string, DraftCreateMineralSite, DraftUpdateMineralSite, MineralSite> {\n  dedupMineralSiteStore: DedupMineralSiteStore;\n\n  constructor(dedupMineralSiteStore: DedupMineralSiteStore) {\n    super(`${SERVER}/api/v1/mineral-sites`, undefined, false);\n    this.dedupMineralSiteStore = dedupMineralSiteStore;\n  }\n\n  async createAndUpdateDedup(commodity: string, draft: DraftCreateMineralSite, discardDraft: boolean = true): Promise<MineralSite> {\n    const record = await this.create(draft, discardDraft);\n    await this.dedupMineralSiteStore.forceFetchByURI(record.dedupSiteURI, commodity);\n    return record;\n  }\n\n  async updateAndUpdateDedup(commodity: string, draft: DraftUpdateMineralSite, discardDraft: boolean = true): Promise<MineralSite> {\n    const record = await this.update(draft, discardDraft);\n    await this.dedupMineralSiteStore.forceFetchByURI(record.dedupSiteURI, commodity);\n    return record;\n  }\n\n  public deserialize(record: any): MineralSite {\n    return new MineralSite({\n      id: record.id,\n      recordId: record.record_id,\n      sourceId: record.source_id,\n      dedupSiteURI: record.dedup_site_uri,\n      createdBy: record.created_by,\n      name: record.name,\n      locationInfo:\n        record.location_info !== undefined\n          ? LocationInfo.deserialize(record.location_info)\n          : new LocationInfo({\n              country: [],\n              stateOrProvince: [],\n            }),\n      depositTypeCandidate: (record.deposit_type_candidate || []).map(CandidateEntity.deserialize),\n      reference: record.reference.map(Reference.deserialize),\n      sameAs: record.same_as,\n      gradeTonnage: Object.fromEntries(\n        record.grade_tonnage.map((val: any) => {\n          const gt = GradeTonnage.deserialize(val);\n          return [gt.commodity, gt];\n        })\n      ),\n      mineralInventory: record.mineral_inventory.map(MineralInventory.deserialize),\n    });\n  }\n\n  public serializeRecord(record: DraftCreateMineralSite | DraftUpdateMineralSite): object {\n    // convert mineral site to the format that the server required to save the mineral site.\n    // TODO: validate for the location\n    const reference = record.reference.map((ref) => ref.serialize());\n    let mineralInventory = [];\n\n    for (const gt of Object.values(record.gradeTonnage)) {\n      console.log(\"@@@\", gt);\n      mineralInventory.push({\n        // TODO: fix me! find correct source\n        // TODO: get correct users\n        category: [\"Inferred\", \"Indicated\", \"Measured\"].map((cat) => ({\n          source: record.createdBy[0],\n          confidence: 1.0,\n          normalized_uri: `https://minmod.isi.edu/resource/${cat}`,\n        })),\n        commodity: {\n          source: record.createdBy[0],\n          confidence: 1.0,\n          normalized_uri: `https://minmod.isi.edu/resource/${gt.commodity}`,\n        },\n        ore: {\n          value: gt.totalTonnage,\n          unit: {\n            source: record.createdBy[0],\n            confidence: 1.0,\n            normalized_uri: \"https://minmod.isi.edu/resource/Q202\",\n          },\n        },\n        grade: {\n          value: gt.totalGrade,\n          unit: {\n            source: record.createdBy[0],\n            confidence: 1.0,\n            normalized_uri: \"https://minmod.isi.edu/resource/Q201\",\n          },\n        },\n        reference: reference[0],\n      });\n    }\n\n    return {\n      name: record.name,\n      record_id: record.recordId,\n      source_id: record.sourceId,\n      created_by: record.createdBy,\n      dedup_site_uri: record.dedupSiteURI,\n      location_info: {\n        country: record.locationInfo.country.map((country) => country.serialize()),\n        state_or_province: record.locationInfo.stateOrProvince.map((state_or_province) => state_or_province.serialize()),\n        crs: record.locationInfo.crs?.serialize(),\n        location: record.locationInfo.location,\n      },\n      deposit_type_candidate: record.depositTypeCandidate.map((depositTypeCandidate) => depositTypeCandidate.serialize()),\n      mineral_inventory: mineralInventory,\n      reference: reference,\n      same_as: record.sameAs,\n    };\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: Array.isArray(resp.data) ? resp.data : Object.values(resp.data), total: resp.total };\n  }\n}\n","import { CountryStore } from \"models/country\";\nimport { DepositTypeStore } from \"models/depositType\";\nimport { CandidateEntity, GradeTonnage, LocationInfo } from \"models/mineralSite\";\nimport { StateOrProvinceStore } from \"models/stateOrProvince\";\nimport { InternalID, IRI } from \"models/typing\";\n\nexport class DedupMineralSiteDepositType {\n  uri: IRI;\n  source: string;\n  confidence: number;\n\n  public constructor({ uri, source, confidence }: { uri: IRI; source: string; confidence: number }) {\n    this.uri = uri;\n    this.source = source;\n    this.confidence = confidence;\n  }\n\n  public toCandidateEntity(stores: { depositTypeStore: DepositTypeStore }): CandidateEntity {\n    return new CandidateEntity({\n      source: this.source,\n      confidence: this.confidence,\n      normalizedURI: this.uri,\n      observedName: stores.depositTypeStore.getByURI(this.uri)?.name,\n    });\n  }\n}\n\nexport class DedupMineralSiteLocation {\n  lat?: number;\n  lon?: number;\n  country: IRI[];\n  stateOrProvince: IRI[];\n\n  public constructor({ lat, lon, country, stateOrProvince }: { lat?: number; lon?: number; country: IRI[]; stateOrProvince: IRI[] }) {\n    this.lat = lat;\n    this.lon = lon;\n    this.country = country;\n    this.stateOrProvince = stateOrProvince;\n  }\n\n  public static deserialize(record: any): DedupMineralSiteLocation {\n    return new DedupMineralSiteLocation({\n      lat: record.lat,\n      lon: record.lon,\n      country: record.country || [],\n      stateOrProvince: record.state_or_province || [],\n    });\n  }\n\n  public toLocationInfo(\n    stores: {\n      stateOrProvinceStore: StateOrProvinceStore;\n      countryStore: CountryStore;\n    },\n    source: string,\n    confidence: number = 1.0\n  ) {\n    let loc = undefined;\n    if (this.lat !== undefined && this.lon !== undefined) {\n      loc = `POINT (${this.lon} ${this.lat})`;\n    }\n\n    return new LocationInfo({\n      location: loc,\n      crs: new CandidateEntity({\n        source,\n        confidence,\n        normalizedURI: \"https://minmod.isi.edu/resource/Q701\",\n        observedName: \"EPSG:4326\",\n      }),\n      country: this.country.map((country) => {\n        return new CandidateEntity({\n          source,\n          confidence,\n          normalizedURI: country,\n          observedName: stores.countryStore.get(country)?.name,\n        });\n      }),\n      stateOrProvince: this.stateOrProvince.map((stateOrProvince) => {\n        return new CandidateEntity({\n          source,\n          confidence,\n          normalizedURI: stateOrProvince,\n          observedName: stores.stateOrProvinceStore.get(stateOrProvince)?.name,\n        });\n      }),\n    });\n  }\n}\n\nexport class DedupMineralSite {\n  id: InternalID;\n  uri: IRI;\n  name: string;\n  type: string;\n  rank: string;\n  sites: IRI[];\n  depositTypes: DedupMineralSiteDepositType[];\n  location?: DedupMineralSiteLocation;\n  gradeTonnage: GradeTonnage;\n\n  public constructor({\n    id,\n    uri,\n    name,\n    type,\n    rank,\n    sites,\n    depositTypes,\n    location,\n    gradeTonnage,\n  }: {\n    id: InternalID;\n    uri: IRI;\n    name: string;\n    type: string;\n    rank: string;\n    sites: string[];\n    depositTypes: DedupMineralSiteDepositType[];\n    location?: DedupMineralSiteLocation;\n    gradeTonnage: GradeTonnage;\n  }) {\n    this.id = id;\n    this.uri = uri;\n    this.name = name;\n    this.type = type;\n    this.rank = rank;\n    this.sites = sites;\n    this.depositTypes = depositTypes;\n    this.location = location;\n    this.gradeTonnage = gradeTonnage;\n  }\n\n  get commodity(): string {\n    return this.gradeTonnage.commodity;\n  }\n\n  public static getId(uri: string): string {\n    return uri.substring(uri.lastIndexOf(\"/\") + 1);\n  }\n\n  public static deserialize(record: any): DedupMineralSite {\n    return new DedupMineralSite({\n      id: record.id,\n      uri: `https://minmod.isi.edu/resource/${record.id}`,\n      name: record.name,\n      type: record.type,\n      rank: record.rank,\n      sites: record.sites,\n      depositTypes: record.deposit_types.map((depositType: any) => new DedupMineralSiteDepositType(depositType)),\n      location: record.location !== undefined ? DedupMineralSiteLocation.deserialize(record.location) : undefined,\n      gradeTonnage: GradeTonnage.deserialize(record.grade_tonnage),\n    });\n  }\n\n  public getTop1DepositType(): DedupMineralSiteDepositType | undefined {\n    return this.depositTypes[0];\n  }\n}\n","import { RStore, FetchResponse, FetchResult, SingleKeyIndex } from \"gena-app\";\nimport { SERVER } from \"../../env\";\nimport { Commodity } from \"models/commodity\";\nimport { DedupMineralSite, DedupMineralSiteDepositType, DedupMineralSiteLocation } from \"./DedupMineralSite\";\nimport axios from \"axios\";\nimport { action, makeObservable, runInAction } from \"mobx\";\nimport { NamespaceManager } from \"models/Namespace\";\nimport { GradeTonnage } from \"models/mineralSite\";\nimport { InternalID } from \"models/typing\";\n\nexport class DedupMineralSiteStore extends RStore<string, DedupMineralSite> {\n  ns: NamespaceManager;\n\n  constructor(ns: NamespaceManager) {\n    super(`${SERVER}/api/v1/dedup-mineral-sites`, undefined, false, [new SingleKeyIndex(\"commodity\", \"id\")]);\n    this.ns = ns;\n\n    makeObservable(this, {\n      forceFetchByURI: action,\n      deleteByIds: action,\n      replaceSites: action,\n    });\n  }\n\n  get commodity2ids() {\n    return this.indices[0] as SingleKeyIndex<string, string, DedupMineralSite>;\n  }\n\n  /**\n   * Delete dedup mineral sites by their Ids\n   * @param ids\n   */\n  deleteByIds(ids: InternalID[]): void {\n    this.state.value = \"updating\";\n    for (const id of ids) {\n      const record = this.records.get(id);\n      if (record !== undefined && record !== null) {\n        this.deindex(record);\n        this.records.delete(id);\n      }\n    }\n    this.state.value = \"updated\";\n  }\n\n  /**\n   * Replace given dedup sites with new sites\n   *\n   * @param prevIds previous sites to delete\n   * @param newIds new sites to add\n   */\n  async replaceSites(prevIds: InternalID[], newIds: InternalID[], commodity: Object): Promise<void> {\n    this.deleteByIds(prevIds);\n    await this.fetchByIds(newIds, true, { commodity });\n  }\n\n  async forceFetchByURI(uri: string, commodity: string): Promise<DedupMineralSite | undefined> {\n    const id = DedupMineralSite.getId(uri);\n    try {\n      this.state.value = \"updating\";\n\n      let resp = await axios.get(`${this.remoteURL}/${id}`, {\n        params: { commodity },\n      });\n\n      return runInAction(() => {\n        let record = this.deserialize(resp.data);\n        this.records.set(record.id, record);\n        this.index(record);\n        this.state.value = \"updated\";\n\n        return this.records.get(record.id)!;\n      });\n    } catch (error: any) {\n      if (error.response && error.response.status === 404) {\n        // entity does not exist\n        runInAction(() => {\n          this.records.set(id, null);\n          this.state.value = \"updated\";\n        });\n        return undefined;\n      }\n\n      runInAction(() => {\n        this.state.value = \"error\";\n      });\n      throw error;\n    }\n  }\n\n  async fetchByCommodity(commodity: Commodity): Promise<FetchResult<DedupMineralSite>> {\n    if (!this.refetch && this.commodity2ids.index.has(commodity.id)) {\n      return this.getByCommodity(commodity);\n    }\n    return await this.fetch({\n      conditions: { commodity: commodity.id },\n    });\n  }\n\n  public getByCommodity(commodity: Commodity): FetchResult<DedupMineralSite> {\n    if (!this.commodity2ids.index.has(commodity.id)) {\n      return { records: [], total: 0 };\n    }\n\n    const records = [];\n    for (const id of this.commodity2ids.index.get(commodity.id)!) {\n      records.push(this.records.get(id)!);\n    }\n    return { records, total: records.length };\n  }\n\n  public deserialize(record: any): DedupMineralSite {\n    const MR = this.ns.MR;\n\n    return new DedupMineralSite({\n      id: record.id,\n      uri: MR.getURI(record.id),\n      name: record.name,\n      type: record.type,\n      rank: record.rank,\n      sites: record.sites,\n      depositTypes: record.deposit_types.map(\n        (depositType: any) =>\n          new DedupMineralSiteDepositType({\n            uri: MR.getURI(depositType.id),\n            source: depositType.source,\n            confidence: depositType.confidence,\n          })\n      ),\n      location:\n        record.location !== undefined\n          ? new DedupMineralSiteLocation({\n              lat: record.location.lat,\n              lon: record.location.lon,\n              country: (record.location.country || []).map((country: string) => MR.getURI(country)),\n              stateOrProvince: (record.location.state_or_province || []).map((sop: string) => MR.getURI(sop)),\n            })\n          : undefined,\n      gradeTonnage: GradeTonnage.deserialize(record.grade_tonnage),\n    });\n  }\n\n  async updateSameAsGroup(groups: { sites: InternalID[] }[]): Promise<InternalID[]> {\n    const resp = await axios.post(\"/api/v1/same-as\", groups);\n    return resp.data.map((dedupSite: any) => dedupSite.id);\n  }\n\n  protected normRemoteSuccessfulResponse(resp: any): FetchResponse {\n    return { items: Array.isArray(resp.data) ? resp.data : Object.values(resp.data), total: resp.total };\n  }\n\n  /**\n   * Remove a record (by id) from your indexes\n   */\n  protected deindex(record: DedupMineralSite): void {\n    for (const index of this.indices) {\n      index.remove(record);\n    }\n  }\n}\n","import { InternalID, IRI } from \"./typing\";\n\nexport class BindedNamespace {\n  prefix: string;\n  namespace: string;\n\n  constructor(prefix: string, namespace: string) {\n    this.prefix = prefix;\n    this.namespace = namespace;\n  }\n\n  getURI(id: InternalID): IRI {\n    return `${this.namespace}${id}`;\n  }\n}\n\nexport class NamespaceManager {\n  MR: BindedNamespace = new BindedNamespace(\"mr\", \"https://minmod.isi.edu/resource/\");\n  MO: BindedNamespace = new BindedNamespace(\"mo\", \"https://minmod.isi.edu/ontology/\");\n  MD: BindedNamespace = new BindedNamespace(\"md\", \"https://minmod.isi.edu/ontology-derived/\");\n}\n","import React, { createContext } from \"react\";\nimport { message } from \"antd\";\nimport { registerDefaultAxiosErrorHandler } from \"gena-app\";\n\nimport { toJS } from \"mobx\";\nimport { User, UserStore } from \"./user\";\nimport { Commodity, CommodityStore } from \"./commodity\";\nimport { DepositType, DepositTypeStore } from \"./depositType\";\nimport { Country, CountryStore } from \"./country\";\nimport { StateOrProvince, StateOrProvinceStore } from \"./stateOrProvince\";\nimport { DedupMineralSite, DedupMineralSiteStore } from \"./dedupMineralSite\";\nimport { FieldEdit, EditableField, Reference, Document, GradeTonnage, CandidateEntity, DraftCreateMineralSite, DraftUpdateMineralSite, MineralSite, MineralSiteStore } from \"./mineralSite\";\nimport { NamespaceManager, BindedNamespace } from \"./Namespace\";\n\nconst namespaceManager = new NamespaceManager();\nconst dedupMineralSiteStore = new DedupMineralSiteStore(namespaceManager);\n\nexport const stores = {\n  userStore: new UserStore(),\n  commodityStore: new CommodityStore(),\n  dedupMineralSiteStore,\n  mineralSiteStore: new MineralSiteStore(dedupMineralSiteStore),\n  depositTypeStore: new DepositTypeStore(),\n  stateOrProvinceStore: new StateOrProvinceStore(),\n  countryStore: new CountryStore(),\n};\n\nregisterDefaultAxiosErrorHandler((error) => {\n  message.error(\"Error while talking with the server.\", 5);\n});\n\n(window as any)._stores = stores;\n(window as any).toJS = toJS;\nexport type IStore = Readonly<typeof stores>;\n\n/** Init the stores with essential information (e.g., loading the ui settings) needed to run the app */\nexport function initStores(): Promise<any> {\n  return Promise.resolve();\n}\n\nexport function initNonCriticalStores(): Promise<any> {\n  return Promise.all([stores.depositTypeStore.fetchAll(), stores.countryStore.fetchAll(), stores.stateOrProvinceStore.fetchAll()]);\n}\n\nexport const StoreContext = createContext<IStore>(stores);\n\nexport function useStores(): IStore {\n  return React.useContext(StoreContext);\n}\n\nexport { Document, DedupMineralSite, MineralSite, Reference, GradeTonnage, CandidateEntity, DraftCreateMineralSite, DraftUpdateMineralSite, BindedNamespace, NamespaceManager };\nexport type { FieldEdit, EditableField, Commodity, User, DepositType, Country, StateOrProvince };\n","import { ConsoleSqlOutlined } from \"@ant-design/icons\";\nimport { Select, Space, Typography } from \"antd\";\nimport _ from \"lodash\";\nimport { useStores, Commodity, IStore } from \"models\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useLocation } from \"react-router\";\nimport { routes } from \"routes\";\n\ninterface SearchBarProps {\n  searchArgs: SearchArgs;\n  setSearchArgs: (args: SearchArgs) => void;\n}\n\ninterface SearchArgs {\n  commodity?: string;\n}\n\ninterface NormSearchArgs {\n  commodity?: Commodity;\n}\n\nexport function useSearchArgs2(): [SearchArgs, NormSearchArgs, (newArgs: SearchArgs) => void] {\n  const { commodityStore } = useStores();\n  const queryParams = routes.home.useQueryParams();\n  const location = useLocation();\n\n  const [args, setArgs] = useState<SearchArgs>({\n    commodity: undefined,\n  });\n\n  console.log(\"call useSearchArgs\", args);\n\n  const updateSearchArgs = (newArgs: SearchArgs) => {\n    console.log(\"[real update] update search args\", newArgs, routes.home.getURL({ commodity: newArgs.commodity }));\n    setArgs(newArgs);\n    routes.home.path({ commodity: newArgs.commodity }).open();\n    // window._routeAPIs.history.push(\"/?commodity=Lithium\");\n  };\n\n  // sync with queries in the URL\n  useEffect(() => {\n    const inv = () => {\n      const newArgs = {\n        commodity: queryParams?.commodity,\n      };\n\n      if (newArgs.commodity !== undefined) {\n        const commodity = commodityStore.getByName(newArgs.commodity);\n        console.log(\"check commodity\", newArgs.commodity, commodity);\n        if (commodity === null) {\n          // does not exist\n          newArgs.commodity = undefined;\n        }\n      }\n\n      console.log(\"[useEffect] update search args\", \"new=\", newArgs, \"old=\", args, \"query=\", queryParams);\n      console.log(\"location\", location, \"search\", location.search);\n      if (!_.isEqual(newArgs, args)) {\n        updateSearchArgs(newArgs);\n      }\n    };\n    // inv();\n    setTimeout(inv, 1000);\n  }, [commodityStore.records.size, queryParams?.commodity]);\n\n  const normArgs: NormSearchArgs = useMemo(() => {\n    if (args.commodity === undefined) {\n      return {\n        commodity: undefined,\n      };\n    }\n    const commodity = commodityStore.getByName(args.commodity);\n    return {\n      commodity: commodity === null ? undefined : commodity,\n    };\n  }, [commodityStore.records.size, args.commodity]);\n\n  return [args, normArgs, updateSearchArgs];\n}\n\nexport function useSearchArgs(): [SearchArgs, NormSearchArgs, (newArgs: SearchArgs) => void] {\n  const { commodityStore } = useStores();\n  const [args, setArgs] = useState<SearchArgs>({\n    commodity: undefined,\n  });\n\n  const updateSearchArgs = (newArgs: SearchArgs) => {\n    setArgs(newArgs);\n  };\n\n  const normArgs: NormSearchArgs = useMemo(() => {\n    if (args.commodity === undefined) {\n      return {\n        commodity: undefined,\n      };\n    }\n    const commodity = commodityStore.getByName(args.commodity);\n    return {\n      commodity: commodity === null ? undefined : commodity,\n    };\n  }, [commodityStore.records.size, args.commodity]);\n\n  return [args, normArgs, updateSearchArgs];\n}\n\nexport const SearchBar: React.FC<SearchBarProps> = ({ searchArgs, setSearchArgs }) => {\n  const { commodityStore } = useStores();\n  const [options, setOptions] = useState<{ value: string; label: string }[]>([]);\n\n  useEffect(() => {\n    commodityStore.fetchCriticalCommotities().then((commodities) => {\n      setOptions(\n        commodities.map((comm) => ({\n          value: comm.id,\n          label: comm.name,\n        }))\n      );\n    });\n  }, [commodityStore]);\n\n  const onSelect = (value: string) => {\n    setSearchArgs({ commodity: commodityStore.get(value)!.name });\n  };\n\n  return (\n    <Space>\n      <Typography.Text>\n        Commodity<span style={{ color: \"red\" }}>*</span>:\n      </Typography.Text>\n      <Select style={{ width: 200 }} value={searchArgs.commodity} placeholder=\"Select a commodity\" showSearch={true} optionFilterProp=\"label\" onChange={onSelect} options={options} />\n    </Space>\n  );\n};\n","import { Typography } from \"antd\";\nimport { CandidateEntity, useStores } from \"models\";\n\ninterface CanEntCompProps {\n  entity?: CandidateEntity;\n  store?: \"depositTypeStore\";\n}\n\ninterface ListCanEntProps {\n  entities: CandidateEntity[];\n}\n\nexport const CanEntComponent: React.FC<CanEntCompProps> = ({ entity, store }: CanEntCompProps) => {\n  const stores = useStores();\n\n  if (entity === undefined) {\n    return <span>-</span>;\n  }\n\n  let name = entity.observedName === undefined ? \" \" : entity.observedName;\n  if (entity.normalizedURI !== undefined) {\n    if (store !== undefined) {\n      const ent = stores[store].getByURI(entity.normalizedURI);\n      if (ent !== undefined && ent !== null) {\n        name = ent.name;\n      }\n    }\n    return (\n      <Typography.Link href={entity.normalizedURI} target=\"_blank\">\n        {name}\n      </Typography.Link>\n    );\n  }\n\n  return <span>{name}</span>;\n};\n\nexport const ListCanEntComponent = ({ entities }: ListCanEntProps) => {\n  const comp = [];\n\n  if (entities.length > 0) {\n    comp.push(<CanEntComponent key={0} entity={entities[0]} />);\n  }\n\n  for (let i = 1; i < entities.length; i++) {\n    comp.push(<span>&nbsp;-&nbsp;</span>);\n    comp.push(<CanEntComponent key={i} entity={entities[i]} />);\n  }\n\n  return <>{comp}</>;\n};\n","export function join<T>(arr: T[], separator: (index: number) => T): T[] {\n  if (arr.length === 0) {\n    return [];\n  }\n\n  const result: T[] = [arr[0]];\n  for (let i = 1; i < arr.length; i++) {\n    result.push(separator(i));\n    result.push(arr[i]);\n  }\n  return result;\n}\n","import { Dropdown, Input, MenuProps, Select, Space, Typography } from \"antd\";\nimport { DownOutlined, SmileOutlined, UserOutlined, CloseCircleOutlined } from \"@ant-design/icons\";\nimport { useState } from \"react\";\n\nexport interface EditableSelectOption {\n  key: string;\n  label: string;\n}\n\nexport interface EditableSelectProps {\n  value?: string;\n  onChange?: (value: string) => void;\n  onProvenanceChange: (key: string | undefined) => void;\n  options: EditableSelectOption[];\n}\n\nconst UNSELECT_VALUE = \"e269e284cd592d703cb477fc2075cfde6ebfa9299e06deb0850f6061f72a6a9f\";\n\n/**\n * First time, it shows the dropdown with predefined options.\n *\n * User can select one of the predefined options, but when they click again, the dropdown\n * won't show up. User has a button to clean up the value. When they do that, the dropdown will\n * show up again.\n *\n * When user selects \"Enter your own\", the dropdown will disappear and an input field will show up.\n *\n * @param props\n * @returns\n */\nexport const EditableSelect: React.FC<EditableSelectProps> = (props) => {\n  const [selectingValue, setSelectingValue] = useState(props.value !== undefined);\n  if (selectingValue) {\n    return (\n      <Input\n        value={props.value}\n        onChange={(e) => (props.onChange !== undefined ? props.onChange(e.target.value) : undefined)}\n        placeholder={\"Enter your own\"}\n        suffix={\n          <CloseCircleOutlined\n            style={{ color: \"rgba(0,0,0,.25)\" }}\n            onClick={() => {\n              setSelectingValue(false);\n              if (props.onChange !== undefined) props.onChange(\"\");\n            }}\n          />\n        }\n      />\n    );\n  }\n\n  const options: object[] = props.options.map((option) => ({ value: option.key, label: option.label }));\n  options.push({ value: UNSELECT_VALUE, label: <Typography.Text italic={true}>Enter your own</Typography.Text> });\n\n  const onUpdateOption = (option: { value: string; label: string }) => {\n    setSelectingValue(true);\n    if (props.onChange !== undefined) props.onChange(option.label);\n    if (option.value !== UNSELECT_VALUE) props.onProvenanceChange(option.value);\n  };\n\n  return <Select options={options} onChange={(value, option) => onUpdateOption(option as any)} />;\n};\n","import { Document } from \"models\";\nimport { Input, Select, Typography } from \"antd\";\nimport { useState } from \"react\";\nimport { CloseCircleOutlined } from \"@ant-design/icons\";\nexport interface EditRefDocProps {\n  availableDocs: Document[];\n  value?: Document | null;\n  onChange?: (doc: Document | null) => void;\n}\n\nconst UNSELECT_VALUE = \"e269e284cd592d703cb477fc2075cfde6ebfa9299e06deb0850f6061f72a6a9f\";\n\nexport const EditRefDoc: React.FC<EditRefDocProps> = ({ availableDocs, value: doc, onChange }) => {\n  const [selectingValue, setSelectingValue] = useState(false);\n  const options: object[] = availableDocs.map((doc) => ({ value: doc.uri, label: doc.title || doc.uri }));\n  options.push({ value: UNSELECT_VALUE, label: <Typography.Text italic={true}>Enter your own</Typography.Text> });\n\n  const onUpdateOption = (uri: string) => {\n    if (uri === UNSELECT_VALUE) {\n      setSelectingValue(true);\n      if (onChange !== undefined) onChange(null);\n    } else {\n      const found = availableDocs.find((doc) => doc.uri === uri);\n      if (found) {\n        if (onChange !== undefined) onChange(found);\n      }\n    }\n  };\n\n  if (selectingValue) {\n    return (\n      <Input\n        value={doc?.uri}\n        onChange={(e) => {\n          const uri = e.target.value;\n          if (uri === \"\") {\n            if (onChange !== undefined) onChange(null);\n          } else {\n            if (onChange !== undefined) onChange(new Document({ uri, title: \"\" }));\n          }\n        }}\n        placeholder={\"Enter URL of a document\"}\n        suffix={\n          <CloseCircleOutlined\n            style={{ color: \"rgba(0,0,0,.25)\" }}\n            onClick={() => {\n              setSelectingValue(false);\n              if (onChange !== undefined) onChange(null);\n            }}\n          />\n        }\n      />\n    );\n  }\n\n  return <Select options={options} value={doc === null || doc === undefined ? undefined : doc.uri} onChange={(uri) => onUpdateOption(uri)} />;\n};\n","import { Button, Checkbox, Form, Input, Modal, Select, Space } from \"antd\";\nimport { EditableSelect, EditableSelectOption } from \"components/EditableSelect\";\nimport _, { initial } from \"lodash\";\nimport { MineralSite, Reference, Document, FieldEdit, EditableField, useStores } from \"models\";\nimport { useMemo } from \"react\";\nimport { EditRefDoc } from \"./EditRefDoc\";\nimport { InternalID } from \"models/typing\";\nimport { DepositTypeStore } from \"models/depositType\";\n\ninterface EditSiteFieldProps {\n  sites: MineralSite[];\n  currentSite?: MineralSite;\n  commodity: InternalID;\n  editField?: EditableField;\n  onFinish: (change?: { edit: FieldEdit; reference: Reference }) => void;\n}\n\ntype FormFields = {\n  fieldValue: string | undefined;\n  refDoc: Document | null;\n  refComment: string;\n  refAppliedToAll: boolean;\n};\n\nexport const EditSiteField: React.FC<EditSiteFieldProps> = ({ currentSite, sites, editField, commodity, onFinish }) => {\n  const { depositTypeStore } = useStores();\n  const [form] = Form.useForm<FormFields>();\n\n  const title = useMemo(() => {\n    switch (editField) {\n      case \"name\":\n        return \"Name\";\n      case \"location\":\n        return \"Location\";\n      case \"depositType\":\n        return \"Deposit Type\";\n      case \"grade\":\n        return \"Grade (%)\";\n      case \"tonnage\":\n        return \"Tonnage (Mt)\";\n      default:\n        return \"\";\n    }\n  }, [editField]);\n\n  const setFieldProvenance = (key: string | undefined) => {\n    if (key !== undefined) {\n      const site = sites.filter((site) => site.id === key)[0];\n      // there can be multiple docs per site, we choose the first one and\n      // users can correct it.\n      form.setFieldValue(\"refDoc\", site.getFirstReferencedDocument());\n    } else {\n      form.setFieldValue(\"refDoc\", null);\n    }\n  };\n\n  const docs = _.uniqBy(\n    sites.flatMap((site) => Object.values(site.getReferencedDocuments())),\n    \"uri\"\n  );\n\n  let editFieldComponent = undefined;\n  let initialValues: FormFields = defaultInitialValues;\n  const configArgs = { currentSite, sites, setFieldProvenance, stores: { depositTypeStore }, commodity };\n  switch (editField) {\n    case \"name\":\n      [editFieldComponent, initialValues] = getNameConfig(configArgs);\n      break;\n    case \"depositType\":\n      [editFieldComponent, initialValues] = getDepositTypeConfig(configArgs);\n      break;\n    case \"location\":\n      [editFieldComponent, initialValues] = getLocationConfig(configArgs);\n      break;\n    case \"grade\":\n      [editFieldComponent, initialValues] = getGradeConfig(configArgs);\n      break;\n    case \"tonnage\":\n      [editFieldComponent, initialValues] = getTonnageConfig(configArgs);\n      break;\n    case undefined:\n      break;\n    default:\n      throw new Error(`Unknown field ${editField}`);\n  }\n\n  const onSave = (values: any) => {\n    if (editField === undefined) return;\n    const val = form.getFieldsValue();\n    if (val.refDoc === null || val.fieldValue === undefined) {\n      return;\n    }\n\n    let edit;\n    if (editField === \"name\" || editField === \"location\") {\n      edit = { field: editField, value: val.fieldValue };\n    } else if (editField === \"depositType\") {\n      edit = { field: editField, observedName: depositTypeStore.getByURI(val.fieldValue)!.name, normalizedURI: val.fieldValue };\n    } else if (editField === \"grade\" || editField === \"tonnage\") {\n      edit = { field: editField, value: parseFloat(val.fieldValue), commodity };\n    } else {\n      throw new Error(`Unknown field ${editField}`);\n    }\n\n    onFinish({\n      edit,\n      reference: new Reference({\n        document: val.refDoc,\n        comment: val.refComment,\n        property: val.refAppliedToAll ? undefined : Reference.normalizeProperty(editField),\n      }),\n    });\n  };\n\n  return (\n    <Modal title=\"Edit Mineral Site\" width=\"70%\" open={editField !== undefined} onCancel={() => onFinish()} footer={null}>\n      <Form form={form} onFinish={onSave} layout=\"vertical\" style={{ marginTop: 24, marginBottom: 24 }} requiredMark={true} initialValues={initialValues}>\n        <Form.Item<FormFields> name=\"fieldValue\" label={title} required={true} tooltip=\"This is a required field\" rules={[{ required: true, message: \"Value cannot be empty\" }]}>\n          {editFieldComponent}\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refDoc\" label=\"Reference\" required={true} tooltip=\"This is a required field\" rules={[{ required: true, message: \"Document URL\" }]}>\n          <EditRefDoc availableDocs={docs} />\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refComment\" label=\"Comment\">\n          <Input.TextArea rows={3} />\n        </Form.Item>\n        <Form.Item<FormFields> name=\"refAppliedToAll\" valuePropName=\"checked\">\n          <Checkbox>This reference applies to all fields</Checkbox>\n        </Form.Item>\n        <Form.Item<FormFields>>\n          <Space>\n            <Button type=\"primary\" htmlType=\"submit\">\n              Save\n            </Button>\n            <Button htmlType=\"button\" onClick={() => onFinish()}>\n              Cancel\n            </Button>\n          </Space>\n        </Form.Item>\n      </Form>\n    </Modal>\n  );\n};\n\nconst defaultInitialValues: FormFields = {\n  fieldValue: undefined,\n  refDoc: null,\n  refComment: \"\",\n  refAppliedToAll: true,\n};\n\ninterface GetFieldConfig {\n  currentSite: MineralSite | undefined;\n  sites: MineralSite[];\n  setFieldProvenance: (key: string | undefined) => void;\n  stores: { depositTypeStore: DepositTypeStore };\n  commodity: InternalID;\n}\n\nconst getNameConfig = ({ currentSite, sites, setFieldProvenance }: GetFieldConfig): [React.ReactElement, FormFields] => {\n  const options = sites.map((site) => ({ key: site.id, label: site.name }));\n  const component = <EditableSelect onProvenanceChange={setFieldProvenance} options={options} />;\n  const initialValues =\n    currentSite !== undefined\n      ? {\n          fieldValue: currentSite.name,\n          refDoc: currentSite.getFirstReferencedDocument(),\n          refComment: currentSite.reference[0].comment,\n          refAppliedToAll: true,\n        }\n      : defaultInitialValues;\n  return [component, initialValues];\n};\n\nconst getLocationConfig = ({ currentSite, sites, setFieldProvenance }: GetFieldConfig): [React.ReactElement, FormFields] => {\n  const options = sites.filter((site) => site.locationInfo.location !== undefined).map((site) => ({ key: site.id, label: site.locationInfo.location! }));\n  const component = <EditableSelect onProvenanceChange={setFieldProvenance} options={options} />;\n  const initialValues =\n    currentSite !== undefined\n      ? {\n          fieldValue: currentSite.locationInfo.location || \"\",\n          refDoc: currentSite.getFirstReferencedDocument(),\n          refComment: currentSite.reference[0].comment,\n          refAppliedToAll: true,\n        }\n      : defaultInitialValues;\n  return [component, initialValues];\n};\n\nconst getDepositTypeConfig = ({ currentSite, sites, setFieldProvenance, stores }: GetFieldConfig): [React.ReactElement, FormFields] => {\n  let options = _.uniqBy(\n    sites.flatMap((site) => site.depositTypeCandidate).filter((deptype) => deptype.normalizedURI !== undefined),\n    \"normalizedURI\"\n  )\n    .sort((a, b) => a.confidence - b.confidence)\n    .map((type) => ({ value: type.normalizedURI!, label: stores.depositTypeStore.getByURI(type.normalizedURI!)!.name }));\n  const predictedDepTypes = new Set(options.map((type) => type.value));\n  options = options.concat(stores.depositTypeStore.filter((type) => !predictedDepTypes.has(type.uri)).map((type) => ({ value: type.uri, label: type.name })));\n\n  const component = <Select showSearch={true} options={options} optionFilterProp=\"label\" />;\n  const initialValues =\n    currentSite !== undefined && currentSite.depositTypeCandidate.length > 0\n      ? {\n          fieldValue: currentSite.depositTypeCandidate[0].normalizedURI!,\n          refDoc: currentSite.getFirstReferencedDocument(),\n          refComment: currentSite.reference[0].comment,\n          refAppliedToAll: true,\n        }\n      : defaultInitialValues;\n  return [component, initialValues];\n};\n\nconst getTonnageConfig = ({ currentSite, sites, setFieldProvenance, stores, commodity }: GetFieldConfig): [React.ReactElement, FormFields] => {\n  const component = <Input type=\"number\" />;\n  const initialValues =\n    currentSite !== undefined && currentSite.depositTypeCandidate.length > 0\n      ? {\n          fieldValue: currentSite.gradeTonnage[commodity]?.totalTonnage?.toFixed(4) || \"\",\n          refDoc: currentSite.getFirstReferencedDocument(),\n          refComment: currentSite.reference[0].comment,\n          refAppliedToAll: true,\n        }\n      : defaultInitialValues;\n  return [component, initialValues];\n};\n\nconst getGradeConfig = ({ currentSite, sites, setFieldProvenance, stores, commodity }: GetFieldConfig): [React.ReactElement, FormFields] => {\n  const component = <Input type=\"number\" />;\n  const initialValues =\n    currentSite !== undefined && currentSite.depositTypeCandidate.length > 0\n      ? {\n          fieldValue: currentSite.gradeTonnage[commodity]?.totalGrade?.toFixed(4) || \"\",\n          refDoc: currentSite.getFirstReferencedDocument(),\n          refComment: currentSite.reference[0].comment,\n          refAppliedToAll: true,\n        }\n      : defaultInitialValues;\n  return [component, initialValues];\n};\n","import { Button, Col, Flex, Row, Select, Space, Table, Typography, message, Checkbox } from \"antd\";\nimport { toJS } from \"mobx\";\nimport { observer } from \"mobx-react\";\nimport { useStores, Commodity, DedupMineralSite, MineralSite, CandidateEntity, Reference, DraftCreateMineralSite, FieldEdit, EditableField, DraftUpdateMineralSite } from \"models\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { WithStyles, withStyles } from \"@material-ui/styles\";\nimport { CanEntComponent, ListCanEntComponent } from \"./CandidateEntity\";\nimport { join } from \"misc\";\nimport { EditOutlined } from \"@ant-design/icons\";\nimport { EditSiteField } from \"./EditSiteField\";\nimport { orange } from \"@ant-design/colors\";\nimport axios from \"axios\";\nconst css = {\n  table: {\n    \"& .ant-table\": {\n      margin: \"0px !important\",\n      border: \"1px solid #ccc\",\n    },\n  },\n  editButton: {\n    cursor: \"pointer\",\n  },\n  myEditedRow: {\n    backgroundColor: `${orange[1]} !important`,\n    \"& > td\": {\n      backgroundColor: `${orange[1]} !important`,\n    },\n  },\n};\n\ninterface EditDedupMineralSiteProps {\n  commodity: Commodity;\n  dedupSite: DedupMineralSite;\n}\n\nexport const EditDedupMineralSite = withStyles(css)(\n  observer(({ dedupSite, commodity, classes }: EditDedupMineralSiteProps & WithStyles<typeof css>) => {\n    const stores = useStores();\n    const { mineralSiteStore, userStore, dedupMineralSiteStore } = stores;\n    const [editField, setEditField] = useState<EditableField | undefined>(undefined);\n    const [selectedRows, setSelectedRows] = useState<Set<string>>(new Set());\n\n    const tmpLst: (MineralSite | null | undefined)[] = dedupSite.sites.map((id) => mineralSiteStore.get(id));\n    // no idea why typescript compiler incorrectly complains about the incorrect type\n    const fetchedSites = tmpLst.filter((site) => site !== undefined) as (MineralSite | null)[];\n    const sites = fetchedSites.filter((site) => site !== null) as MineralSite[];\n    const isLoading = mineralSiteStore.state.value === \"updating\" || fetchedSites.length !== dedupSite.sites.length;\n\n    const ungroupTogether = async () => {\n      const selectedSiteIds = Array.from(selectedRows);\n      const allSiteIds = sites.map((site) => site.id);\n      const unselectedSiteIds = allSiteIds.filter((id) => !selectedRows.has(id));\n\n      const newGroups = [{ sites: selectedSiteIds }, { sites: unselectedSiteIds }];\n      const newIds = await dedupMineralSiteStore.updateSameAsGroup(newGroups);\n\n      if (commodity && commodity.id) {\n        const commodityId = commodity.id;\n        await dedupMineralSiteStore.replaceSites([dedupSite.id], newIds, commodityId);\n        message.success(\"Ungrouping was successful!\");\n      }\n    };\n\n    const ungroupSeparately = async () => {\n      const selectedSiteIds = Array.from(selectedRows);\n      const allSiteIds = sites.map((site) => site.id);\n      const unselectedSiteIds = allSiteIds.filter((id) => !selectedRows.has(id));\n\n      const selectedPayload = selectedSiteIds.map((id) => ({ sites: [id] }));\n      const unselectedPayload = unselectedSiteIds.length > 0 ? [{ sites: unselectedSiteIds }] : [];\n      const createPayload = [...selectedPayload, ...unselectedPayload];\n\n      const newIds = await dedupMineralSiteStore.updateSameAsGroup(createPayload);\n\n      if (commodity && commodity.id) {\n        const commodityId = commodity.id;\n        await dedupMineralSiteStore.replaceSites([dedupSite.id], newIds, commodityId);\n        message.success(\"Ungrouping was successful!\");\n      }\n    };\n\n    const columns = useMemo(() => {\n      return [\n        {\n          title: \"Select\",\n          key: \"select\",\n          hidden: sites.length === 1,\n          render: (_: any, site: MineralSite) => (\n            <Checkbox\n              checked={selectedRows.has(site.id)}\n              onChange={(e) => {\n                const updatedRows = new Set(selectedRows);\n                if (e.target.checked) {\n                  updatedRows.add(site.id);\n                } else {\n                  updatedRows.delete(site.id);\n                }\n                setSelectedRows(updatedRows);\n              }}\n            />\n          ),\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Name</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"name\")} />\n            </Flex>\n          ),\n          key: \"name\",\n          render: (_: any, site: MineralSite) => {\n            return (\n              <Typography.Link href={site.uri} target=\"_blank\">\n                {site.name}\n              </Typography.Link>\n            );\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Location</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"location\")} />\n            </Flex>\n          ),\n          key: \"location\",\n          render: (_: any, site: MineralSite) => {\n            return (\n              <Typography.Text className=\"font-small\" ellipsis={true} style={{ maxWidth: 200 }}>\n                {site.locationInfo.location}\n              </Typography.Text>\n            );\n          },\n        },\n        {\n          title: \"CRS\",\n          key: \"crs\",\n          render: (_: any, site: MineralSite) => {\n            return <span>{site.locationInfo.crs?.observedName}</span>;\n          },\n        },\n        {\n          title: \"Country\",\n          key: \"country\",\n          render: (_: any, site: MineralSite) => {\n            return <ListCanEntComponent entities={site.locationInfo.country} />;\n          },\n        },\n        {\n          title: \"State/Province\",\n          key: \"state/province\",\n          render: (_: any, site: MineralSite) => {\n            return <ListCanEntComponent entities={site.locationInfo.stateOrProvince} />;\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Dep. Type</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"depositType\")} />\n            </Flex>\n          ),\n          key: \"deposit-type\",\n          render: (_: any, site: MineralSite) => {\n            return <CanEntComponent entity={site.depositTypeCandidate[0]} store=\"depositTypeStore\" />;\n          },\n        },\n        {\n          title: \"Dep. Confidence\",\n          key: \"dep-type-confidence\",\n          render: (_: any, site: MineralSite) => {\n            if (site.depositTypeCandidate.length === 0) {\n              return \"-\";\n            }\n            return site.depositTypeCandidate[0].confidence.toFixed(4);\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Tonnage (Mt)</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"tonnage\")} />\n            </Flex>\n          ),\n          key: \"tonnage\",\n          render: (_: any, site: MineralSite) => {\n            const gradeTonnage = site.gradeTonnage[commodity.id];\n            if (gradeTonnage === undefined || gradeTonnage.totalTonnage === undefined) {\n              return \"-\";\n            }\n            return gradeTonnage.totalTonnage.toFixed(4);\n          },\n        },\n        {\n          title: (\n            <Flex justify=\"space-between\">\n              <span>Grade (%)</span>\n              <EditOutlined className={classes.editButton} onClick={() => setEditField(\"grade\")} />\n            </Flex>\n          ),\n          key: \"grade\",\n          render: (_: any, site: MineralSite) => {\n            const gradeTonnage = site.gradeTonnage[commodity.id];\n            if (gradeTonnage === undefined || gradeTonnage.totalGrade === undefined) {\n              return \"-\";\n            }\n            return gradeTonnage.totalGrade.toFixed(2);\n          },\n        },\n        {\n          title: \"Reference\",\n          key: \"reference\",\n          render: (_: any, site: MineralSite) => {\n            return <ReferenceComponent site={site} />;\n          },\n        },\n      ];\n    }, [commodity.id, sites.length, selectedRows, ungroupTogether]);\n\n    useEffect(() => {\n      mineralSiteStore.fetchByIds(dedupSite.sites);\n    }, [mineralSiteStore]);\n\n    const onEditFinish = (change?: { edit: FieldEdit; reference: Reference }) => {\n      if (change === undefined) {\n        setEditField(undefined);\n        return;\n      }\n\n      const currentUser = userStore.getCurrentUser()!;\n      const existingSite = sites.find((site) => site.createdBy.includes(currentUser.url));\n      let cb;\n      if (existingSite === undefined) {\n        const draftSite = DraftCreateMineralSite.fromMineralSite(stores, dedupSite, sites, currentUser.id, change.reference);\n        draftSite.updateField(stores, change.edit, change.reference);\n        cb = mineralSiteStore.createAndUpdateDedup(dedupSite.commodity, draftSite);\n      } else {\n        const draftSite = new DraftUpdateMineralSite(existingSite);\n        draftSite.updateField(stores, change.edit, change.reference);\n        cb = mineralSiteStore.updateAndUpdateDedup(dedupSite.commodity, draftSite);\n      }\n\n      cb.then(() => {\n        setEditField(undefined);\n      });\n    };\n\n    const currentSite = sites.find((site) => site.createdBy.includes(userStore.getCurrentUser()!.url));\n\n    let groupBtns = undefined;\n    if (selectedRows.size > 0 && sites.length > 1) {\n      const ungrpSepBtn = (\n        <Button key=\"separately\" type=\"primary\" onClick={ungroupSeparately}>\n          Ungroup Separately\n        </Button>\n      );\n      const ungrpTogBtn = (\n        <Button key=\"together\" type=\"primary\" onClick={ungroupTogether}>\n          Ungroup Together\n        </Button>\n      );\n      if (selectedRows.size === 1 || selectedRows.size === sites.length) {\n        groupBtns = [ungrpSepBtn];\n      } else {\n        groupBtns = [ungrpSepBtn, ungrpTogBtn];\n      }\n      groupBtns = <Space>{groupBtns}</Space>;\n    }\n\n    return (\n      <Flex vertical={true} gap=\"small\">\n        {groupBtns}\n        <Table<MineralSite>\n          className={classes.table}\n          bordered={true}\n          pagination={false}\n          size=\"small\"\n          rowKey=\"id\"\n          columns={columns}\n          dataSource={sites}\n          loading={isLoading}\n          rowClassName={(site) => {\n            return site.createdBy.includes(userStore.getCurrentUser()!.url) ? classes.myEditedRow : \"\";\n          }}\n        />\n        <EditSiteField key={editField} sites={sites} currentSite={currentSite} editField={editField} onFinish={onEditFinish} commodity={commodity.id} />\n      </Flex>\n    );\n  })\n) as React.FC<EditDedupMineralSiteProps>;\n\nconst ReferenceComponent: React.FC<{ site: MineralSite }> = ({ site }) => {\n  const docs = useMemo(() => {\n    return Object.values(site.getReferencedDocuments());\n  }, [site]);\n\n  return (\n    <Typography.Text ellipsis={true} style={{ maxWidth: 200 }}>\n      {join(\n        docs.map((doc) => (\n          <Typography.Link key={doc.uri} target=\"_blank\" href={doc.uri}>\n            {doc.title || doc.uri}\n          </Typography.Link>\n        )),\n        (index) => (\n          <span key={`sep-${index}`}>&nbsp;&nbsp;</span>\n        )\n      )}\n    </Typography.Text>\n  );\n};\n","import { Typography } from \"antd\";\nimport { stores, useStores } from \"models\";\n\nexport interface EntityProps {\n  uri: string;\n  store: \"countryStore\" | \"commodityStore\" | \"depositTypeStore\" | \"stateOrProvinceStore\";\n}\n\nexport const Entity: React.FC<EntityProps> = ({ uri: uri, store }) => {\n  const db = useStores()[store];\n  const record = db.get(uri);\n\n  if (record === null) {\n    return (\n      <Typography.Link href={uri} target=\"_blank\">\n        Not found\n      </Typography.Link>\n    );\n  }\n\n  if (record === undefined) {\n    return (\n      <Typography.Link href={uri} target=\"_blank\">\n        Loading...\n      </Typography.Link>\n    );\n  }\n\n  return (\n    <Typography.Link href={uri} target=\"_blank\">\n      {record.name}\n    </Typography.Link>\n  );\n};\n","import { DedupMineralSite, useStores } from \"models\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { observer } from \"mobx-react\";\nimport { Commodity } from \"models/commodity\";\nimport { Alert, Button, Checkbox, Divider, Flex, Space, Spin, Table, Typography, message } from \"antd\";\nimport { FetchResult } from \"gena-app\";\nimport { EditOutlined, UngroupOutlined } from \"@ant-design/icons\";\nimport { EditDedupMineralSite } from \"./editDedupSite/EditDedupMineralSite\";\nimport { Entity } from \"components/Entity\";\nimport axios from \"axios\";\nimport { DepositTypeStore } from \"models/depositType\";\ninterface DedupMineralSiteTableProps {\n  commodity: Commodity | undefined;\n}\n\nconst emptyFetchResult = { records: [], total: 0 };\n\nexport const DedupMineralSiteTable: React.FC<DedupMineralSiteTableProps> = observer(({ commodity }) => {\n  const { dedupMineralSiteStore, depositTypeStore, countryStore, stateOrProvinceStore } = useStores();\n  const [editingDedupSite, setEditingDedupSite] = useState<string | undefined>(undefined);\n  const [selectedDedupSiteIds, setSelectedDedupSiteIds] = useState<Set<string>>(new Set());\n\n  const columns = useMemo(() => {\n    return [\n      {\n        title: \"\",\n        key: \"select\",\n        render: (_: any, site: DedupMineralSite) => <Checkbox onChange={(e) => selectDedupSite(site, e.target.checked)} checked={selectedDedupSiteIds.has(site.id)} />,\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => a.sites.length - b.sites.length,\n      },\n      {\n        title: \"Name\",\n        dataIndex: \"name\",\n        key: \"name\",\n        render: (_: any, site: DedupMineralSite) => {\n          return (\n            <Typography.Link href={site.uri} target=\"_blank\">\n              {site.name || \"\"}\n            </Typography.Link>\n          );\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => a.name.localeCompare(b.name),\n      },\n      {\n        title: \"Type\",\n        key: \"type\",\n        render: (_: any, site: DedupMineralSite) => {\n          return <span className=\"font-small\">{site.type}</span>;\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => a.type.localeCompare(b.type),\n      },\n      {\n        title: \"Rank\",\n        key: \"rank\",\n        render: (_: any, site: DedupMineralSite) => {\n          return <span className=\"font-small\">{site.rank}</span>;\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => a.rank.localeCompare(b.rank),\n      },\n      {\n        title: \"Location\",\n        key: \"location\",\n        render: (value: any, dedupSite: DedupMineralSite) => {\n          if (dedupSite.location !== undefined && dedupSite.location.lat !== undefined && dedupSite.location.lon !== undefined) {\n            return `${dedupSite.location.lat.toFixed(5)}, ${dedupSite.location.lon.toFixed(5)}`;\n          }\n          return \"\";\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const locA = a.location ? `${a.location.lat?.toFixed(3)},${a.location.lon?.toFixed(3)}` : \"\";\n          const locB = b.location ? `${b.location.lat?.toFixed(3)},${b.location.lon?.toFixed(3)}` : \"\";\n          return locA.localeCompare(locB);\n        },\n      },\n      {\n        title: \"Country\",\n        key: \"country\",\n        render: (_: any, site: DedupMineralSite) => {\n          if (site.location === undefined || site.location.country.length === 0) {\n            return \"\";\n          }\n\n          return (\n            <Space split={<Divider type=\"vertical\" />}>\n              {site.location.country.map((country) => (\n                <Entity key={country} uri={country} store=\"countryStore\" />\n              ))}\n            </Space>\n          );\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const countryA = a.location?.country.map((iri) => countryStore.getByURI(iri)!.name).join(\",\") || \"\";\n          const countryB = b.location?.country.map((iri) => countryStore.getByURI(iri)!.name).join(\",\") || \"\";\n          return countryA.localeCompare(countryB);\n        },\n      },\n      {\n        title: \"State/Province\",\n        key: \"state\",\n        render: (_: any, site: DedupMineralSite) => {\n          if (site.location === undefined || site.location.stateOrProvince.length === 0) {\n            return \"\";\n          }\n\n          return (\n            <Space split={<Divider type=\"vertical\" />}>\n              {site.location.stateOrProvince.map((province) => (\n                <Entity key={province} uri={province} store=\"stateOrProvinceStore\" />\n              ))}\n            </Space>\n          );\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const stateA = a.location?.stateOrProvince.map((iri) => stateOrProvinceStore.getByURI(iri)!.name).join(\",\") || \"\";\n          const stateB = b.location?.stateOrProvince.map((iri) => stateOrProvinceStore.getByURI(iri)!.name).join(\",\") || \"\";\n          return stateA.localeCompare(stateB);\n        },\n      },\n      {\n        title: \"Deposit Type\",\n        key: \"depositType\",\n        render: (_: any, site: DedupMineralSite) => {\n          const dt = site.getTop1DepositType();\n          if (dt === undefined) {\n            return \"\";\n          }\n          return <Entity uri={dt.uri} store=\"depositTypeStore\" />;\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const dtA = a.getTop1DepositType()?.uri;\n          const dtB = b.getTop1DepositType()?.uri;\n          const dtAName = dtA !== undefined ? depositTypeStore.getByURI(dtA)!.name : \"\";\n          const dtBName = dtB !== undefined ? depositTypeStore.getByURI(dtB)!.name : \"\";\n          return dtAName.localeCompare(dtBName);\n        },\n      },\n      {\n        title: \"Dep. Score\",\n        key: \"depositConfidence\",\n        render: (_: any, site: DedupMineralSite) => {\n          const dt = site.getTop1DepositType();\n          if (dt === undefined) {\n            return \"\";\n          }\n          return dt.confidence.toFixed(4);\n        },\n      },\n      {\n        title: \"Tonnage (Mt)\",\n        dataIndex: \"totalTonnage\",\n        render: (_: any, site: DedupMineralSite) => {\n          if (site.gradeTonnage !== undefined && site.gradeTonnage.totalTonnage !== undefined) {\n            return site.gradeTonnage.totalTonnage.toFixed(4);\n          }\n          return \"\";\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const tonnageA = a.gradeTonnage?.totalTonnage || 0;\n          const tonnageB = b.gradeTonnage?.totalTonnage || 0;\n          return tonnageA - tonnageB;\n        },\n      },\n      {\n        title: \"Grade (%)\",\n        dataIndex: \"totalGrade\",\n        render: (_: any, site: DedupMineralSite) => {\n          if (site.gradeTonnage !== undefined && site.gradeTonnage.totalGrade !== undefined) {\n            return site.gradeTonnage.totalGrade.toFixed(2);\n          }\n          return \"\";\n        },\n        sorter: (a: DedupMineralSite, b: DedupMineralSite) => {\n          const gradeA = a.gradeTonnage?.totalGrade || 0;\n          const gradeB = b.gradeTonnage?.totalGrade || 0;\n          return gradeA - gradeB;\n        },\n      },\n      {\n        title: \"Action\",\n        key: \"action\",\n        render: (_: any, site: DedupMineralSite) => {\n          return (\n            <Space>\n              <Button\n                color=\"primary\"\n                size=\"middle\"\n                icon={<EditOutlined />}\n                variant=\"filled\"\n                onClick={() => {\n                  if (site.id === editingDedupSite) {\n                    setEditingDedupSite(undefined);\n                  } else {\n                    setEditingDedupSite(site.id);\n                  }\n                }}\n              >\n                Edit\n              </Button>\n            </Space>\n          );\n        },\n      },\n    ];\n  }, [commodity?.id, countryStore, stateOrProvinceStore, selectedDedupSiteIds, editingDedupSite]);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (commodity !== undefined) {\n        await dedupMineralSiteStore.fetchByCommodity(commodity);\n      }\n    };\n    fetchData();\n  }, [commodity, dedupMineralSiteStore]);\n\n  const selectDedupSite = (site: DedupMineralSite, selectOrNot: boolean) => {\n    const newSelectedDedupSiteIds = new Set(selectedDedupSiteIds);\n    if (selectOrNot) {\n      newSelectedDedupSiteIds.add(site.id);\n    } else {\n      newSelectedDedupSiteIds.delete(site.id);\n    }\n    setSelectedDedupSiteIds(newSelectedDedupSiteIds);\n  };\n\n  const handleGroup = async () => {\n    const prevIds = Array.from(selectedDedupSiteIds);\n    const allSiteIds = Array.from(selectedDedupSiteIds).flatMap((dedupSiteId) => dedupMineralSiteStore.get(dedupSiteId)!.sites.map((siteUri) => DedupMineralSite.getId(siteUri)));\n\n    const newSiteGroups = [\n      {\n        sites: allSiteIds,\n      },\n    ];\n    const newIds = await dedupMineralSiteStore.updateSameAsGroup(newSiteGroups);\n\n    if (commodity && commodity.id) {\n      const commodityId = commodity.id;\n      message.success(\"Grouping was successful\", 3);\n      setSelectedDedupSiteIds(new Set());\n      await dedupMineralSiteStore.replaceSites(prevIds, newIds, commodityId);\n    }\n  };\n\n  const isLoading = dedupMineralSiteStore.state.value === \"updating\";\n  const dedupMineralSites = commodity === undefined || isLoading ? emptyFetchResult : dedupMineralSiteStore.getByCommodity(commodity);\n\n  return (\n    <>\n      {selectedDedupSiteIds.size > 0\n        ? [\n            <div>\n              <Button type=\"primary\" onClick={handleGroup} disabled={selectedDedupSiteIds.size === 1}>\n                Group selected sites\n              </Button>\n            </div>,\n            <Table<DedupMineralSite>\n              bordered={true}\n              size=\"small\"\n              rowKey=\"id\"\n              pagination={false}\n              columns={[\n                {\n                  title: \"\",\n                  key: \"group\",\n                  render: (_: any, site: DedupMineralSite) => <Checkbox type=\"primary\" checked={true} onClick={() => selectDedupSite(site, false)} />,\n                },\n                ...columns.slice(1),\n              ]}\n              dataSource={Array.from(selectedDedupSiteIds).map((id) => dedupMineralSiteStore.get(id)!)}\n            />,\n          ]\n        : []}\n      <Table<DedupMineralSite>\n        bordered={true}\n        size=\"small\"\n        rowKey=\"id\"\n        columns={columns}\n        dataSource={dedupMineralSites.records}\n        loading={isLoading ? { size: \"large\" } : false}\n        expandable={{\n          expandedRowRender: (site) => {\n            if (editingDedupSite === site.id) {\n              return <EditDedupMineralSite commodity={commodity!} dedupSite={site} />;\n            }\n            return null;\n          },\n          showExpandColumn: false,\n          expandedRowKeys: [...(editingDedupSite ? [editingDedupSite] : [])],\n        }}\n      />\n    </>\n  );\n});\n","import { Flex } from \"antd\";\nimport { observer } from \"mobx-react\";\nimport { SearchBar, useSearchArgs } from \"./SearchBar\";\nimport { DedupMineralSiteTable } from \"./DedupMineralSiteTable\";\n\nexport const HomePage = observer(() => {\n  const [searchArgs, normSearchArgs, setSearchArgs] = useSearchArgs();\n\n  return (\n    <Flex vertical={true} gap=\"small\">\n      <SearchBar searchArgs={searchArgs} setSearchArgs={setSearchArgs} />\n      <DedupMineralSiteTable commodity={normSearchArgs.commodity} />\n    </Flex>\n  );\n});\n","import { Menu } from \"antd\";\nimport { WithStyles, withStyles } from \"@material-ui/styles\";\nimport { useLocation } from \"react-router-dom\";\nimport { getActiveRouteName, PathDef } from \"gena-app\";\nimport React from \"react\";\n\nconst css = {\n  centerNavBar: {\n    justifyContent: \"center\",\n    boxShadow: \"0 2px 8px #f0f1f2\",\n  },\n  leftNavBar: {\n    \"& .logo::after\": {\n      borderBottom: \"none !important\",\n      transition: \"none !important\",\n    },\n    \"& .logo:hover::after\": {\n      borderBottom: \"none !important\",\n      transition: \"none !important\",\n    },\n    \"& .logo img\": {\n      height: 24,\n      borderRadius: 4,\n      marginTop: -2,\n    },\n    paddingLeft: 24,\n    paddingRight: 24,\n    boxShadow: \"0 2px 8px #f0f1f2\",\n  },\n};\n\ntype MenuItemProps = {\n  children: string | JSX.Element;\n  icon?: JSX.Element;\n  danger?: boolean;\n  disabled?: boolean;\n};\n\ninterface Props<R> {\n  menus: Partial<Record<keyof R, string | JSX.Element | MenuItemProps>>;\n  routes: R;\n  className?: string;\n  style?: React.CSSProperties;\n  isFirstItemLogo?: boolean;\n}\ntype Component = <R extends Record<any, PathDef<any, any>>>(_p: Props<R>) => JSX.Element;\n\nexport const CenterNavBar = withStyles(css)(<R extends Record<any, PathDef<any, any>>>({ classes, menus, routes, className, style, isFirstItemLogo }: Props<R> & WithStyles<typeof css>) => {\n  const location = useLocation();\n  const openMenu = (e: { key: keyof R }) => {\n    routes[e.key].path({}, {}).open();\n  };\n\n  const items = Object.keys(menus).map((routeName, index) => {\n    const className = isFirstItemLogo === true && index === 0 ? \"logo\" : \"\";\n    return getMenuItem(routeName, className, menus[routeName]!);\n  });\n  const activeRouteName = getActiveRouteName(location, routes);\n\n  return (\n    <Menu\n      mode=\"horizontal\"\n      className={classes.centerNavBar + (className !== undefined ? \" \" + className : \"\")}\n      style={style}\n      onClick={openMenu}\n      selectedKeys={activeRouteName !== undefined ? [activeRouteName] : undefined}\n    >\n      {items}\n    </Menu>\n  );\n}) as Component;\n\nexport const LeftNavBar = withStyles(css)(<R extends Record<any, PathDef<any, any>>>({ classes, menus, routes, className, style, isFirstItemLogo }: Props<R> & WithStyles<typeof css>) => {\n  const location = useLocation();\n  const openMenu = (e: { key: keyof R }) => {\n    routes[e.key].path({}, {}).open();\n  };\n\n  const items = Object.keys(menus).map((routeName, index) => {\n    const className = isFirstItemLogo === true && index === 0 ? \"logo\" : \"\";\n    return getMenuItem(routeName, className, menus[routeName]!);\n  });\n  const activeRouteName = getActiveRouteName(location, routes);\n\n  return (\n    <Menu\n      mode=\"horizontal\"\n      className={classes.leftNavBar + (className !== undefined ? \" \" + className : \"\")}\n      style={style}\n      onClick={openMenu}\n      selectedKeys={activeRouteName !== undefined ? [activeRouteName] : undefined}\n    >\n      {items}\n    </Menu>\n  );\n}) as Component;\n\nfunction getMenuItem(key: string, className: string, props: string | JSX.Element | MenuItemProps) {\n  let children, realprops;\n\n  if (typeof props === \"string\") {\n    children = props;\n  } else if (React.isValidElement(props)) {\n    children = props;\n  } else {\n    const { children: children2, ...realprops2 } = props as MenuItemProps;\n    children = children2;\n    realprops = realprops2;\n  }\n\n  return (\n    <Menu.Item className={className} key={key} {...realprops}>\n      {children}\n    </Menu.Item>\n  );\n}\n","import { Avatar, Button, Col, List, Row, Typography } from \"antd\";\nimport { observer } from \"mobx-react\";\nimport React, { ReactElement, useEffect } from \"react\";\nimport { InternalLink } from \"gena-app\";\nimport { useStores } from \"../models\";\nimport { routes } from \"../routes\";\n\nexport const RequiredAuthentication = observer(({ children }: { children: ReactElement }) => {\n  const { userStore } = useStores();\n\n  // check & login if not logged in\n  useEffect(() => {\n    userStore.isLoggedIn().then((isLoggedIn) => {\n      if (!isLoggedIn) {\n        routes.login.path().open();\n      }\n    });\n  }, [userStore]);\n\n  return children;\n});\n","import { PathDef, NoArgsPathDef, NoURLArgsPathDef, applyLayout } from \"gena-app\";\nimport { HomePage, LoginPage } from \"./pages\";\n\nimport React, { useEffect } from \"react\";\nimport { LeftNavBar } from \"./components/Navbar\";\nimport { Space } from \"antd\";\n\nimport { RequiredAuthentication } from \"components/RequiredAuthentication\";\nimport { PUBLIC_URL } from \"env\";\n\n/*************************************************************************************\n * Layouts of the application\n */\nexport const Layout = (component: React.FunctionComponent<any> | React.ComponentClass<any, any>) => {\n  return (props: any) => {\n    const element = React.createElement(component, props);\n\n    return (\n      <Space direction=\"vertical\" style={{ width: \"100%\" }}>\n        <LeftNavBar\n          menus={{\n            home: <span>MinMod Editor</span>,\n          }}\n          routes={routes}\n          isFirstItemLogo={true}\n        />\n        <RequiredAuthentication>\n          <div className=\"wide-container\">{element}</div>\n        </RequiredAuthentication>\n      </Space>\n    );\n  };\n};\n\nconst None = () => <h1>Not supposed to see this page</h1>;\n\n/*************************************************************************************\n * Definitions for routes in this application\n */\nexport const routes = {\n  login: new NoArgsPathDef({\n    component: LoginPage,\n    pathDef: `${PUBLIC_URL}/login`,\n    exact: true,\n  }),\n  home: new NoURLArgsPathDef({\n    component: HomePage,\n    pathDef: `${PUBLIC_URL}/`,\n    exact: true,\n    querySchema: {\n      commodity: \"optionalstring\",\n    },\n  }),\n};\n(window as any)._routes = routes;\n\n// apply this layout to all routes except login\napplyLayout(routes, Layout, [\"login\"]);\n","import React, { useEffect, useState } from \"react\";\nimport \"./login.css\";\nimport { routes } from \"routes\";\nimport { useStores } from \"../../models\";\n\nexport const LoginPage = () => {\n  const { userStore } = useStores();\n\n  const [username, setUsername] = useState<string>(\"\");\n  const [password, setPassword] = useState<string>(\"\");\n  const [error, setError] = useState<string>(\"\");\n\n  useEffect(() => {\n    userStore.isLoggedIn().then((isLoggedIn) => {\n      if (isLoggedIn) routes.home.path({ commodity: undefined }).open();\n    });\n  }, [userStore]);\n\n  const handleLogin = async (event: React.FormEvent) => {\n    event.preventDefault();\n    try {\n      await userStore.login(username, password);\n      routes.home.path({ commodity: undefined }).open();\n    } catch (err) {\n      setError(\"An error occurred. Please try again later.\");\n    }\n  };\n\n  return (\n    <div className=\"login-container\">\n      <h2>Login</h2>\n      <form onSubmit={handleLogin} className=\"login-form\">\n        <div className=\"form-group\">\n          <label htmlFor=\"username\">Username:</label>\n          <input type=\"text\" id=\"username\" value={username} onChange={(e) => setUsername(e.target.value)} required />\n        </div>\n        <div className=\"form-group\">\n          <label htmlFor=\"password\">Password:</label>\n          <input type=\"password\" id=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required />\n        </div>\n        {error && <p className=\"error-message\">{error}</p>}\n        <button type=\"submit\" className=\"login-button\">\n          Login\n        </button>\n      </form>\n    </div>\n  );\n};\n","import { ReactElement, useEffect } from \"react\";\nimport { initNonCriticalStores } from \"models\";\n\nexport const InitNonCriticalStores = ({ children }: { children: ReactElement }) => {\n  useEffect(() => {\n    initNonCriticalStores();\n  }, []);\n\n  return children;\n};\n","import ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport { App } from \"gena-app\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { stores, initStores, StoreContext } from \"./models\";\nimport { routes } from \"./routes\";\nimport enUSIntl from \"antd/lib/locale/en_US\";\nimport { ConfigProvider } from \"antd\";\nimport { InitNonCriticalStores } from \"components/StoreInit\";\n\ninitStores().then(() => {\n  ReactDOM.render(\n    <StoreContext.Provider value={stores}>\n      <ConfigProvider locale={enUSIntl}>\n        <InitNonCriticalStores>\n          <App enUSLocale={true} routes={routes} />\n        </InitNonCriticalStores>\n      </ConfigProvider>\n    </StoreContext.Provider>,\n    document.getElementById(\"root\")\n  );\n});\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}