(this["webpackJsonpminmod-editor"]=this["webpackJsonpminmod-editor"]||[]).push([[0],{240:function(e,t,i){},272:function(e,t,i){},281:function(e,t,i){"use strict";i.r(t);var o=i(46),r=i.n(o),n=(i(240),i(41));var a=e=>{e&&e instanceof Function&&i.e(3).then(i.bind(null,318)).then((t=>{let{getCLS:i,getFID:o,getFCP:r,getLCP:n,getTTFB:a}=t;i(e),o(e),r(e),n(e),a(e)}))},s=i(0),c=i.n(s),d=i(312),l=i(9);Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_PLATFORM;const u="native"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_PLATFORM?Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_SERVER:"";var m=i(307);class h extends n.e{constructor(){super("".concat(u,"/api/v1"),{id:"username"},!1)}async login(e,t){let i=await m.a.post("".concat(u,"/api/v1/login"),{username:e,password:t});return Object(l.r)((()=>{this.set(this.deserialize(i.data))}))}async isLoggedIn(){if(this.records.size>0)return!0;try{let e=await m.a.get("".concat(u,"/api/v1/whoami"));return Object(l.r)((()=>{this.set(this.deserialize(e.data))})),!0}catch(e){return!1}}getCurrentUser(){if(0!==this.records.size)return this.records.values().next().value||void 0}deserialize(e){return{id:e.username,email:e.email,name:e.name,url:"https://minmod.isi.edu/users/".concat(e.username)}}}class p extends n.e{constructor(){super("".concat(u,"/api/v1/commodities"),void 0,!1)}async fetchCriticalCommotities(){(this.refetch||0===this.records.size)&&await this.fetch({});const e=[];for(const t of this.records.values())null!==t&&t.isCritical&&e.push(t);return e}getByName(e){if(0!==this.records.size){for(const t of this.records.values())if(null!==t&&t.name===e)return t;return null}}deserialize(e){return{id:e.uri.substring(e.uri.lastIndexOf("/")+1),uri:e.uri,name:e.name,isCritical:e.is_critical}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class v extends n.e{constructor(){super("".concat(u,"/api/v1/deposit-types"),void 0,!1,[new n.g("name","id"),new n.g("uri","id")])}get name2id(){return this.indices[0]}get uri2id(){return this.indices[1]}getByName(e){let t=this.name2id.index.get(e);return void 0===t?void 0:this.records.get(t)}getByURI(e){let t=this.uri2id.index.get(e);return void 0===t?void 0:this.records.get(t)}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{...e,id:e.uri}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class y extends n.e{constructor(){super("".concat(u,"/api/v1/countries"),void 0,!1)}getByURI(e){const t=this.records.get(e);if(null!==t)return t}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{id:e.uri,name:e.name}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class g extends n.e{constructor(){super("".concat(u,"/api/v1/states-or-provinces"),void 0,!1)}getByURI(e){const t=this.records.get(e);if(null!==t)return t}async fetchAll(){(this.refetch||0===this.records.size)&&await this.fetch({})}deserialize(e){return{id:e.uri,name:e.name}}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class f{constructor(e){let{source:t,confidence:i,observedName:o,normalizedURI:r}=e;this.source=void 0,this.confidence=void 0,this.observedName=void 0,this.normalizedURI=void 0,this.source=t,this.confidence=i,this.observedName=o,this.normalizedURI=r}clone(){return new f({source:this.source,confidence:this.confidence,observedName:this.observedName,normalizedURI:this.normalizedURI})}static deserialize(e){return new f({source:e.source,confidence:e.confidence,observedName:e.observed_name,normalizedURI:e.normalized_uri})}serialize(){return{source:this.source,confidence:this.confidence,observed_name:this.observedName,normalized_uri:this.normalizedURI}}}class j{constructor(e){let{commodity:t,totalTonnage:i,totalGrade:o,totalContainedMetal:r}=e;this.commodity=void 0,this.totalTonnage=void 0,this.totalGrade=void 0,this.totalContainedMetal=void 0,this.commodity=t,this.totalTonnage=i,this.totalGrade=o,this.totalContainedMetal=r}clone(){return new j({commodity:this.commodity,totalTonnage:this.totalTonnage,totalGrade:this.totalGrade,totalContainedMetal:this.totalContainedMetal})}static deserialize(e){return new j({commodity:e.commodity,totalTonnage:e.total_tonnage,totalGrade:e.total_grade,totalContainedMetal:e.total_contained_metal})}}class b{constructor(e){let{document:t,comment:i,property:o}=e;this.document=void 0,this.comment=void 0,this.property=void 0,this.document=t,this.comment=i,this.property=o}clone(){return new b({document:this.document.clone(),comment:this.comment,property:this.property})}static deserialize(e){return e={...e,document:O.deserialize(e.document)},new b(e)}serialize(){return{document:this.document.serialize(),comment:this.comment,property:this.property}}static normalizeProperty(e){switch(e){case"name":return"http://www.w3.org/2000/01/rdf-schema#label";case"location":return"https://minmod.isi.edu/ontology/location";case"depositType":return"https://minmod.isi.edu/ontology/deposit_type";case"grade":return"https://minmod.isi.edu/ontology/grade";case"tonnage":return"https://minmod.isi.edu/ontology/ore";default:return""}}}class O{constructor(e){let{uri:t,title:i}=e;this.uri=void 0,this.title=void 0,this.uri=t,this.title=i}clone(){return new O({uri:this.uri,title:this.title})}static deserialize(e){return new O({uri:e.uri,title:e.title})}serialize(){return{uri:this.uri,title:this.title}}}class x{constructor(e){let{category:t,commodity:i,grade:o,ore:r,reference:n}=e;this.category=void 0,this.commodity=void 0,this.grade=void 0,this.ore=void 0,this.reference=void 0,this.category=t,this.commodity=i,this.grade=o,this.ore=r,this.reference=n}static fromGradeTonnage(e,t,i,o){const r=e.commodityStore.get(i.commodity);return new x({category:["Inferred","Indicated","Measured"].map((e=>new f({source:t,confidence:1,observedName:e,normalizedURI:"https://minmod.isi.edu/resource/"+e}))),commodity:new f({source:t,confidence:1,observedName:r.name,normalizedURI:r.uri}),grade:void 0===i.totalGrade?void 0:new T({value:i.totalGrade,unit:new f({source:t,confidence:1,observedName:"%",normalizedURI:"https://minmod.isi.edu/resource/Q201"})}),ore:void 0===i.totalTonnage?void 0:new T({value:i.totalTonnage,unit:new f({source:t,confidence:1,observedName:"%",normalizedURI:"https://minmod.isi.edu/resource/Q202"})}),reference:o})}static deserialize(e){return new x({category:void 0===e.category?[]:e.category.map(f.deserialize),commodity:f.deserialize(e.commodity),grade:void 0===e.grade?void 0:T.deserialize(e.grade),ore:void 0===e.ore?void 0:T.deserialize(e.ore),reference:b.deserialize(e.reference)})}}class T{constructor(e){let{value:t,unit:i}=e;this.value=void 0,this.unit=void 0,this.value=t,this.unit=i}static deserialize(e){return new T({value:e.value,unit:f.deserialize(e.unit)})}}class I{constructor(e){let{id:t,recordId:i,sourceId:o,createdBy:r,name:n,locationInfo:a,depositTypeCandidate:s,reference:c,sameAs:d,gradeTonnage:l,dedupSiteURI:u,mineralInventory:m}=e;this.id=void 0,this.sourceId=void 0,this.recordId=void 0,this.dedupSiteURI=void 0,this.createdBy=void 0,this.name=void 0,this.locationInfo=void 0,this.depositTypeCandidate=void 0,this.reference=void 0,this.sameAs=void 0,this.gradeTonnage=void 0,this.mineralInventory=void 0,this.id=t,this.recordId=i,this.sourceId=o,this.dedupSiteURI=u,this.createdBy=r,this.name=n,this.locationInfo=a,this.depositTypeCandidate=s,this.reference=c,this.sameAs=d,this.gradeTonnage=l,this.mineralInventory=m}get uri(){return"https://minmod.isi.edu/resource/".concat(this.id)}getReferencedDocuments(){const e={};for(const t of this.reference)e[t.document.uri]=t.document;return e}getFirstReferencedDocument(){return this.reference[0].document}updateField(e,t,i){switch(t.field){case"name":this.name=t.value;break;case"location":this.locationInfo.location=t.value;break;case"depositType":this.depositTypeCandidate=[new f({source:this.createdBy[0],confidence:1,normalizedURI:t.normalizedURI,observedName:t.observedName})];break;case"grade":void 0===this.gradeTonnage[t.commodity]?this.gradeTonnage[t.commodity]=new j({commodity:t.commodity,totalGrade:t.value,totalTonnage:1e-5}):this.gradeTonnage[t.commodity].totalGrade=t.value,this.mineralInventory=[x.fromGradeTonnage(e,this.createdBy[0],this.gradeTonnage[t.commodity],i)];break;case"tonnage":void 0===this.gradeTonnage[t.commodity]?this.gradeTonnage[t.commodity]=new j({commodity:t.commodity,totalTonnage:t.value,totalGrade:1e-5}):this.gradeTonnage[t.commodity].totalTonnage=t.value,this.mineralInventory=[x.fromGradeTonnage(e,this.createdBy[0],this.gradeTonnage[t.commodity],i)];break;default:throw new Error("Unknown edit: ".concat(t))}this.reference.push(i)}}class w extends I{constructor(e){let{draftID:t,...i}=e;super(i),this.draftID=void 0,this.draftID=t}static fromMineralSite(e,t,i,o,r){var n;const a=i[0].id===t.sites[0]?i[0]:i.filter((e=>e.id===t.sites[0]))[0],s="https://minmod.isi.edu/users/".concat(o);return new w({draftID:"draft-".concat(t.id),id:"",sourceId:w.updateSourceId(a.sourceId,o),recordId:a.recordId,dedupSiteURI:t.uri,createdBy:[s],name:t.name,locationInfo:null===(n=t.location||new _({country:[],stateOrProvince:[]}))||void 0===n?void 0:n.toLocationInfo(e,s,1),depositTypeCandidate:t.depositTypes.length>0?[t.getTop1DepositType().toCandidateEntity(e)]:[],reference:[r],sameAs:t.sites,gradeTonnage:{[t.gradeTonnage.commodity]:t.gradeTonnage},mineralInventory:[]})}static updateSourceId(e,t){const[i,o]=e.split("::",2),r=new URL(o);return r.searchParams.set("username",t),"".concat(i,"::").concat(r.toString())}}class S extends I{constructor(){super(...arguments),this.isSaved=!0}updateField(e,t,i){super.updateField(e,t,i),this.isSaved=!1}markSaved(){this.isSaved=!0}toModel(){return new I(this)}}class R{constructor(e){let{country:t,stateOrProvince:i,location:o,crs:r}=e;this.location=void 0,this.country=void 0,this.stateOrProvince=void 0,this.crs=void 0,this.location=o,this.country=t,this.stateOrProvince=i,this.crs=r}static deserialize(e){return new R({location:e.location,country:void 0===e.country?[]:e.country.map(f.deserialize),stateOrProvince:void 0===e.state_or_province?[]:e.state_or_province.map(f.deserialize),crs:void 0===e.crs?void 0:f.deserialize(e.crs)})}clone(){return new R({location:this.location,country:this.country.map((e=>e.clone())),stateOrProvince:this.stateOrProvince.map((e=>e.clone())),crs:this.crs?this.crs.clone():void 0})}}class C extends n.b{constructor(e){super("".concat(u,"/api/v1/mineral-sites"),void 0,!1),this.dedupMineralSiteStore=void 0,this.dedupMineralSiteStore=e}async createAndUpdateDedup(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=await this.create(t,i);return await this.dedupMineralSiteStore.forceFetchByURI(o.dedupSiteURI,e),o}async updateAndUpdateDedup(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=await this.update(t,i);return await this.dedupMineralSiteStore.forceFetchByURI(o.dedupSiteURI,e),o}deserialize(e){return new I({id:e.id,recordId:e.record_id,sourceId:e.source_id,dedupSiteURI:e.dedup_site_uri,createdBy:e.created_by,name:e.name,locationInfo:void 0!==e.location_info?R.deserialize(e.location_info):new R({country:[],stateOrProvince:[]}),depositTypeCandidate:(e.deposit_type_candidate||[]).map(f.deserialize),reference:e.reference.map(b.deserialize),sameAs:e.same_as,gradeTonnage:Object.fromEntries(e.grade_tonnage.map((e=>{const t=j.deserialize(e);return[t.commodity,t]}))),mineralInventory:e.mineral_inventory.map(x.deserialize)})}serializeRecord(e){var t;const i=e.reference.map((e=>e.serialize()));let o=[];for(const r of Object.values(e.gradeTonnage))console.log("@@@",r),o.push({category:["Inferred","Indicated","Measured"].map((t=>({source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/".concat(t)}))),commodity:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/".concat(r.commodity)},ore:{value:r.totalTonnage,unit:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/Q202"}},grade:{value:r.totalGrade,unit:{source:e.createdBy[0],confidence:1,normalized_uri:"https://minmod.isi.edu/resource/Q201"}},reference:i[0]});return{name:e.name,record_id:e.recordId,source_id:e.sourceId,created_by:e.createdBy,dedup_site_uri:e.dedupSiteURI,location_info:{country:e.locationInfo.country.map((e=>e.serialize())),state_or_province:e.locationInfo.stateOrProvince.map((e=>e.serialize())),crs:null===(t=e.locationInfo.crs)||void 0===t?void 0:t.serialize(),location:e.locationInfo.location},deposit_type_candidate:e.depositTypeCandidate.map((e=>e.serialize())),mineral_inventory:o,reference:i,same_as:e.sameAs}}normRemoteSuccessfulResponse(e){return{items:Array.isArray(e.data)?e.data:Object.values(e.data),total:e.total}}}class z{constructor(e){let{uri:t,source:i,confidence:o}=e;this.uri=void 0,this.source=void 0,this.confidence=void 0,this.uri=t,this.source=i,this.confidence=o}toCandidateEntity(e){var t;return new f({source:this.source,confidence:this.confidence,normalizedURI:this.uri,observedName:null===(t=e.depositTypeStore.get(this.uri))||void 0===t?void 0:t.name})}}class _{constructor(e){let{lat:t,lon:i,country:o,stateOrProvince:r}=e;this.lat=void 0,this.lon=void 0,this.country=void 0,this.stateOrProvince=void 0,this.lat=t,this.lon=i,this.country=o,this.stateOrProvince=r}static deserialize(e){return new _({lat:e.lat,lon:e.lon,country:e.country||[],stateOrProvince:e.state_or_province||[]})}toLocationInfo(e,t){let i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return void 0!==this.lat&&void 0!==this.lon&&(i="POINT (".concat(this.lon," ").concat(this.lat,")")),new R({location:i,crs:new f({source:t,confidence:o,normalizedURI:"https://minmod.isi.edu/resource/Q701",observedName:"EPSG:4326"}),country:this.country.map((i=>{var r;return new f({source:t,confidence:o,normalizedURI:i,observedName:null===(r=e.countryStore.get(i))||void 0===r?void 0:r.name})})),stateOrProvince:this.stateOrProvince.map((i=>{var r;return new f({source:t,confidence:o,normalizedURI:i,observedName:null===(r=e.stateOrProvinceStore.get(i))||void 0===r?void 0:r.name})}))})}}class k{constructor(e){let{id:t,uri:i,name:o,type:r,rank:n,sites:a,depositTypes:s,location:c,gradeTonnage:d}=e;this.id=void 0,this.uri=void 0,this.name=void 0,this.type=void 0,this.rank=void 0,this.sites=void 0,this.depositTypes=void 0,this.location=void 0,this.gradeTonnage=void 0,this.id=t,this.uri=i,this.name=o,this.type=r,this.rank=n,this.sites=a,this.depositTypes=s,this.location=c,this.gradeTonnage=d}get commodity(){return this.gradeTonnage.commodity}static getId(e){return e.substring(e.lastIndexOf("/")+1)}static deserialize(e){return new k({id:e.id,uri:"https://minmod.isi.edu/resource/".concat(e.id),name:e.name,type:e.type,rank:e.rank,sites:e.sites,depositTypes:e.deposit_types.map((e=>new z(e))),location:void 0!==e.location?_.deserialize(e.location):void 0,gradeTonnage:j.deserialize(e.grade_tonnage)})}getTop1DepositType(){return this.depositTypes[0]}}class U extends n.e{constructor(e){super("".concat(u,"/api/v1/dedup-mineral-sites"),void 0,!1,[new n.f("commodity","id")]),this.ns=void 0,this.ns=e,Object(l.o)(this,{forceFetchByURI:l.f})}get commodity2ids(){return this.indices[0]}async forceFetchByURI(e,t){const i=k.getId(e);try{this.state.value="updating";let e=await m.a.get("".concat(this.remoteURL,"/").concat(i),{params:{commodity:t}});return Object(l.r)((()=>{let t=this.deserialize(e.data);return this.records.set(t.id,t),this.index(t),this.state.value="updated",this.records.get(t.id)}))}catch(o){if(o.response&&404===o.response.status)return void Object(l.r)((()=>{this.records.set(i,null),this.state.value="updated"}));throw Object(l.r)((()=>{this.state.value="error"})),o}}async fetchByCommodity(e){return!this.refetch&&this.commodity2ids.index.has(e.id)?this.getByCommodity(e):await this.fetch({conditions:{commodity:e.id}})}getByCommodity(e){if(!this.commodity2ids.index.has(e.id))return{records:[],total:0};const t=[];for(const i of this.commodity2ids.index.get(e.id))t.push(this.records.get(i));return{records:t,total:t.length}}deserialize(e){const t=this.ns.MR;return new k({id:e.id,uri:t.getURI(e.id),name:e.name,type:e.type,rank:e.rank,sites:e.sites,depositTypes:e.deposit_types.map((e=>new z({uri:t.getURI(e.id),source:e.source,confidence:e.confidence}))),location:void 0!==e.location?new _({lat:e.location.lat,lon:e.location.lon,country:(e.location.country||[]).map((e=>t.getURI(e))),stateOrProvince:(e.location.state_or_province||[]).map((e=>t.getURI(e)))}):void 0,gradeTonnage:j.deserialize(e.grade_tonnage)})}normRemoteSuccessfulResponse(e){return{items:e.data,total:e.total}}}class N{constructor(e,t){this.prefix=void 0,this.namespace=void 0,this.prefix=e,this.namespace=t}getURI(e){return"".concat(this.namespace).concat(e)}}const P=new U(new class{constructor(){this.MR=new N("mr","https://minmod.isi.edu/resource/"),this.MO=new N("mo","https://minmod.isi.edu/ontology/"),this.MD=new N("md","https://minmod.isi.edu/ontology-derived/")}}),B={userStore:new h,commodityStore:new p,dedupMineralSiteStore:P,mineralSiteStore:new C(P),depositTypeStore:new v,stateOrProvinceStore:new g,countryStore:new y};Object(n.j)((e=>{d.a.error("Error while talking with the server.",5)})),window._stores=B,window.toJS=l.s;const F=Object(s.createContext)(B);function D(){return c.a.useContext(F)}var E=i(314),A=i(106),L=i(226),M=i(310),G=i(151),V=i(148),K=i.n(V),q=i(110),W=i(10);const H=e=>{let{searchArgs:t,setSearchArgs:i}=e;const{commodityStore:o}=D(),[r,n]=Object(s.useState)([]);Object(s.useEffect)((()=>{o.fetchCriticalCommotities().then((e=>{n(e.map((e=>({value:e.id,label:e.name}))))}))}),[o]);return Object(W.jsxs)(L.a,{children:[Object(W.jsx)(M.a.Text,{children:"Commodity:"}),Object(W.jsx)(G.a,{style:{width:200},value:t.commodity,placeholder:"Select a commodity",showSearch:!0,optionFilterProp:"label",onChange:e=>{i({commodity:o.get(e).name})},options:r})]})};var Q=i(142),J=i(315),X=i(313),Y=i(68),Z=i(306),$=i(228),ee=i(317),te=i(311);const ie=e=>{let{entity:t}=e;if(void 0===t)return Object(W.jsx)("span",{children:"-"});const i=void 0===t.observedName?" ":t.observedName;return void 0!==t.normalizedURI?Object(W.jsx)(M.a.Link,{href:t.normalizedURI,target:"_blank",children:i}):Object(W.jsx)("span",{children:i})},oe=e=>{let{entities:t}=e;const i=[];t.length>0&&i.push(Object(W.jsx)(ie,{entity:t[0]},0));for(let o=1;o<t.length;o++)i.push(Object(W.jsx)("span",{children:"\xa0-\xa0"})),i.push(Object(W.jsx)(ie,{entity:t[o]},o));return Object(W.jsx)(W.Fragment,{children:i})};function re(e,t){if(0===e.length)return[];const i=[e[0]];for(let o=1;o<e.length;o++)i.push(t(o)),i.push(e[o]);return i}var ne=i(309),ae=i(223),se=i(308),ce=i(183),de=i(316),le=i(187);const ue=e=>{const[t,i]=Object(s.useState)(!1),o=e.options.map((t=>({key:t.key,label:t.label,onClick:()=>{i(!0),void 0!==e.onChange&&e.onChange(t.label),e.onProvenanceChange(t.key)}})));return o.push({type:"divider"}),o.push({key:"new",label:"Enter your own",onClick:()=>{i(!0),e.onProvenanceChange(void 0),void 0!==e.onChange&&e.onChange("")}}),t?Object(W.jsx)(ae.a,{value:e.value,onChange:t=>void 0!==e.onChange?e.onChange(t.target.value):void 0,placeholder:"Enter your own",suffix:Object(W.jsx)(de.a,{style:{color:"rgba(0,0,0,.25)"},onClick:()=>{i(!1),void 0!==e.onChange&&e.onChange("")}})}):Object(W.jsx)(ce.a,{menu:{items:o,style:{marginLeft:-12,marginTop:8}},children:Object(W.jsx)(ae.a,{value:e.value,placeholder:"Select an option or enter your own",suffix:Object(W.jsx)(le.a,{style:{color:"rgba(0,0,0,.25)"}})})})},me=e=>{let{currentSite:t,sites:i,editField:o,commodity:r,onFinish:n}=e;const{depositTypeStore:a}=D(),[c]=ne.a.useForm(),d=Object(s.useMemo)((()=>{switch(o){case"name":return"Name";case"location":return"Location";case"depositType":return"Deposit Type";case"grade":return"Grade (%)";case"tonnage":return"Tonnage (Mt)";default:return""}}),[o]),l=e=>{if(void 0!==e){const t=i.filter((t=>t.id===e))[0];c.setFieldValue("refDocURI",t.getFirstReferencedDocument().uri)}else c.setFieldValue("refDocURI","")};let u=[],m=[],h={fieldValue:"",refDocURI:"",refComment:"",refAppliedToAll:!0};if("name"===o)u=i.map((e=>({key:e.id,label:e.name}))),void 0!==t&&(h.fieldValue=t.name,h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment);else if("location"===o)u=i.filter((e=>void 0!==e.locationInfo.location)).map((e=>({key:e.id,label:e.locationInfo.location}))),void 0!==t&&(h.fieldValue=t.locationInfo.location||"",h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment);else if("depositType"===o){m=K.a.uniqBy(i.flatMap((e=>e.depositTypeCandidate)).filter((e=>void 0!==e.normalizedURI)),"normalizedURI").sort(((e,t)=>e.confidence-t.confidence)).map((e=>({value:e.normalizedURI,label:a.getByURI(e.normalizedURI).name})));const e=new Set(m.map((e=>e.value)));m=m.concat(a.filter((t=>!e.has(t.uri))).map((e=>({value:e.uri,label:e.name})))),void 0!==t&&t.depositTypeCandidate.length>0&&(h.fieldValue=t.depositTypeCandidate[0].normalizedURI,h.refDocURI=t.getFirstReferencedDocument().uri,h.refComment=t.reference[0].comment)}const p=K.a.uniqBy(i.flatMap((e=>Object.values(e.getReferencedDocuments()).map((e=>({key:e.uri,label:e.title||e.uri}))))),"uri");let v;return v="grade"===o||"tonnage"===o?Object(W.jsx)(ae.a,{type:"number"}):"depositType"===o?Object(W.jsx)(G.a,{showSearch:!0,options:m,optionFilterProp:"label"}):Object(W.jsx)(ue,{onProvenanceChange:l,options:u}),Object(W.jsx)(se.a,{title:"Edit Mineral Site",width:"70%",open:void 0!==o,onCancel:()=>n(),footer:null,children:Object(W.jsxs)(ne.a,{form:c,onFinish:e=>{if(void 0===o)return;const t=c.getFieldsValue();let i;if("name"===o||"location"===o)i={field:o,value:t.fieldValue};else if("depositType"===o)i={field:o,observedName:a.getByURI(t.fieldValue).name,normalizedURI:t.fieldValue};else{if("grade"!==o&&"tonnage"!==o)throw new Error("Unknown field ".concat(o));i={field:o,value:parseFloat(t.fieldValue),commodity:r}}n({edit:i,reference:new b({document:new O({uri:t.refDocURI}),comment:t.refComment,property:t.refAppliedToAll?void 0:b.normalizeProperty(o)})})},layout:"vertical",style:{marginTop:24,marginBottom:24},requiredMark:!0,initialValues:h,children:[Object(W.jsx)(ne.a.Item,{name:"fieldValue",label:d,required:!0,tooltip:"This is a required field",rules:[{required:!0,message:"Value cannot be empty"}],children:v}),Object(W.jsx)(ne.a.Item,{name:"refDocURI",label:"Reference",required:!0,tooltip:"This is a required field",rules:[{required:!0,message:"Document URL"}],children:Object(W.jsx)(ue,{onProvenanceChange:()=>{},options:p})}),Object(W.jsx)(ne.a.Item,{name:"refComment",label:"Comment",children:Object(W.jsx)(ae.a.TextArea,{rows:3})}),Object(W.jsx)(ne.a.Item,{name:"refAppliedToAll",valuePropName:"checked",children:Object(W.jsx)(Q.a,{children:"This reference applies to all fields"})}),Object(W.jsx)(ne.a.Item,{children:Object(W.jsxs)(L.a,{children:[Object(W.jsx)(Y.a,{type:"primary",htmlType:"submit",children:"Save"}),Object(W.jsx)(Y.a,{htmlType:"button",onClick:()=>n(),children:"Cancel"})]})})]})})};var he=i(51);const pe={table:{"& .ant-table":{margin:"0px !important",border:"1px solid #ccc"}},editButton:{cursor:"pointer"},myEditedRow:{backgroundColor:"".concat(he.d[1]," !important"),"& > td":{backgroundColor:"".concat(he.d[1]," !important")}}},ve=Object(te.a)(pe)(Object(A.a)((e=>{let{dedupSite:t,commodity:i,classes:o}=e;const r=D(),{mineralSiteStore:n,userStore:a}=r,[c,d]=Object(s.useState)(void 0),l=Object(s.useMemo)((()=>[{title:Object(W.jsxs)(E.a,{justify:"space-between",children:[Object(W.jsx)("span",{children:"Name"}),Object(W.jsx)($.a,{className:o.editButton,onClick:()=>d("name")})]}),key:"name",render:(e,t)=>Object(W.jsx)(M.a.Link,{href:t.uri,target:"_blank",children:t.name})},{title:Object(W.jsxs)(E.a,{justify:"space-between",children:[Object(W.jsx)("span",{children:"Location"}),Object(W.jsx)($.a,{className:o.editButton,onClick:()=>d("location")})]}),key:"location",render:(e,t)=>Object(W.jsx)(M.a.Text,{className:"font-small",ellipsis:!0,style:{maxWidth:200},children:t.locationInfo.location})},{title:"CRS",key:"crs",render:(e,t)=>{var i;return Object(W.jsx)("span",{children:null===(i=t.locationInfo.crs)||void 0===i?void 0:i.observedName})}},{title:"Country",key:"country",render:(e,t)=>Object(W.jsx)(oe,{entities:t.locationInfo.country})},{title:"State/Province",key:"state/province",render:(e,t)=>Object(W.jsx)(oe,{entities:t.locationInfo.stateOrProvince})},{title:Object(W.jsxs)(E.a,{justify:"space-between",children:[Object(W.jsx)("span",{children:"Dep. Type"}),Object(W.jsx)($.a,{className:o.editButton,onClick:()=>d("depositType")})]}),key:"deposit-type",render:(e,t)=>Object(W.jsx)(ie,{entity:t.depositTypeCandidate[0]})},{title:"Dep. Confidence",key:"dep-type-confidence",render:(e,t)=>0===t.depositTypeCandidate.length?"-":t.depositTypeCandidate[0].confidence.toFixed(4)},{title:Object(W.jsxs)(E.a,{justify:"space-between",children:[Object(W.jsx)("span",{children:"Tonnage (Mt)"}),Object(W.jsx)($.a,{className:o.editButton,onClick:()=>d("tonnage")})]}),key:"tonnage",render:(e,t)=>{const o=t.gradeTonnage[i.id];return void 0===o||void 0===o.totalTonnage?"-":o.totalTonnage.toFixed(4)}},{title:Object(W.jsxs)(E.a,{justify:"space-between",children:[Object(W.jsx)("span",{children:"Grade (%)"}),Object(W.jsx)($.a,{className:o.editButton,onClick:()=>d("grade")})]}),key:"grade",render:(e,t)=>{const o=t.gradeTonnage[i.id];return void 0===o||void 0===o.totalGrade?"-":o.totalGrade.toFixed(2)}},{title:"Reference",key:"reference",render:(e,t)=>Object(W.jsx)(ye,{site:t})}]),[i.id]);Object(s.useEffect)((()=>{n.fetchByIds(t.sites)}),[n]);const u=t.sites.map((e=>n.get(e))).filter((e=>void 0!==e)),m=u.filter((e=>null!==e)),h="updating"===n.state.value||u.length!==t.sites.length,p=m.find((e=>e.createdBy.includes(a.getCurrentUser().url)));return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(Z.a,{className:o.table,bordered:!0,pagination:!1,size:"small",rowKey:"id",columns:l,dataSource:m,loading:h,rowClassName:e=>e.createdBy.includes(a.getCurrentUser().url)?o.myEditedRow:""}),Object(W.jsx)(me,{sites:m,currentSite:p,editField:c,onFinish:e=>{if(void 0===e)return void d(void 0);const i=a.getCurrentUser(),o=m.find((e=>e.createdBy.includes(i.url)));let s;if(void 0===o){const o=w.fromMineralSite(r,t,m,i.id,e.reference);o.updateField(r,e.edit,e.reference),s=n.createAndUpdateDedup(t.commodity,o)}else{const i=new S(o);i.updateField(r,e.edit,e.reference),s=n.updateAndUpdateDedup(t.commodity,i)}s.then((()=>{d(void 0)}))},commodity:i.id},c)]})}))),ye=e=>{let{site:t}=e;const i=Object(s.useMemo)((()=>Object.values(t.getReferencedDocuments())),[t]);return Object(W.jsx)(M.a.Text,{ellipsis:!0,style:{maxWidth:200},children:re(i.map((e=>Object(W.jsx)(M.a.Link,{target:"_blank",href:e.uri,children:e.title||e.uri},e.uri))),(e=>Object(W.jsx)("span",{children:"\xa0\xb7\xa0"},"sep-".concat(e))))})},ge=e=>{let{uri:t,store:i}=e;const o=D()[i],r=o.get(t);return null===r?Object(W.jsx)(M.a.Link,{href:t,target:"_blank",children:"Not found"}):void 0===r?(console.log({store:i,db:o,uri:t,record:r}),Object(W.jsx)(M.a.Link,{href:t,target:"_blank",children:"Loading..."})):Object(W.jsx)(M.a.Link,{href:t,target:"_blank",children:r.name})},fe={records:[],total:0},je=[{title:"Select",key:"select",render:()=>Object(W.jsx)(Q.a,{})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>Object(W.jsx)(M.a.Link,{href:t.uri,target:"_blank",children:t.name}),sorter:!0},{title:"Type",key:"type",render:(e,t)=>Object(W.jsx)("span",{className:"font-small",children:t.type})},{title:"Rank",key:"rank",render:(e,t)=>Object(W.jsx)("span",{className:"font-small",children:t.rank})},{title:"Location",key:"location",render:(e,t)=>void 0!==t.location&&void 0!==t.location.lat&&void 0!==t.location.lon?"".concat(t.location.lat.toFixed(5),", ").concat(t.location.lon.toFixed(5)):"-"},{title:"Country",key:"country",render:(e,t)=>void 0===t.location?"-":Object(W.jsx)(L.a,{split:Object(W.jsx)(J.a,{type:"vertical"}),children:t.location.country.map((e=>Object(W.jsx)(ge,{uri:e,store:"countryStore"},e)))})},{title:"State/Province",key:"state",render:(e,t)=>void 0===t.location?"-":Object(W.jsx)(L.a,{split:Object(W.jsx)(J.a,{type:"vertical"}),children:t.location.stateOrProvince.map((e=>Object(W.jsx)(ge,{uri:e,store:"stateOrProvinceStore"},e)))})},{title:"Deposit Type",key:"depositType",render:(e,t)=>{const i=t.getTop1DepositType();return void 0===i?"-":Object(W.jsx)(ge,{uri:i.uri,store:"depositTypeStore"})}},{title:"Dep. Score",key:"depositConfidence",render:(e,t)=>{const i=t.getTop1DepositType();return void 0===i?"-":i.confidence.toFixed(4)}},{title:"Tonnage (Mt)",dataIndex:"totalTonnage",render:(e,t)=>void 0!==t.gradeTonnage&&void 0!==t.gradeTonnage.totalTonnage?t.gradeTonnage.totalTonnage.toFixed(4):"-"},{title:"Grade (%)",dataIndex:"totalGrade",render:(e,t)=>void 0!==t.gradeTonnage&&void 0!==t.gradeTonnage.totalGrade?t.gradeTonnage.totalGrade.toFixed(2):"-"},{title:"Action",key:"action"}],be=Object(A.a)((e=>{let{commodity:t}=e;const{dedupMineralSiteStore:i,commodityStore:o}=D(),[r,n]=Object(s.useState)(void 0);if(Object(s.useEffect)((()=>{void 0!==t&&i.fetchByCommodity(t)}),[t]),"error"===i.state.value)return Object(W.jsx)(X.a,{message:"Error",description:"An error occurred while querying dedup mineral sites. Please try again later.",type:"error",showIcon:!0});const a="updating"===i.state.value,c=void 0===t||a?fe:i.getByCommodity(t);return je[je.length-1].render=(e,t)=>Object(W.jsxs)(L.a,{children:[Object(W.jsx)(Y.a,{color:"primary",size:"middle",icon:Object(W.jsx)($.a,{}),variant:"filled",onClick:()=>{t.id===r?n(void 0):n(t.id)},children:"Edit"}),Object(W.jsx)(Y.a,{color:"default",size:"middle",icon:Object(W.jsx)(ee.a,{}),variant:"filled",children:"Ungroup"})]}),Object(W.jsx)(Z.a,{bordered:!0,size:"small",rowKey:"id",columns:je,dataSource:c.records,loading:!!a&&{size:"large"},expandable:{expandedRowRender:e=>Object(W.jsx)(ve,{commodity:t,dedupSite:e}),showExpandColumn:!1,expandedRowKeys:void 0===r?[]:[r]}})})),Oe=Object(A.a)((()=>{const[e,t,i]=function(){const{commodityStore:e}=D(),[t,i]=Object(s.useState)({commodity:void 0}),o=Object(s.useMemo)((()=>{if(void 0===t.commodity)return{commodity:void 0};const i=e.getByName(t.commodity);return{commodity:null===i?void 0:i}}),[e.records.size,t.commodity]);return[t,o,e=>{i(e)}]}();return Object(W.jsxs)(E.a,{vertical:!0,gap:"small",children:[Object(W.jsx)(H,{searchArgs:e,setSearchArgs:i}),Object(W.jsx)(be,{commodity:t.commodity})]})}));i(272);var xe=i(180);const Te={centerNavBar:{justifyContent:"center",boxShadow:"0 2px 8px #f0f1f2"},leftNavBar:{"& .logo::after":{borderBottom:"none !important",transition:"none !important"},"& .logo:hover::after":{borderBottom:"none !important",transition:"none !important"},"& .logo img":{height:24,borderRadius:4,marginTop:-2},paddingLeft:24,paddingRight:24,boxShadow:"0 2px 8px #f0f1f2"}},Ie=(Object(te.a)(Te)((e=>{let{classes:t,menus:i,routes:o,className:r,style:a,isFirstItemLogo:s}=e;const c=Object(q.e)(),d=Object.keys(i).map(((e,t)=>we(e,!0===s&&0===t?"logo":"",i[e]))),l=Object(n.i)(c,o);return Object(W.jsx)(xe.a,{mode:"horizontal",className:t.centerNavBar+(void 0!==r?" "+r:""),style:a,onClick:e=>{o[e.key].path({},{}).open()},selectedKeys:void 0!==l?[l]:void 0,children:d})})),Object(te.a)(Te)((e=>{let{classes:t,menus:i,routes:o,className:r,style:a,isFirstItemLogo:s}=e;const c=Object(q.e)(),d=Object.keys(i).map(((e,t)=>we(e,!0===s&&0===t?"logo":"",i[e]))),l=Object(n.i)(c,o);return Object(W.jsx)(xe.a,{mode:"horizontal",className:t.leftNavBar+(void 0!==r?" "+r:""),style:a,onClick:e=>{o[e.key].path({},{}).open()},selectedKeys:void 0!==l?[l]:void 0,children:d})})));function we(e,t,i){let o,r;if("string"===typeof i)o=i;else if(c.a.isValidElement(i))o=i;else{const{children:e,...t}=i;o=e,r=t}return Object(W.jsx)(xe.a.Item,{className:t,...r,children:o},e)}const Se=Object(A.a)((e=>{let{children:t}=e;const{userStore:i}=D();return Object(s.useEffect)((()=>{i.isLoggedIn().then((e=>{e||Re.login.path().open()}))}),[i]),t})),Re={login:new n.c({component:()=>{const{userStore:e}=D(),[t,i]=Object(s.useState)(""),[o,r]=Object(s.useState)(""),[n,a]=Object(s.useState)("");Object(s.useEffect)((()=>{e.isLoggedIn().then((e=>{e&&Re.home.path({commodity:void 0}).open()}))}),[e]);return Object(W.jsxs)("div",{className:"login-container",children:[Object(W.jsx)("h2",{children:"Login"}),Object(W.jsxs)("form",{onSubmit:async i=>{i.preventDefault();try{await e.login(t,o),Re.home.path({commodity:void 0}).open()}catch(r){a("An error occurred. Please try again later.")}},className:"login-form",children:[Object(W.jsxs)("div",{className:"form-group",children:[Object(W.jsx)("label",{htmlFor:"username",children:"Username:"}),Object(W.jsx)("input",{type:"text",id:"username",value:t,onChange:e=>i(e.target.value),required:!0})]}),Object(W.jsxs)("div",{className:"form-group",children:[Object(W.jsx)("label",{htmlFor:"password",children:"Password:"}),Object(W.jsx)("input",{type:"password",id:"password",value:o,onChange:e=>r(e.target.value),required:!0})]}),n&&Object(W.jsx)("p",{className:"error-message",children:n}),Object(W.jsx)("button",{type:"submit",className:"login-button",children:"Login"})]})]})},pathDef:"/login",exact:!0}),home:new n.d({component:Oe,pathDef:"/",exact:!0,querySchema:{commodity:"optionalstring"}})};window._routes=Re,Object(n.h)(Re,(e=>t=>{const i=c.a.createElement(e,t);return Object(W.jsxs)(L.a,{direction:"vertical",style:{width:"100%"},children:[Object(W.jsx)(Ie,{menus:{home:Object(W.jsx)("span",{children:"MinMod Editor"})},routes:Re,isFirstItemLogo:!0}),Object(W.jsx)(Se,{children:Object(W.jsx)("div",{className:"wide-container",children:i})})]})}),["login"]);var Ce=i(222),ze=i.n(Ce),_e=i(18);const ke=e=>{let{children:t}=e;return Object(s.useEffect)((()=>{Promise.all([B.depositTypeStore.fetchAll(),B.countryStore.fetchAll(),B.stateOrProvinceStore.fetchAll()])}),[]),t};Promise.resolve().then((()=>{r.a.render(Object(W.jsx)(F.Provider,{value:B,children:Object(W.jsx)(_e.a,{locale:ze.a,children:Object(W.jsx)(ke,{children:Object(W.jsx)(n.a,{enUSLocale:!0,routes:Re})})})}),document.getElementById("root"))})),a()}},[[281,1,2]]]);
//# sourceMappingURL=main.bde488f2.chunk.js.map